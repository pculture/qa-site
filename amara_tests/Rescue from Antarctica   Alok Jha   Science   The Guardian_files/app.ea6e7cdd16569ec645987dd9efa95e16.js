function Imager(e,t){t=t||{},this.update(e),t.strategy=t.strategy||"replacer",this.replacementDelay=t.hasOwnProperty("replacementDelay")?t.replacementDelay:200,this.availableWidths=t.availableWidths||[320,480,768],this.availableWidths=this.availableWidths.sort(function(e,t){return t-e}),this._processing=!1;var n=t.strategy.call?t.strategy:Imager.strategies[t.strategy];this.strategy=new n(t.placeholder)}function s_doPlugins(e){e.prop61="D=g",e.eVar38||(e.eVar38=e.getQueryParam("CMP")),e.eVar38=e.getValOnce(e.eVar38,"s_eVar38",0)}function s_gi(e,t,n){var o,i,s,r,a,c='s.version=\'H.25.3\';s.an=s_an;s.logDebug=function(m){var s=this,tcf=new Function(\'var e;try{console.log("\'+s.rep(s.rep(s.rep(m,"\\\\","\\\\\\\\"),"\\n","\\\\n"),"\\"","\\\\\\"")+\'");}catch(e){}\');tcf()};s.cls=function(x,c){var i,y=\'\';if(!c)c=this.an;for(i=0;i<x.length;i++){n=x.substring(i,i+1);if(c.indexOf(n)>=0)y+=n}retur'+"n y};s.fl=function(x,l){return x?(''+x).substring(0,l):x};s.co=function(o){return o};s.num=function(x){x=''+x;for(var p=0;p<x.length;p++)if(('0123456789').indexOf(x.substring(p,p+1))<0)return 0;return 1};s.rep=s_rep;s.sp=s_sp;s.jn=s_jn;s.ape=function(x){var s=this,h='0123456789ABCDEF',f=\"+~!*()'\",i,c=s.charSet,n,l,e,y='';c=c?c.toUpperCase():'';if(x){x=''+x;if(s.em==3){x=encodeURIComponent(x);for(i=0;i<f.length;i++) {n=f.substring(i,i+1);if(x.indexOf(n)>=0)x=s.rep(x,n,\"%\"+n.charCodeAt(0).toString(16).toUpperCase())}}else if(c=='AUTO'&&('').charCodeAt){for(i=0;i<x.length;i++){c=x.substring(i,i+1);n=x.charCodeAt(i);if(n>127){l=0;e='';while(n||l<4){e=h.substring(n%16,n%16+1)+e;n=(n-n%16)/16;l++}y+='%u'+e}else if(c=='+')y+='%2B';else y+=escape(c)}x=y}else x=s.rep(escape(''+x),'+','%2B');if(c&&c!='AUTO'&&s.em==1&&x.indexOf('%u')<0&&x.indexOf('%U')<0){i=x.indexOf('%');while(i>=0){i++;if(h.substring(8).indexOf(x.substring(i,i+1).toUpperCase())>=0)return x.substring(0,i)+'u00'+x.substring(i);i=x.indexOf('%',i)}}}return x};s.epa=function(x){var s=this,y,tcf;if(x){x=s.rep(''+x,'+',' ');if(s.em==3){tcf=new Function('x','var y,e;try{y=decodeURIComponent(x)}catch(e){y=unescape(x)}return y');return tcf(x)}else return unescape(x)}return y};s.pt=function(x,d,f,a){var s=this,t=x,z=0,y,r;while(t){y=t.indexOf(d);y=y<0?t.length:y;t=t.substring(0,y);r=s[f](t,a);if(r)return r;z+=y+d.length;t=x.substring(z,x.length);t=z<x.length?t:''}return ''};s.isf=function(t,a){var c=a.indexOf(':');if(c>=0)a=a.substring(0,c);c=a.indexOf('=');if(c>=0)a=a.substring(0,c);if(t.substring(0,2)=='s_')t=t.substring(2);return (t!=''&&t==a)};s.fsf=function(t,a){var s=this;if(s.pt(a,',','isf',t))s.fsg+=(s.fsg!=''?',':'')+t;return 0};s.fs=function(x,f){var s=this;s.fsg='';s.pt(x,',','fsf',f);return s.fsg};s.mpc=function(m,a){var s=this,c,l,n,v;v=s.d.visibilityState;if(!v)v=s.d.webkitVisibilityState;if(v&&v=='prerender'){if(!s.mpq){s.mpq=new Array;l=s.sp('webkitvisibilitychange,visibilitychange',',');for(n=0;n<l.length;n++){s.d.addEventListener(l[n],new Function('var s=s_c_il['+s._in+'],c,v;v=s.d.visibilityState;if(!v)v=s.d.webkitVisibilityState;if(s.mpq&&v==\"visible\"){while(s.mpq.length>0){c=s.mpq.shift();s[c.m].apply(s,c.a)}s.mpq=0}'),false)}}c=new Object;c.m=m;c.a=a;s.mpq.push(c);return 1}return 0};s.si=function(){var s=this,i,k,v,c=s_gi+'var s=s_gi(\"'+s.oun+'\");s.sa(\"'+s.un+'\");';for(i=0;i<s.va_g.length;i++){k=s.va_g[i];v=s[k];if(v!=undefined){if(typeof(v)!='number')c+='s.'+k+'=\"'+s_fe(v)+'\";';else c+='s.'+k+'='+v+';'}}c+=\"s.lnk=s.eo=s.linkName=s.linkType=s.wd.s_objectID=s.ppu=s.pe=s.pev1=s.pev2=s.pev3='';\";return c};s.c_d='';s.c_gdf=function(t,a){var s=this;if(!s.num(t))return 1;return 0};s.c_gd=function(){var s=this,d=s.wd.location.hostname,n=s.fpCookieDomainPeriods,p;if(!n)n=s.cookieDomainPeriods;if(d&&!s.c_d){n=n?parseInt(n):2;n=n>2?n:2;p=d.lastIndexOf('.');if(p>=0){while(p>=0&&n>1){p=d.lastIndexOf('.',p-1);n--}s.c_d=p>0&&s.pt(d,'.','c_gdf',0)?d.substring(p):d}}return s.c_d};s.c_r=function(k){var s=this;k=s.ape(k);var c=' '+s.d.cookie,i=c.indexOf(' '+k+'='),e=i<0?i:c.indexOf(';',i),v=i<0?'':s.epa(c.substring(i+2+k.length,e<0?c.length:e));return v!='[[B]]'?v:''};s.c_w=function(k,v,e){var s=this,d=s.c_gd(),l=s.cookieLifetime,t;v=''+v;l=l?(''+l).toUpperCase():'';if(e&&l!='SESSION'&&l!='NONE'){t=(v!=''?parseInt(l?l:0):-60);if(t){e=new Date;e.setTime(e.getTime()+(t*1000))}}if(k&&l!='NONE'){s.d.cookie=k+'='+s.ape(v!=''?v:'[[B]]')+'; path=/;'+(e&&l!='SESSION'?' expires='+e.toGMTString()+';':'')+(d?' domain='+d+';':'');return s.c_r(k)==v}return 0};s.eh=function(o,e,r,f){var s=this,b='s_'+e+'_'+s._in,n=-1,l,i,x;if(!s.ehl)s.ehl=new Array;l=s.ehl;for(i=0;i<l.length&&n<0;i++){if(l[i].o==o&&l[i].e==e)n=i}if(n<0){n=i;l[n]=new Object}x=l[n];x.o=o;x.e=e;f=r?x.b:f;if(r||f){x.b=r?0:o[e];x.o[e]=f}if(x.b){x.o[b]=x.b;return b}return 0};s.cet=function(f,a,t,o,b){var s=this,r,tcf;if(s.apv>=5&&(!s.isopera||s.apv>=7)){tcf=new Function('s','f','a','t','var e,r;try{r=s[f](a)}catch(e){r=s[t](e)}return r');r=tcf(s,f,a,t)}else{if(s.ismac&&s.u.indexOf('MSIE 4')>=0)r=s[b](a);else{s.eh(s.wd,'onerror',0,o);r=s[f](a);s.eh(s.wd,'onerror',1)}}return r};s.gtfset=function(e){var s=this;return s.tfs};s.gtfsoe=new Function('e','var s=s_c_il['+s._in+'],c;s.eh(window,\"onerror\",1);s.etfs=1;c=s.t();if(c)s.d.write(c);s.etfs=0;return true');s.gtfsfb=function(a){return window};s.gtfsf=function(w){var s=this,p=w.parent,l=w.location;s.tfs=w;if(p&&p.location!=l&&p.location.host==l.host){s.tfs=p;return s.gtfsf(s.tfs)}return s.tfs};s.gtfs=function(){var s=this;if(!s.tfs){s.tfs=s.wd;if(!s.etfs)s.tfs=s.cet('gtfsf',s.tfs,'gtfset',s.gtfsoe,'gtfsfb')}return s.tfs};s.mrq=function(u){var s=this,l=s.rl[u],n,r;s.rl[u]=0;if(l)for(n=0;n<l.length;n++){r=l[n];s.mr(0,0,r.r,r.t,r.u)}};s.flushBufferedRequests=function(){};s.mr=function(sess,q,rs,ta,u){var s=this,dc=s.dc,t1=s.trackingServer,t2=s.trackingServerSecure,tb=s.trackingServerBase,p='.sc',ns=s.visitorNamespace,un=s.cls(u?u:(ns?ns:s.fun)),r=new Object,l,imn='s_i_'+(un),im,b,e;if(!rs){if(t1){if(t2&&s.ssl)t1=t2}else{if(!tb)tb='2o7.net';if(dc)dc=(''+dc).toLowerCase();else dc='d1';if(tb=='2o7.net'){if(dc=='d1')dc='112';else if(dc=='d2')dc='122';p=''}t1=un+'.'+dc+'.'+p+tb}rs='http'+(s.ssl?'s':'')+'://'+t1+'/b/ss/'+s.un+'/'+(s.mobile?'5.1':'1')+'/'+s.version+(s.tcn?'T':'')+'/'+sess+'?AQB=1&ndh=1'+(q?q:'')+'&AQE=1';if(s.isie&&!s.ismac)rs=s.fl(rs,2047)}if(s.d.images&&s.apv>=3&&(!s.isopera||s.apv>=7)&&(s.ns6<0||s.apv>=6.1)){if(!s.rc)s.rc=new Object;if(!s.rc[un]){s.rc[un]=1;if(!s.rl)s.rl=new Object;s.rl[un]=new Array;setTimeout('if(window.s_c_il)window.s_c_il['+s._in+'].mrq(\"'+un+'\")',750)}else{l=s.rl[un];if(l){r.t=ta;r.u=un;r.r=rs;l[l.length]=r;return ''}imn+='_'+s.rc[un];s.rc[un]++}if(s.debugTracking){var d='AppMeasurement Debug: '+rs,dl=s.sp(rs,'&'),dln;for(dln=0;dln<dl.length;dln++)d+=\"\\n\\t\"+s.epa(dl[dln]);s.logDebug(d)}im=s.wd[imn];if(!im)im=s.wd[imn]=new Image;im.s_l=0;im.onload=new Function('e','this.s_l=1;var wd=window,s;if(wd.s_c_il){s=wd.s_c_il['+s._in+'];s.bcr();s.mrq(\"'+un+'\");s.nrs--;if(!s.nrs)s.m_m(\"rr\")}');if(!s.nrs){s.nrs=1;s.m_m('rs')}else s.nrs++;im.src=rs;if(s.useForcedLinkTracking||s.bcf){if(!s.forcedLinkTrackingTimeout)s.forcedLinkTrackingTimeout=250;setTimeout('if(window.s_c_il)window.s_c_il['+s._in+'].bcr()',s.forcedLinkTrackingTimeout);}else if((s.lnk||s.eo)&&(!ta||ta=='_self'||ta=='_top'||(s.wd.name&&ta==s.wd.name))){b=e=new Date;while(!im.s_l&&e.getTime()-b.getTime()<500)e=new Date}return ''}return '<im'+'g sr'+'c=\"'+rs+'\" width=1 height=1 border=0 alt=\"\">'};s.gg=function(v){var s=this;if(!s.wd['s_'+v])s.wd['s_'+v]='';return s.wd['s_'+v]};s.glf=function(t,a){if(t.substring(0,2)=='s_')t=t.substring(2);var s=this,v=s.gg(t);if(v)s[t]=v};s.gl=function(v){var s=this;if(s.pg)s.pt(v,',','glf',0)};s.rf=function(x){var s=this,y,i,j,h,p,l=0,q,a,b='',c='',t;if(x&&x.length>255){y=''+x;i=y.indexOf('?');if(i>0){q=y.substring(i+1);y=y.substring(0,i);h=y.toLowerCase();j=0;if(h.substring(0,7)=='http://')j+=7;else if(h.substring(0,8)=='https://')j+=8;i=h.indexOf(\"/\",j);if(i>0){h=h.substring(j,i);p=y.substring(i);y=y.substring(0,i);if(h.indexOf('google')>=0)l=',q,ie,start,search_key,word,kw,cd,';else if(h.indexOf('yahoo.co')>=0)l=',p,ei,';if(l&&q){a=s.sp(q,'&');if(a&&a.length>1){for(j=0;j<a.length;j++){t=a[j];i=t.indexOf('=');if(i>0&&l.indexOf(','+t.substring(0,i)+',')>=0)b+=(b?'&':'')+t;else c+=(c?'&':'')+t}if(b&&c)q=b+'&'+c;else c=''}i=253-(q.length-c.length)-y.length;x=y+(i>0?p.substring(0,i):'')+'?'+q}}}}return x};s.s2q=function(k,v,vf,vfp,f){var s=this,qs='',sk,sv,sp,ss,nke,nk,nf,nfl=0,nfn,nfm;if(k==\"contextData\")k=\"c\";if(v){for(sk in v)if((!f||sk.substring(0,f.length)==f)&&v[sk]&&(!vf||vf.indexOf(','+(vfp?vfp+'.':'')+sk+',')>=0)&&(!Object||!Object.prototype||!Object.prototype[sk])){nfm=0;if(nfl)for(nfn=0;nfn<nfl.length;nfn++)if(sk.substring(0,nfl[nfn].length)==nfl[nfn])nfm=1;if(!nfm){if(qs=='')qs+='&'+k+'.';sv=v[sk];if(f)sk=sk.substring(f.length);if(sk.length>0){nke=sk.indexOf('.');if(nke>0){nk=sk.substring(0,nke);nf=(f?f:'')+nk+'.';if(!nfl)nfl=new Array;nfl[nfl.length]=nf;qs+=s.s2q(nk,v,vf,vfp,nf)}else{if(typeof(sv)=='boolean'){if(sv)sv='true';else sv='false'}if(sv){if(vfp=='retrieveLightData'&&f.indexOf('.contextData.')<0){sp=sk.substring(0,4);ss=sk.substring(4);if(sk=='transactionID')sk='xact';else if(sk=='channel')sk='ch';else if(sk=='campaign')sk='v0';else if(s.num(ss)){if(sp=='prop')sk='c'+ss;else if(sp=='eVar')sk='v'+ss;else if(sp=='list')sk='l'+ss;else if(sp=='hier'){sk='h'+ss;sv=sv.substring(0,255)}}}qs+='&'+s.ape(sk)+'='+s.ape(sv)}}}}}if(qs!='')qs+='&.'+k}return qs};s.hav=function(){var s=this,qs='',l,fv='',fe='',mn,i,e;if(s.lightProfileID){l=s.va_m;fv=s.lightTrackVars;if(fv)fv=','+fv+','+s.vl_mr+','}else{l=s.va_t;if(s.pe||s.linkType){fv=s.linkTrackVars;fe=s.linkTrackEvents;if(s.pe){mn=s.pe.substring(0,1).toUpperCase()+s.pe.substring(1);if(s[mn]){fv=s[mn].trackVars;fe=s[mn].trackEvents}}}if(fv)fv=','+fv+','+s.vl_l+','+s.vl_l2;if(fe){fe=','+fe+',';if(fv)fv+=',events,'}if (s.events2)e=(e?',':'')+s.events2}for(i=0;i<l.length;i++){var k=l[i],v=s[k],b=k.substring(0,4),x=k.substring(4),n=parseInt(x),q=k;if(!v)if(k=='events'&&e){v=e;e=''}if(v&&(!fv||fv.indexOf(','+k+',')>=0)&&k!='linkName'&&k!='linkType'){if(k=='timestamp')q='ts';else if(k=='dynamicVariablePrefix')q='D';else if(k=='visitorID')q='vid';else if(k=='pageURL'){q='g';if(v.length>255){s.pageURLRest=v.substring(255);v=v.substring(0,255);}}else if(k=='pageURLRest')q='-g';else if(k=='referrer'){q='r';v=s.fl(s.rf(v),255)}else if(k=='vmk'||k=='visitorMigrationKey')q='vmt';else if(k=='visitorMigrationServer'){q='vmf';if(s.ssl&&s.visitorMigrationServerSecure)v=''}else if(k=='visitorMigrationServerSecure'){q='vmf';if(!s.ssl&&s.visitorMigrationServer)v=''}else if(k=='charSet'){q='ce';if(v.toUpperCase()=='AUTO')v='ISO8859-1';else if(s.em==2||s.em==3)v='UTF-8'}else if(k=='visitorNamespace')q='ns';else if(k=='cookieDomainPeriods')q='cdp';else if(k=='cookieLifetime')q='cl';else if(k=='variableProvider')q='vvp';else if(k=='currencyCode')q='cc';else if(k=='channel')q='ch';else if(k=='transactionID')q='xact';else if(k=='campaign')q='v0';else if(k=='resolution')q='s';else if(k=='colorDepth')q='c';else if(k=='javascriptVersion')q='j';else if(k=='javaEnabled')q='v';else if(k=='cookiesEnabled')q='k';else if(k=='browserWidth')q='bw';else if(k=='browserHeight')q='bh';else if(k=='connectionType')q='ct';else if(k=='homepage')q='hp';else if(k=='plugins')q='p';else if(k=='events'){if(e)v+=(v?',':'')+e;if(fe)v=s.fs(v,fe)}else if(k=='events2')v='';else if(k=='contextData'){qs+=s.s2q('c',s[k],fv,k,0);v=''}else if(k=='lightProfileID')q='mtp';else if(k=='lightStoreForSeconds'){q='mtss';if(!s.lightProfileID)v=''}else if(k=='lightIncrementBy'){q='mti';if(!s.lightProfileID)v=''}else if(k=='retrieveLightProfiles')q='mtsr';else if(k=='deleteLightProfiles')q='mtsd';else if(k=='retrieveLightData'){if(s.retrieveLightProfiles)qs+=s.s2q('mts',s[k],fv,k,0);v=''}else if(s.num(x)){if(b=='prop')q='c'+n;else if(b=='eVar')q='v'+n;else if(b=='list')q='l'+n;else if(b=='hier'){q='h'+n;v=s.fl(v,255)}}if(v)qs+='&'+s.ape(q)+'='+(k.substring(0,3)!='pev'?s.ape(v):v)}}return qs};s.ltdf=function(t,h){t=t?t.toLowerCase():'';h=h?h.toLowerCase():'';var qi=h.indexOf('?');h=qi>=0?h.substring(0,qi):h;if(t&&h.substring(h.length-(t.length+1))=='.'+t)return 1;return 0};s.ltef=function(t,h){t=t?t.toLowerCase():'';h=h?h.toLowerCase():'';if(t&&h.indexOf(t)>=0)return 1;return 0};s.lt=function(h){var s=this,lft=s.linkDownloadFileTypes,lef=s.linkExternalFilters,lif=s.linkInternalFilters;lif=lif?lif:s.wd.location.hostname;h=h.toLowerCase();if(s.trackDownloadLinks&&lft&&s.pt(lft,',','ltdf',h))return 'd';if(s.trackExternalLinks&&h.substring(0,1)!='#'&&(lef||lif)&&(!lef||s.pt(lef,',','ltef',h))&&(!lif||!s.pt(lif,',','ltef',h)))return 'e';return ''};s.lc=new Function('e','var s=s_c_il['+s._in+'],b=s.eh(this,\"onclick\");s.lnk=this;s.t();s.lnk=0;if(b)return this[b](e);return true');s.bcr=function(){var s=this;if(s.bct&&s.bce)s.bct.dispatchEvent(s.bce);if(s.bcf){if(typeof(s.bcf)=='function')s.bcf();else if(s.bct&&s.bct.href)s.d.location=s.bct.href}s.bct=s.bce=s.bcf=0};s.bc=new Function('e','if(e&&e.s_fe)return;var s=s_c_il['+s._in+'],f,tcf,t,n,nrs;if(s.d&&s.d.all&&s.d.all.cppXYctnr)return;if(!s.bbc)s.useForcedLinkTracking=0;else if(!s.useForcedLinkTracking){s.b.removeEventListener(\"click\",s.bc,true);s.bbc=s.useForcedLinkTracking=0;return}else s.b.removeEventListener(\"click\",s.bc,false);s.eo=e.srcElement?e.srcElement:e.target;nrs=s.nrs;s.t();s.eo=0;if(s.nrs>nrs&&s.useForcedLinkTracking&&e.target){t=e.target.target;if(e.target.dispatchEvent&&(!t||t==\\'_self\\'||t==\\'_top\\'||(s.wd.name&&t==s.wd.name))){e.stopPropagation();e.stopImmediatePropagation();e.preventDefault();n=s.d.createEvent(\"MouseEvents\");n.initMouseEvent(\"click\",e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget);n.s_fe=1;s.bct=e.target;s.bce=n;}}');s.oh=function(o){var s=this,l=s.wd.location,h=o.href?o.href:'',i,j,k,p;i=h.indexOf(':');j=h.indexOf('?');k=h.indexOf('/');if(h&&(i<0||(j>=0&&i>j)||(k>=0&&i>k))){p=o.protocol&&o.protocol.length>1?o.protocol:(l.protocol?l.protocol:'');i=l.pathname.lastIndexOf('/');h=(p?p+'//':'')+(o.host?o.host:(l.host?l.host:''))+(h.substring(0,1)!='/'?l.pathname.substring(0,i<0?0:i)+'/':'')+h}return h};s.ot=function(o){var t=o.tagName;if(o.tagUrn||(o.scopeName&&o.scopeName.toUpperCase()!='HTML'))return '';t=t&&t.toUpperCase?t.toUpperCase():'';if(t=='SHAPE')t='';if(t){if((t=='INPUT'||t=='BUTTON')&&o.type&&o.type.toUpperCase)t=o.type.toUpperCase();else if(!t&&o.href)t='A';}return t};s.oid=function(o){var s=this,t=s.ot(o),p,c,n='',x=0;if(t&&!o.s_oid){p=o.protocol;c=o.onclick;if(o.href&&(t=='A'||t=='AREA')&&(!c||!p||p.toLowerCase().indexOf('javascript')<0))n=s.oh(o);else if(c){n=s.rep(s.rep(s.rep(s.rep(''+c,\"\\r\",''),\"\\n\",''),\"\\t\",''),' ','');x=2}else if(t=='INPUT'||t=='SUBMIT'){if(o.value)n=o.value;else if(o.innerText)n=o.innerText;else if(o.textContent)n=o.textContent;x=3}else if(o.src&&t=='IMAGE')n=o.src;if(n){o.s_oid=s.fl(n,100);o.s_oidt=x}}return o.s_oid};s.rqf=function(t,un){var s=this,e=t.indexOf('='),u=e>=0?t.substring(0,e):'',q=e>=0?s.epa(t.substring(e+1)):'';if(u&&q&&(','+u+',').indexOf(','+un+',')>=0){if(u!=s.un&&s.un.indexOf(',')>=0)q='&u='+u+q+'&u=0';return q}return ''};s.rq=function(un){if(!un)un=this.un;var s=this,c=un.indexOf(','),v=s.c_r('s_sq'),q='';if(c<0)return s.pt(v,'&','rqf',un);return s.pt(un,',','rq',0)};s.sqp=function(t,a){var s=this,e=t.indexOf('='),q=e<0?'':s.epa(t.substring(e+1));s.sqq[q]='';if(e>=0)s.pt(t.substring(0,e),',','sqs',q);return 0};s.sqs=function(un,q){var s=this;s.squ[un]=q;return 0};s.sq=function(q){var s=this,k='s_sq',v=s.c_r(k),x,c=0;s.sqq=new Object;s.squ=new Object;s.sqq[q]='';s.pt(v,'&','sqp',0);s.pt(s.un,',','sqs',q);v='';for(x in s.squ)if(x&&(!Object||!Object.prototype||!Object.prototype[x]))s.sqq[s.squ[x]]+=(s.sqq[s.squ[x]]?',':'')+x;for(x in s.sqq)if(x&&(!Object||!Object.prototype||!Object.prototype[x])&&s.sqq[x]&&(x==q||c<2)){v+=(v?'&':'')+s.sqq[x]+'='+s.ape(x);c++}return s.c_w(k,v,0)};s.wdl=new Function('e','var s=s_c_il['+s._in+'],r=true,b=s.eh(s.wd,\"onload\"),i,o,oc;if(b)r=this[b](e);for(i=0;i<s.d.links.length;i++){o=s.d.links[i];oc=o.onclick?\"\"+o.onclick:\"\";if((oc.indexOf(\"s_gs(\")<0||oc.indexOf(\".s_oc(\")>=0)&&oc.indexOf(\".tl(\")<0)s.eh(o,\"onclick\",0,s.lc);}return r');s.wds=function(){var s=this;if(s.apv>3&&(!s.isie||!s.ismac||s.apv>=5)){if(s.b&&s.b.attachEvent)s.b.attachEvent('onclick',s.bc);else if(s.b&&s.b.addEventListener){if(s.n&&s.n.userAgent.indexOf('WebKit')>=0&&s.d.createEvent){s.bbc=1;s.useForcedLinkTracking=1;s.b.addEventListener('click',s.bc,true)}s.b.addEventListener('click',s.bc,false)}else s.eh(s.wd,'onload',0,s.wdl)}};s.vs=function(x){var s=this,v=s.visitorSampling,g=s.visitorSamplingGroup,k='s_vsn_'+s.un+(g?'_'+g:''),n=s.c_r(k),e=new Date,y=e.getYear();e.setYear(y+10+(y<1900?1900:0));if(v){v*=100;if(!n){if(!s.c_w(k,x,e))return 0;n=x}if(n%10000>v)return 0}return 1};s.dyasmf=function(t,m){if(t&&m&&m.indexOf(t)>=0)return 1;return 0};s.dyasf=function(t,m){var s=this,i=t?t.indexOf('='):-1,n,x;if(i>=0&&m){var n=t.substring(0,i),x=t.substring(i+1);if(s.pt(x,',','dyasmf',m))return n}return 0};s.uns=function(){var s=this,x=s.dynamicAccountSelection,l=s.dynamicAccountList,m=s.dynamicAccountMatch,n,i;s.un=s.un.toLowerCase();if(x&&l){if(!m)m=s.wd.location.host;if(!m.toLowerCase)m=''+m;l=l.toLowerCase();m=m.toLowerCase();n=s.pt(l,';','dyasf',m);if(n)s.un=n}i=s.un.indexOf(',');s.fun=i<0?s.un:s.un.substring(0,i)};s.sa=function(un){var s=this;if(s.un&&s.mpc('sa',arguments))return;s.un=un;if(!s.oun)s.oun=un;else if((','+s.oun+',').indexOf(','+un+',')<0)s.oun+=','+un;s.uns()};s.m_i=function(n,a){var s=this,m,f=n.substring(0,1),r,l,i;if(!s.m_l)s.m_l=new Object;if(!s.m_nl)s.m_nl=new Array;m=s.m_l[n];if(!a&&m&&m._e&&!m._i)s.m_a(n);if(!m){m=new Object,m._c='s_m';m._in=s.wd.s_c_in;m._il=s._il;m._il[m._in]=m;s.wd.s_c_in++;m.s=s;m._n=n;m._l=new Array('_c','_in','_il','_i','_e','_d','_dl','s','n','_r','_g','_g1','_t','_t1','_x','_x1','_rs','_rr','_l');s.m_l[n]=m;s.m_nl[s.m_nl.length]=n}else if(m._r&&!m._m){r=m._r;r._m=m;l=m._l;for(i=0;i<l.length;i++)if(m[l[i]])r[l[i]]=m[l[i]];r._il[r._in]=r;m=s.m_l[n]=r}if(f==f.toUpperCase())s[n]=m;return m};s.m_a=new Function('n','g','e','if(!g)g=\"m_\"+n;var s=s_c_il['+s._in+'],c=s[g+\"_c\"],m,x,f=0;if(s.mpc(\"m_a\",arguments))return;if(!c)c=s.wd[\"s_\"+g+\"_c\"];if(c&&s_d)s[g]=new Function(\"s\",s_ft(s_d(c)));x=s[g];if(!x)x=s.wd[\\'s_\\'+g];if(!x)x=s.wd[g];m=s.m_i(n,1);if(x&&(!m._i||g!=\"m_\"+n)){m._i=f=1;if((\"\"+x).indexOf(\"function\")>=0)x(s);else s.m_m(\"x\",n,x,e)}m=s.m_i(n,1);if(m._dl)m._dl=m._d=0;s.dlt();return f');s.m_m=function(t,n,d,e){t='_'+t;var s=this,i,x,m,f='_'+t,r=0,u;if(s.m_l&&s.m_nl)for(i=0;i<s.m_nl.length;i++){x=s.m_nl[i];if(!n||x==n){m=s.m_i(x);u=m[t];if(u){if((''+u).indexOf('function')>=0){if(d&&e)u=m[t](d,e);else if(d)u=m[t](d);else u=m[t]()}}if(u)r=1;u=m[t+1];if(u&&!m[f]){if((''+u).indexOf('function')>=0){if(d&&e)u=m[t+1](d,e);else if(d)u=m[t+1](d);else u=m[t+1]()}}m[f]=1;if(u)r=1}}return r};s.m_ll=function(){var s=this,g=s.m_dl,i,o;if(g)for(i=0;i<g.length;i++){o=g[i];if(o)s.loadModule(o.n,o.u,o.d,o.l,o.e,1);g[i]=0}};s.loadModule=function(n,u,d,l,e,ln){var s=this,m=0,i,g,o=0,f1,f2,c=s.h?s.h:s.b,b,tcf;if(n){i=n.indexOf(':');if(i>=0){g=n.substring(i+1);n=n.substring(0,i)}else g=\"m_\"+n;m=s.m_i(n)}if((l||(n&&!s.m_a(n,g)))&&u&&s.d&&c&&s.d.createElement){if(d){m._d=1;m._dl=1}if(ln){if(s.ssl)u=s.rep(u,'http:','https:');i='s_s:'+s._in+':'+n+':'+g;b='var s=s_c_il['+s._in+'],o=s.d.getElementById(\"'+i+'\");if(s&&o){if(!o.l&&s.wd.'+g+'){o.l=1;if(o.i)clearTimeout(o.i);o.i=0;s.m_a(\"'+n+'\",\"'+g+'\"'+(e?',\"'+e+'\"':'')+')}';f2=b+'o.c++;if(!s.maxDelay)s.maxDelay=250;if(!o.l&&o.c<(s.maxDelay*2)/100)o.i=setTimeout(o.f2,100)}';f1=new Function('e',b+'}');tcf=new Function('s','c','i','u','f1','f2','var e,o=0;try{o=s.d.createElement(\"script\");if(o){o.type=\"text/javascript\";'+(n?'o.id=i;o.defer=true;o.onload=o.onreadystatechange=f1;o.f2=f2;o.l=0;':'')+'o.src=u;c.appendChild(o);'+(n?'o.c=0;o.i=setTimeout(f2,100)':'')+'}}catch(e){o=0}return o');o=tcf(s,c,i,u,f1,f2)}else{o=new Object;o.n=n+':'+g;o.u=u;o.d=d;o.l=l;o.e=e;g=s.m_dl;if(!g)g=s.m_dl=new Array;i=0;while(i<g.length&&g[i])i++;g[i]=o}}else if(n){m=s.m_i(n);m._e=1}return m};s.voa=function(vo,r){var s=this,l=s.va_g,i,k,v,x;for(i=0;i<l.length;i++){k=l[i];v=vo[k];if(v||vo['!'+k]){if(!r&&(k==\"contextData\"||k==\"retrieveLightData\")&&s[k])for(x in s[k])if(!v[x])v[x]=s[k][x];s[k]=v}}};s.vob=function(vo){var s=this,l=s.va_g,i,k;for(i=0;i<l.length;i++){k=l[i];vo[k]=s[k];if(!vo[k])vo['!'+k]=1}};s.dlt=new Function('var s=s_c_il['+s._in+'],d=new Date,i,vo,f=0;if(s.dll)for(i=0;i<s.dll.length;i++){vo=s.dll[i];if(vo){if(!s.m_m(\"d\")||d.getTime()-vo._t>=s.maxDelay){s.dll[i]=0;s.t(vo)}else f=1}}if(s.dli)clearTimeout(s.dli);s.dli=0;if(f){if(!s.dli)s.dli=setTimeout(s.dlt,s.maxDelay)}else s.dll=0');s.dl=function(vo){var s=this,d=new Date;if(!vo)vo=new Object;s.vob(vo);vo._t=d.getTime();if(!s.dll)s.dll=new Array;s.dll[s.dll.length]=vo;if(!s.maxDelay)s.maxDelay=250;s.dlt()};s.gfid=function(){var s=this,d='0123456789ABCDEF',k='s_fid',fid=s.c_r(k),h='',l='',i,j,m=8,n=4,e=new Date,y;if(!fid||fid.indexOf('-')<0){for(i=0;i<16;i++){j=Math.floor(Math.random()*m);h+=d.substring(j,j+1);j=Math.floor(Math.random()*n);l+=d.substring(j,j+1);m=n=16}fid=h+'-'+l;}y=e.getYear();e.setYear(y+2+(y<1900?1900:0));if(!s.c_w(k,fid,e))fid=0;return fid};s.applyADMS=function(){var s=this,vb=new Object;if(s.wd.ADMS&&!s.visitorID&&!s.admsc){if(!s.adms)s.adms=ADMS.getDefault();if(!s.admsq){s.visitorID=s.adms.getVisitorID(new Function('v','var s=s_c_il['+s._in+'],l=s.admsq,i;if(v==-1)v=0;if(v)s.visitorID=v;s.admsq=0;if(l){s.admsc=1;for(i=0;i<l.length;i++)s.t(l[i]);s.admsc=0;}'));if(!s.visitorID)s.admsq=new Array}if(s.admsq){s.vob(vb);vb['!visitorID']=0;s.admsq.push(vb);return 1}else{if(s.visitorID==-1)s.visitorID=0}}return 0};s.track=s.t=function(vo){var s=this,trk=1,tm=new Date,sed=Math&&Math.random?Math.floor(Math.random()*10000000000000):tm.getTime(),sess='s'+Math.floor(tm.getTime()/10800000)%10+sed,y=tm.getYear(),vt=tm.getDate()+'/'+tm.getMonth()+'/'+(y<1900?y+1900:y)+' '+tm.getHours()+':'+tm.getMinutes()+':'+tm.getSeconds()+' '+tm.getDay()+' '+tm.getTimezoneOffset(),tcf,tfs=s.gtfs(),ta=-1,q='',qs='',code='',vb=new Object;if(s.mpc('t',arguments))return;s.gl(s.vl_g);s.uns();s.m_ll();if(!s.td){var tl=tfs.location,a,o,i,x='',c='',v='',p='',bw='',bh='',j='1.0',k=s.c_w('s_cc','true',0)?'Y':'N',hp='',ct='',pn=0,ps;if(String&&String.prototype){j='1.1';if(j.match){j='1.2';if(tm.setUTCDate){j='1.3';if(s.isie&&s.ismac&&s.apv>=5)j='1.4';if(pn.toPrecision){j='1.5';a=new Array;if(a.forEach){j='1.6';i=0;o=new Object;tcf=new Function('o','var e,i=0;try{i=new Iterator(o)}catch(e){}return i');i=tcf(o);if(i&&i.next){j='1.7';if(a.reduce){j='1.8';if(j.trim){j='1.8.1';if(Date.parse){j='1.8.2';if(Object.create)j='1.8.5'}}}}}}}}}if(s.apv>=4)x=screen.width+'x'+screen.height;if(s.isns||s.isopera){if(s.apv>=3){v=s.n.javaEnabled()?'Y':'N';if(s.apv>=4){c=screen.pixelDepth;bw=s.wd.innerWidth;bh=s.wd.innerHeight}}s.pl=s.n.plugins}else if(s.isie){if(s.apv>=4){v=s.n.javaEnabled()?'Y':'N';c=screen.colorDepth;if(s.apv>=5){bw=s.d.documentElement.offsetWidth;bh=s.d.documentElement.offsetHeight;if(!s.ismac&&s.b){tcf=new Function('s','tl','var e,hp=0;try{s.b.addBehavior(\"#default#homePage\");hp=s.b.isHomePage(tl)?\"Y\":\"N\"}catch(e){}return hp');hp=tcf(s,tl);tcf=new Function('s','var e,ct=0;try{s.b.addBehavior(\"#default#clientCaps\");ct=s.b.connectionType}catch(e){}return ct');ct=tcf(s)}}}else r=''}if(s.pl)while(pn<s.pl.length&&pn<30){ps=s.fl(s.pl[pn].name,100)+';';if(p.indexOf(ps)<0)p+=ps;pn++}s.resolution=x;s.colorDepth=c;s.javascriptVersion=j;s.javaEnabled=v;s.cookiesEnabled=k;s.browserWidth=bw;s.browserHeight=bh;s.connectionType=ct;s.homepage=hp;s.plugins=p;s.td=1}if(vo){s.vob(vb);s.voa(vo)}s.fid=s.gfid();if(s.applyADMS())return '';if((vo&&vo._t)||!s.m_m('d')){if(s.usePlugins)s.doPlugins(s);if(!s.abort){var l=s.wd.location,r=tfs.document.referrer;if(!s.pageURL)s.pageURL=l.href?l.href:l;if(!s.referrer&&!s._1_referrer){s.referrer=r;s._1_referrer=1}s.m_m('g');if(s.lnk||s.eo){var o=s.eo?s.eo:s.lnk,p=s.pageName,w=1,t=s.ot(o),n=s.oid(o),x=o.s_oidt,h,l,i,oc;if(s.eo&&o==s.eo){while(o&&!n&&t!='BODY'){o=o.parentElement?o.parentElement:o.parentNode;if(o){t=s.ot(o);n=s.oid(o);x=o.s_oidt}}if(!n||t=='BODY')o='';if(o){oc=o.onclick?''+o.onclick:'';if((oc.indexOf('s_gs(')>=0&&oc.indexOf('.s_oc(')<0)||oc.indexOf('.tl(')>=0)o=0}}if(o){if(n)ta=o.target;h=s.oh(o);i=h.indexOf('?');h=s.linkLeaveQueryString||i<0?h:h.substring(0,i);l=s.linkName;t=s.linkType?s.linkType.toLowerCase():s.lt(h);if(t&&(h||l)){s.pe='lnk_'+(t=='d'||t=='e'?t:'o');s.pev1=(h?s.ape(h):'');s.pev2=(l?s.ape(l):'')}else trk=0;if(s.trackInlineStats){if(!p){p=s.pageURL;w=0}t=s.ot(o);i=o.sourceIndex;if(o.dataset&&o.dataset.sObjectId){s.wd.s_objectID=o.dataset.sObjectId;}else if(o.getAttribute&&o.getAttribute('data-s-object-id')){s.wd.s_objectID=o.getAttribute('data-s-object-id');}else if(s.useForcedLinkTracking){s.wd.s_objectID='';oc=o.onclick?''+o.onclick:'';if(oc){var ocb=oc.indexOf('s_objectID'),oce,ocq,ocx;if(ocb>=0){ocb+=10;while(ocb<oc.length&&(\"= \\t\\r\\n\").indexOf(oc.charAt(ocb))>=0)ocb++;if(ocb<oc.length){oce=ocb;ocq=ocx=0;while(oce<oc.length&&(oc.charAt(oce)!=';'||ocq)){if(ocq){if(oc.charAt(oce)==ocq&&!ocx)ocq=0;else if(oc.charAt(oce)==\"\\\\\")ocx=!ocx;else ocx=0;}else{ocq=oc.charAt(oce);if(ocq!='\"'&&ocq!=\"'\")ocq=0}oce++;}oc=oc.substring(ocb,oce);if(oc){o.s_soid=new Function('s','var e;try{s.wd.s_objectID='+oc+'}catch(e){}');o.s_soid(s)}}}}}if(s.gg('objectID')){n=s.gg('objectID');x=1;i=1}if(p&&n&&t)qs='&pid='+s.ape(s.fl(p,255))+(w?'&pidt='+w:'')+'&oid='+s.ape(s.fl(n,100))+(x?'&oidt='+x:'')+'&ot='+s.ape(t)+(i?'&oi='+i:'')}}else trk=0}if(trk||qs){s.sampled=s.vs(sed);if(trk){if(s.sampled)code=s.mr(sess,(vt?'&t='+s.ape(vt):'')+s.hav()+q+(qs?qs:s.rq()),0,ta);qs='';s.m_m('t');if(s.p_r)s.p_r();s.referrer=s.lightProfileID=s.retrieveLightProfiles=s.deleteLightProfiles=''}s.sq(qs)}}}else s.dl(vo);if(vo)s.voa(vb,1);s.abort=0;s.pageURLRest=s.lnk=s.eo=s.linkName=s.linkType=s.wd.s_objectID=s.ppu=s.pe=s.pev1=s.pev2=s.pev3='';if(s.pg)s.wd.s_lnk=s.wd.s_eo=s.wd.s_linkName=s.wd.s_linkType='';return code};s.trackLink=s.tl=function(o,t,n,vo,f){var s=this;s.lnk=o;s.linkType=t;s.linkName=n;if(f){s.bct=o;s.bcf=f}s.t(vo)};s.trackLight=function(p,ss,i,vo){var s=this;s.lightProfileID=p;s.lightStoreForSeconds=ss;s.lightIncrementBy=i;s.t(vo)};s.setTagContainer=function(n){var s=this,l=s.wd.s_c_il,i,t,x,y;s.tcn=n;if(l)for(i=0;i<l.length;i++){t=l[i];if(t&&t._c=='s_l'&&t.tagContainerName==n){s.voa(t);if(t.lmq)for(i=0;i<t.lmq.length;i++){x=t.lmq[i];y='m_'+x.n;if(!s[y]&&!s[y+'_c']){s[y]=t[y];s[y+'_c']=t[y+'_c']}s.loadModule(x.n,x.u,x.d)}if(t.ml)for(x in t.ml)if(s[x]){y=s[x];x=t.ml[x];for(i in x)if(!Object.prototype[i]){if(typeof(x[i])!='function'||(''+x[i]).indexOf('s_c_il')<0)y[i]=x[i]}}if(t.mmq)for(i=0;i<t.mmq.length;i++){x=t.mmq[i];if(s[x.m]){y=s[x.m];if(y[x.f]&&typeof(y[x.f])=='function'){if(x.a)y[x.f].apply(y,x.a);else y[x.f].apply(y)}}}if(t.tq)for(i=0;i<t.tq.length;i++)s.t(t.tq[i]);t.s=s;return}}};s.wd=window;s.ssl=(s.wd.location.protocol.toLowerCase().indexOf('https')>=0);s.d=document;s.b=s.d.body;if(s.d.getElementsByTagName){s.h=s.d.getElementsByTagName('HEAD');if(s.h)s.h=s.h[0]}s.n=navigator;s.u=s.n.userAgent;s.ns6=s.u.indexOf('Netscape6/');var apn=s.n.appName,v=s.n.appVersion,ie=v.indexOf('MSIE '),o=s.u.indexOf('Opera '),i;if(v.indexOf('Opera')>=0||o>0)apn='Opera';s.isie=(apn=='Microsoft Internet Explorer');s.isns=(apn=='Netscape');s.isopera=(apn=='Opera');s.ismac=(s.u.indexOf('Mac')>=0);if(o>0)s.apv=parseFloat(s.u.substring(o+6));else if(ie>0){s.apv=parseInt(i=v.substring(ie+5));if(s.apv>3)s.apv=parseFloat(i)}else if(s.ns6>0)s.apv=parseFloat(s.u.substring(s.ns6+10));else s.apv=parseFloat(v);s.em=0;if(s.em.toPrecision)s.em=3;else if(String.fromCharCode){i=escape(String.fromCharCode(256)).toUpperCase();s.em=(i=='%C4%80'?2:(i=='%U0100'?1:0))}if(s.oun)s.sa(s.oun);s.sa(un);s.vl_l='timestamp,dynamicVariablePrefix,visitorID,fid,vmk,visitorMigrationKey,visitorMigrationServer,visitorMigrationServerSecure,ppu,charSet,visitorNamespace,cookieDomainPeriods,cookieLifetime,pageName,pageURL,referrer,contextData,currencyCode,lightProfileID,lightStoreForSeconds,lightIncrementBy,retrieveLightProfiles,deleteLightProfiles,retrieveLightData';s.va_l=s.sp(s.vl_l,',');s.vl_mr=s.vl_m='timestamp,charSet,visitorNamespace,cookieDomainPeriods,cookieLifetime,contextData,lightProfileID,lightStoreForSeconds,lightIncrementBy';s.vl_t=s.vl_l+',variableProvider,channel,server,pageType,transactionID,purchaseID,campaign,state,zip,events,events2,products,linkName,linkType';var n;for(n=1;n<=75;n++){s.vl_t+=',prop'+n+',eVar'+n;s.vl_m+=',prop'+n+',eVar'+n}for(n=1;n<=5;n++)s.vl_t+=',hier'+n;for(n=1;n<=3;n++)s.vl_t+=',list'+n;s.va_m=s.sp(s.vl_m,',');s.vl_l2=',tnt,pe,pev1,pev2,pev3,resolution,colorDepth,javascriptVersion,javaEnabled,cookiesEnabled,browserWidth,browserHeight,connectionType,homepage,pageURLRest,plugins';s.vl_t+=s.vl_l2;s.va_t=s.sp(s.vl_t,',');s.vl_g=s.vl_t+',trackingServer,trackingServerSecure,trackingServerBase,fpCookieDomainPeriods,disableBufferedRequests,mobile,visitorSampling,visitorSamplingGroup,dynamicAccountSelection,dynamicAccountList,dynamicAccountMatch,trackDownloadLinks,trackExternalLinks,trackInlineStats,linkLeaveQueryString,linkDownloadFileTypes,linkExternalFilters,linkInternalFilters,linkTrackVars,linkTrackEvents,linkNames,lnk,eo,lightTrackVars,_1_referrer,un';s.va_g=s.sp(s.vl_g,',');s.pg=pg;s.gl(s.vl_g);s.contextData=new Object;s.retrieveLightData=new Object;if(!ss)s.wds();if(pg){s.wd.s_co=function(o){return o};s.wd.s_gs=function(un){s_gi(un,1,1).t()};s.wd.s_dc=function(un){s_gi(un,1).t()}}",l=window,u=l.s_c_il,d=navigator,m=d.userAgent,f=d.appVersion,p=f.indexOf("MSIE "),h=m.indexOf("Netscape6/");if(e&&(e=e.toLowerCase(),u))for(s=0;2>s;s++)for(i=0;i<u.length;i++)if(a=u[i],r=a._c,(!r||"s_c"==r||s>0&&"s_l"==r)&&(a.oun==e||a.fs&&a.sa&&a.fs(a.oun,e))){if(a.sa&&a.sa(e),"s_c"==r)return a}else a=0;return l.s_an="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",l.s_sp=new Function("x","d","var a=new Array,i=0,j;if(x){if(x.split)a=x.split(d);else if(!d)for(i=0;i<x.length;i++)a[a.length]=x.substring(i,i+1);else while(i>=0){j=x.indexOf(d,i);a[a.length]=x.substring(i,j<0?x.length:j);i=j;if(i>=0)i+=d.length}}return a"),l.s_jn=new Function("a","d","var x='',i,j=a.length;if(a&&j>0){x=a[0];if(j>1){if(a.join)x=a.join(d);else for(i=1;i<j;i++)x+=d+a[i]}}return x"),l.s_rep=new Function("x","o","n","return s_jn(s_sp(x,o),n)"),l.s_d=new Function("x","var t='`^@$#',l=s_an,l2=new Object,x2,d,b=0,k,i=x.lastIndexOf('~~'),j,v,w;if(i>0){d=x.substring(0,i);x=x.substring(i+2);l=s_sp(l,'');for(i=0;i<62;i++)l2[l[i]]=i;t=s_sp(t,'');d=s_sp(d,'~');i=0;while(i<5){v=0;if(x.indexOf(t[i])>=0) {x2=s_sp(x,t[i]);for(j=1;j<x2.length;j++){k=x2[j].substring(0,1);w=t[i]+k;if(k!=' '){v=1;w=d[b+l2[k]]}x2[j]=w+x2[j].substring(1)}}if(v)x=s_jn(x2,'');else{w=t[i]+' ';if(x.indexOf(w)>=0)x=s_rep(x,w,t[i]);i++;b+=62}}}return x"),l.s_fe=new Function("c","return s_rep(s_rep(s_rep(c,'\\\\','\\\\\\\\'),'\"','\\\\\"'),\"\\n\",\"\\\\n\")"),l.s_fa=new Function("f","var s=f.indexOf('(')+1,e=f.indexOf(')'),a='',c;while(s>=0&&s<e){c=f.substring(s,s+1);if(c==',')a+='\",\"';else if((\"\\n\\r\\t \").indexOf(c)<0)a+=c;s++}return a?'\"'+a+'\"':a"),l.s_ft=new Function("c","c+='';var s,e,o,a,d,q,f,h,x;s=c.indexOf('=function(');while(s>=0){s++;d=1;q='';x=0;f=c.substring(s);a=s_fa(f);e=o=c.indexOf('{',s);e++;while(d>0){h=c.substring(e,e+1);if(q){if(h==q&&!x)q='';if(h=='\\\\')x=x?0:1;else x=0}else{if(h=='\"'||h==\"'\")q=h;if(h=='{')d++;if(h=='}')d--}if(d>0)e++}c=c.substring(0,s)+'new Function('+(a?a+',':'')+'\"'+s_fe(c.substring(o+1,e))+'\")'+c.substring(e+1);s=c.indexOf('=function(')}return c;"),c=s_d(c),p>0?(o=parseInt(i=f.substring(p+5)),o>3&&(o=parseFloat(i))):o=parseFloat(h>0?m.substring(h+10):f),(5>o||f.indexOf("Opera")>=0||m.indexOf("Opera")>=0)&&(c=s_ft(c)),a||(a=new Object,l.s_c_in||(l.s_c_il=new Array,l.s_c_in=0),a._il=l.s_c_il,a._in=l.s_c_in,a._il[a._in]=a,l.s_c_in++),a._c="s_c",new Function("s","un","pg","ss",c)(a,e,t,n),a
}function s_giqf(){var e,t,n,o=window,i=o.s_giq;if(i)for(e=0;e<i.length;e++)t=i[e],n=s_gi(t.oun),n.sa(t.un),n.setTagContainer(t.tagContainerName);o.s_giq=0}(function(){!function(e){function t(){}function n(e,t){return 0==q.call(e).indexOf("[object "+t)}function o(e){return e&&"/"==e.charAt(e.length-1)?e.substr(0,e.length-1):e}function i(e,t){var n,o,i,s;return n=1,o=e,"."==o.charAt(0)&&(i=!0,o=o.replace(P,function(e,t,o,i){return o&&n++,i||""})),i?(i=t.split("/"),s=i.length-n,0>s?e:(i.splice(s,n),i.concat(o||[]).join("/"))):o}function s(e){var t=e.indexOf("!");return{g:e.substr(t+1),d:t>=0&&e.substr(0,t)}}function r(){}function a(e,t){r.prototype=e||L;var n=new r;r.prototype=L;for(var o in t)n[o]=t[o];return n}function c(){function e(e,t,n){i.push([e,t,n])}function n(e,t){for(var n,o=0;n=i[o++];)(n=n[e])&&n(t)}var o,i,s;o=this,i=[],s=function(o,r){e=o?function(e){e&&e(r)}:function(e,t){t&&t(r)},s=t,n(o?0:1,r),n=t,i=_},this.m=function(t,n,i){return e(t,n,i),o},this.h=function(e){o.C=e,s(!0,e)},this.f=function(e){o.qa=e,s(!1,e)},this.w=function(e){n(2,e)}}function l(e){return e instanceof c||e instanceof p}function u(e,t,n,o){l(e)?e.m(t,n,o):t(e)}function d(e,t,n){var o;return function(){return 0<=--e&&t&&(o=t.apply(_,arguments)),0==e&&n&&n(o),o}}function m(){var e,t;return v="",e=[].slice.call(arguments),n(e[0],"Object")&&(t=e.shift(),t=f(t)),new p(e[0],e[1],e[2],t)}function f(e,t,n){var o;return v="",e&&(C.R(e),y=C.b(e),"preloads"in e&&(o=new p(e.preloads,_,n,M,!0),C.l(function(){M=o})),e=e.main)?new p(e,t,n):void 0}function p(e,t,n,o,i){var s;s=C.k(y,_,[].concat(e),i),this.then=this.m=e=function(e,t){return u(s,function(t){e&&e.apply(_,t)},function(e){if(!t)throw e;t(e)}),this},this.next=function(e,t,n){return new p(e,t,n,s)},this.config=f,(t||n)&&e(t,n),C.l(function(){u(i||M,function(){u(o,function(){C.r(s)},n)})})}function h(e){var t,n;if(t=e.id,t==_&&(k!==_?k={I:"Multiple anonymous defines encountered"}:(t=C.da())||(k=e)),t!=_){if(n=D[t],t in D||(n=C.j(t,y),n=C.F(n.b,t),D[t]=n),!l(n))throw Error("duplicate define: "+t);n.ha=!1,C.G(n,e)}}function g(){var e=C.aa(arguments);h(e)}var v,y,b,w,_,k,x,C,T=e.document,S=T&&(T.head||T.getElementsByTagName("head")[0]),j=S&&S.getElementsByTagName("base")[0]||null,E={},A={},O={},I="addEventListener"in e?{}:{loaded:1,complete:1},L={},q=L.toString,D={},N={},M=!1,F=/^\/|^[^:]+:\/\//,P=/(\.)(\.?)(?:$|\/([^\.\/]+.*)?)/g,U=/\/\*[\s\S]*?\*\/|\/\/.*?[\n\r]/g,R=/require\s*\(\s*(["'])(.*?[^\\])\1\s*\)|[^\\]?(["'])/g,V=/\s*,\s*/;C={n:function(e,t,n){var r;return e=i(e,t),"."==e.charAt(0)?e:(r=s(e),e=(t=r.d)||r.g,e in n.c&&(e=n.c[e].M||e),t&&(0>t.indexOf("/")&&!(t in n.c)&&(e=o(n.P)+"/"+t),e=e+"!"+r.g),e)},k:function(e,t,o,i){function r(t,n){var o,i;return o=C.n(t,d.id,e),n?(i=s(o),i.d?(o=D[i.d],i.g="normalize"in o?o.normalize(i.g,r,d.b)||"":r(i.g),i.d+"!"+i.g):o):o}function a(t,o,s){var a;if(a=o&&function(e){o.apply(_,e)},n(t,"String")){if(a)throw Error("require(id, callback) not allowed");if(s=r(t,!0),t=D[s],!(s in D))throw Error("Module not resolved: "+s);return(s=l(t)&&t.a)||t}u(C.r(C.k(e,d.id,t,i)),a,s)}var d;return d=new c,d.id=t||"",d.ea=i,d.H=o,d.b=e,d.A=a,a.toUrl=function(t){return C.j(r(t,!0),e).url},d.n=r,d},F:function(e,t,n){var o,i,s;return o=C.k(e,t,_,n),i=o.h,s=d(1,function(e){o.q=e;try{return C.V(o)}catch(t){o.f(t)}}),o.h=function(e){u(n||M,function(){i(D[o.id]=N[o.url]=s(e))})},o.J=function(e){u(n||M,function(){o.a&&(s(e),o.w(A))})},o},U:function(e,t,n,o){return C.k(e,n,_,o)},ca:function(e){return e.A},K:function(e){return e.a||(e.a={})},ba:function(e){var t=e.t;return t||(t=e.t={id:e.id,uri:C.L(e),exports:C.K(e),config:function(){return e.b}},t.a=t.exports),t},L:function(e){return e.url||(e.url=C.D(e.A.toUrl(e.id),e.b))},R:function(t){var o,i,s,r,a;if(o="curl",i="define",s=r=e,t&&(a=t.overwriteApi||t.oa,o=t.apiName||t.ja||o,s=t.apiContext||t.ia||s,i=t.defineName||t.la||i,r=t.defineContext||t.ka||r,b&&n(b,"Function")&&(e.curl=b),b=null,w&&n(w,"Function")&&(e.define=w),w=null,!a)){if(s[o]&&s[o]!=m)throw Error(o+" already exists");if(r[i]&&r[i]!=g)throw Error(i+" already exists")}s[o]=m,r[i]=g},b:function(e){function t(e,t){var r,c,d,m,f;for(f in e){d=e[f],n(d,"String")&&(d={path:e[f]}),d.name=d.name||f,m=l,c=s(o(d.name)),r=c.g,(c=c.d)&&(m=u[c],m||(m=u[c]=a(l),m.c=a(l.c),m.e=[]),delete e[f]),c=d;var p=t,h=void 0;c.path=o(c.path||c.location||""),p&&(h=c.main||"./main","."==h.charAt(0)||(h="./"+h),c.M=i(h,c.name+"/")),c.b=c.config,c.b&&(c.b=a(l,c.b)),c.S=r.split("/").length,r?(m.c[r]=c,m.e.push(r)):m.o=C.Q(d.path,l)}}function r(e){var t=e.c;e.O=RegExp("^("+e.e.sort(function(e,n){return t[n].S-t[e].S}).join("|").replace(/\/|\./g,"\\$&")+")(?=\\/|$)"),delete e.e}var c,l,u,d;"baseUrl"in e&&(e.o=e.baseUrl),"main"in e&&(e.M=e.main),"preloads"in e&&(e.pa=e.preloads),"pluginPath"in e&&(e.P=e.pluginPath),("dontAddFileExt"in e||e.i)&&(e.i=RegExp(e.dontAddFileExt||e.i)),c=y,l=a(c,e),l.c=a(c.c),u=e.plugins||{},l.plugins=a(c.plugins),l.v=a(c.v,e.v),l.u=a(c.u,e.u),l.e=[],t(e.packages,!0),t(e.paths,!1);for(d in u)e=C.n(d+"!","",l),l.plugins[e.substr(0,e.length-1)]=u[d];u=l.plugins;for(d in u)u[d]=a(l,u[d]),(e=u[d].e)&&(u[d].e=e.concat(l.e),r(u[d]));for(d in c.c)l.c.hasOwnProperty(d)||l.e.push(d);return r(l),l},j:function(e,t){var n,o,i,s;return n=t.c,i=F.test(e)?e:e.replace(t.O,function(e){return o=n[e]||{},s=o.b,o.path||""}),{b:s||y,url:C.Q(i,t)}},Q:function(e,t){var n=t.o;return n&&!F.test(e)?o(n)+"/"+e:e},D:function(e,t){return e+((t||y).i.test(e)?"":".js")},s:function(t,n,o){var i=T.createElement("script");return i.onload=i.onreadystatechange=function(o){o=o||e.event,("load"==o.type||I[i.readyState])&&(delete O[t.id],i.onload=i.onreadystatechange=i.onerror="",n())},i.onerror=function(){o(Error("Syntax or http error: "+t.url))},i.type=t.N||"text/javascript",i.charset="utf-8",i.async=!t.fa,i.src=t.url,O[t.id]=i,S.insertBefore(i,j),i},W:function(e){var t,n=[];return("string"==typeof e?e:e.toSource?e.toSource():e.toString()).replace(U,"").replace(R,function(e,o,i,s){return s?t=t==s?_:t:t||n.push(i),""}),n},aa:function(e){var t,o,i,s,r,a;return r=e.length,i=e[r-1],s=n(i,"Function")?i.length:-1,2==r?n(e[0],"Array")?o=e[0]:t=e[0]:3==r&&(t=e[0],o=e[1]),!o&&s>0&&(a=!0,o=["require","exports","module"].slice(0,s).concat(C.W(i))),{id:t,q:o||[],B:s>=0?i:function(){return i},p:a}},V:function(e){var t;return t=e.B.apply(e.p?e.a:_,e.q),t===_&&e.a&&(t=e.t?e.a=e.t.exports:e.a),t},G:function(e,t){e.B=t.B,e.p=t.p,e.H=t.q,C.r(e)},r:function(e){function t(e,t,n){r[t]=e,n&&m(e,t)}function n(t,n){var o,i,s,r;o=d(1,function(e){i(e),f(e,n)}),i=d(1,function(e){m(e,n)}),s=C.Y(t,e),(r=l(s)&&s.a)&&i(r),u(s,o,e.f,e.a&&function(e){s.a&&(e==E?i(s.a):e==A&&o(s.a))})}function o(){e.h(r)}var i,s,r,a,c,m,f;for(r=[],s=e.H,a=s.length,0==s.length&&o(),m=d(a,t,function(){e.J&&e.J(r)}),f=d(a,t,o),i=0;a>i;i++)c=s[i],c in x?(f(x[c](e),i,!0),e.a&&e.w(E)):c?n(c,i):f(_,i,!0);return e},Z:function(e){return C.L(e),C.s(e,function(){var t=k;k=_,!1!==e.ha&&(!t||t.I?e.f(Error(t&&t.I||"define() missing or duplicated: "+e.url)):C.G(e,t))},e.f),e},Y:function(e,t){var n,o,i,r,a,l,d,m,f,p,h,g;return n=t.n,o=t.ea,i=t.b||y,a=n(e),a in D?l=a:(r=s(a),m=r.g,l=r.d||m,f=C.j(l,i)),a in D||(g=C.j(m,i).b,r.d?d=l:(d=g.moduleLoader||g.na||g.loader||g.ma)&&(m=l,l=d,f=C.j(d,i))),l in D?p=D[l]:f.url in N?p=D[l]=N[f.url]:(p=C.F(g,l,o),p.url=C.D(f.url,f.b),D[l]=N[f.url]=p,C.Z(p)),l==d&&(r.d&&i.plugins[r.d]&&(g=i.plugins[r.d]),h=new c,u(p,function(e){var t,i,s;if(s=e.dynamic,m="normalize"in e?e.normalize(m,n,p.b)||"":n(m),i=d+"!"+m,t=D[i],!(i in D)){t=C.U(g,i,m,o),s||(D[i]=t);var r=function(e){s||(D[i]=e),t.h(e)};r.resolve=r,r.reject=r.error=t.f,e.load(m,t.A,r,g)}h!=t&&u(t,h.h,h.f,h.w)},h.f)),h||p},da:function(){var t;if(!n(e.opera,"Opera"))for(var o in O)if("interactive"==O[o].readyState){t=o;break}return t},$:function(e){var t,n,o=0;for(t=T&&(T.scripts||T.getElementsByTagName("script"));t&&(n=t[o++]);)if(e(n))return n},X:function(){var e,t="";return(e=C.$(function(e){return(e=e.getAttribute("data-curl-run"))&&(t=e),e}))&&e.setAttribute("data-curl-run",""),t},T:function(){function e(){C.s({url:o.shift()},t,t)}function t(){v&&(o.length?(C.l(n),e()):n("run.js script did not run."))}function n(e){throw Error(e||"Primary run.js failed. Trying fallback.")}var o=v.split(V);o.length&&e()},l:function(e){setTimeout(e,0)}},x={require:C.ca,exports:C.K,module:C.ba},m.version="0.8.9",m.config=f,g.amd={plugins:!0,jQuery:!0,curl:"0.8.9"},y={o:"",P:"curl/plugin",i:/\?|\.js\b/,v:{},u:{},plugins:{},c:{},O:/$^/},b=e.curl,w=e.define,b&&n(b,"Object")?(e.curl=_,f(b)):C.R(),(v=C.X())&&C.l(C.T),D.curl=m,D["curl/_privileged"]={core:C,cache:D,config:function(){return y},_define:h,_curl:m,Promise:c}}(this.window||"undefined"!=typeof global&&global||this),function(e,t){function n(){if(!t.body)return!1;l||(l=t.createTextNode(""));try{return t.body.removeChild(t.body.appendChild(l)),l=c,!0}catch(e){return!1}}function o(){var e;if(e=d[t[u]]&&n(),!p&&e){for(p=!0,clearTimeout(a);r=g.pop();)r();f&&(t[u]="complete");for(var o;o=m.shift();)o()}return e}function i(){o(),p||(a=setTimeout(i,h))}var s,r,a,c,l,u="readyState",d={loaded:1,interactive:1,complete:1},m=[],f=t&&"string"!=typeof t[u],p=!1,h=10,g=[];s="addEventListener"in e?function(e,t){return e.addEventListener(t,o,!1),function(){e.removeEventListener(t,o,!1)}}:function(e,t){return e.attachEvent("on"+t,o),function(){e.detachEvent(t,o)}},t&&!o()&&(g=[s(e,"load"),s(t,"readystatechange"),s(e,"DOMContentLoaded")],a=setTimeout(i,h)),define("curl/domReady",function(){function e(e){p?e():m.push(e)}return e.then=e,e.amd=!0,e})}(this,this.document),function(e,t,n){define("curl/plugin/js",["curl/_privileged"],function(e){function o(t,o,i){function s(){a||(r<new Date?i():setTimeout(s,10))}var r,a,c;r=(new Date).valueOf()+(t.ga||3e5),i&&t.a&&setTimeout(s,10),c=e.core.s(t,function(){a=!0,t.a&&(t.C=n(t.a)),!t.a||t.C?o(c):i()},function(e){a=!0,i(e)})}function i(e,t){o(e,function(){var n=c.shift();r=0<c.length,n&&i.apply(null,n),t.h(e.C||!0)},function(e){t.f(e)})}var s,r,a={},c=[],l=t&&1==t.createElement("script").async,u=/\?|\.js\b/;return s=e.Promise,{dynamic:!0,normalize:function(e,t){var n=e.indexOf("!");return n>=0?t(e.substr(0,n))+e.substr(n):t(e)},load:function(e,t,n,d){function m(e){(n.error||function(e){throw e})(e)}var f,p,h,g,v;f=0<e.indexOf("!order"),p=e.indexOf("!exports="),h=p>0?e.substr(p+9):d.a,g="prefetch"in d?d.prefetch:!0,e=f||p>0?e.substr(0,e.indexOf("!")):e,p=(p=d.dontAddFileExt||d.i)?RegExp(p):u,v=t.toUrl(e),p.test(v)||(v=v.lastIndexOf(".")<=v.lastIndexOf("/")?v+".js":v),v in a?a[v]instanceof s?a[v].m(n,m):n(a[v]):(e={name:e,url:v,fa:f,a:h,ga:d.timeout},a[v]=t=new s,t.m(function(e){a[v]=e,n(e)},m),f&&!l&&r?(c.push([e,t]),g&&(e.N="text/cache",o(e,function(e){e&&e.parentNode.removeChild(e)},function(){}),e.N="")):(r=r||f,i(e,t)))},cramPlugin:"../cram/js"}})}(this,this.document,function(l){try{return eval(l)}catch(p){}}),define("curl/plugin/domReady",["../domReady"],function(e){return{load:function(t,n,o){e(o)}}})}).call(this),!function(e,t){"undefined"!=typeof module?module.exports=t():"function"==typeof define&&"object"==typeof define.amd?define("domReady",t):this[e]=t()}("domready",function(){var e,t=[],n=document,o="DOMContentLoaded",i=/^loaded|^i|^c/.test(n.readyState);return i||n.addEventListener(o,e=function(){for(n.removeEventListener(o,e),i=1;e=t.shift();)e()}),function(e){i?e():t.push(e)}}),function(){function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var o=e.prototype,i=this,s=i.EventEmitter;o.getListeners=function(e){var t,n,o=this._getEvents();if(e instanceof RegExp){t={};for(n in o)o.hasOwnProperty(n)&&e.test(n)&&(t[n]=o[n])}else t=o[e]||(o[e]=[]);return t},o.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},o.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},o.addListener=function(e,n){var o,i=this.getListenersAsObject(e),s="object"==typeof n;for(o in i)i.hasOwnProperty(o)&&-1===t(i[o],n)&&i[o].push(s?n:{listener:n,once:!1});return this},o.on=n("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=n("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,n){var o,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&(o=t(s[i],n),-1!==o&&s[i].splice(o,1));return this},o.off=n("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var o,i,s=e?this.removeListener:this.addListener,r=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(o=n.length;o--;)s.call(this,t,n[o]);else for(o in t)t.hasOwnProperty(o)&&(i=t[o])&&("function"==typeof i?s.call(this,o,i):r.call(this,o,i));return this},o.removeEvent=function(e){var t,n=typeof e,o=this._getEvents();if("string"===n)delete o[e];else if(e instanceof RegExp)for(t in o)o.hasOwnProperty(t)&&e.test(t)&&delete o[t];else delete this._events;return this},o.removeAllListeners=n("removeEvent"),o.emitEvent=function(e,t){var n,o,i,s,r=this.getListenersAsObject(e);for(i in r)if(r.hasOwnProperty(i))for(o=r[i].length;o--;)n=r[i][o],n.once===!0&&this.removeListener(e,n.listener),s=n.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},o.trigger=n("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},o._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=s,e},"function"==typeof define&&define.amd?define("EventEmitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.EventEmitter=e}.call(this),define("common/utils/mediator",["EventEmitter"],function(e){var t=null;return t||(t=new e),t}),!function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define("reqwest",n):t[e]=n()}("reqwest",this,function(){function handleReadyState(e,t,n){return function(){return e._aborted?n(e.request):void(e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,twoHundo.test(e.request.status)?t(e.request):n(e.request)))}}function setHeaders(e,t){var n,o=t.headers||{};o.Accept=o.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"],t.crossOrigin||o[requestedWith]||(o[requestedWith]=defaultHeaders.requestedWith),o[contentType]||(o[contentType]=t.contentType||defaultHeaders.contentType);for(n in o)o.hasOwnProperty(n)&&"setRequestHeader"in e&&e.setRequestHeader(n,o[n])}function setCredentials(e,t){"undefined"!=typeof t.withCredentials&&"undefined"!=typeof e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,o){var i=uniqid++,s=e.jsonpCallback||"callback",r=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),a=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),c=o.match(a),l=doc.createElement("script"),u=0,d=-1!==navigator.userAgent.indexOf("MSIE 10.0");return c?"?"===c[3]?o=o.replace(a,"$1="+r):r=c[3]:o=urlappend(o,s+"="+r),win[r]=generalCallback,l.type="text/javascript",l.src=o,l.async=!0,"undefined"==typeof l.onreadystatechange||d||(l.htmlFor=l.id="_reqwest_"+i),l.onload=l.onreadystatechange=function(){return l[readyState]&&"complete"!==l[readyState]&&"loaded"!==l[readyState]||u?!1:(l.onload=l.onreadystatechange=null,l.onclick&&l.onclick(),t(lastValue),lastValue=void 0,head.removeChild(l),void(u=1))},head.appendChild(l),{abort:function(){l.onload=l.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(l),u=1}}}function getRequest(e,t){var n,o=this.o,i=(o.method||"GET").toUpperCase(),s="string"==typeof o?o:o.url,r=o.processData!==!1&&o.data&&"string"!=typeof o.data?reqwest.toQueryString(o.data):o.data||null,a=!1;return"jsonp"!=o.type&&"GET"!=i||!r||(s=urlappend(s,r),r=null),"jsonp"==o.type?handleJsonp(o,e,t,s):(n=o.xhr&&o.xhr(o)||xhr(o),n.open(i,s,o.async===!1?!1:!0),setHeaders(n,o),setCredentials(n,o),win[xDomainRequest]&&n instanceof win[xDomainRequest]?(n.onload=e,n.onerror=t,n.onprogress=function(){},a=!0):n.onreadystatechange=handleReadyState(this,e,t),o.before&&o.before(n),a?setTimeout(function(){n.send(r)},200):n.send(r),n)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){return e.match("json")?"json":e.match("javascript")?"js":e.match("text")?"html":e.match("xml")?"xml":void 0}function init(o,fn){function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(e,t,n){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,n);complete(e)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n,o,i,s,r=e.name,a=e.tagName.toLowerCase(),c=function(e){e&&!e.disabled&&t(r,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(!e.disabled&&r)switch(a){case"input":/reset|button|image|file/i.test(e.type)||(n=/checkbox/i.test(e.type),o=/radio/i.test(e.type),i=e.value,(!(n||o)||e.checked)&&t(r,normalize(n&&""===i?"on":i)));break;case"textarea":t(r,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())c(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(s=0;e.length&&s<e.length;s++)e.options[s].selected&&c(e.options[s])}}function eachFormElement(){var e,t,n=this,o=function(e,t){var o,i,s;for(o=0;o<t.length;o++)for(s=e[byTag](t[o]),i=0;i<s.length;i++)serial(s[i],n)};for(t=0;t<arguments.length;t++)e=arguments[t],/input|select|textarea/i.test(e.tagName)&&serial(e,n),o(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,o){var i,s,r,a=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)r=t[s],n||a.test(e)?o(e,r):buildParams(e+"["+("object"==typeof r?s:"")+"]",r,n,o);else if(t&&"[object Object]"===t.toString())for(i in t)buildParams(e+"["+i+"]",t[i],n,o);else o(e,t)}var win=window,doc=document,twoHundo=/^(20\d|1223)$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=win[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(0===arguments.length)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),t="map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,o,i=t||!1,s=[],r=encodeURIComponent,a=function(e,t){t="function"==typeof t?t():null==t?"":t,s[s.length]=r(e)+"="+r(t)};if(isArray(e))for(o=0;e&&o<e.length;o++)a(e[o].name,e[o].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],i,a);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest}),define("common/utils/ajax",["reqwest"],function(e){function t(e){return e.url.match("^https?://")||(e.url=n(e.url)),t.reqwest(e)}var n=function(){throw new Error("AJAX has not been initialised yet")},o=function(){throw new Error("Edition has not been initialised yet")};return t.reqwest=e,t.init=function(e){o=e.page.edition,n=function(t){return e.page.ajaxUrl+t}},t}),define("common/utils/storage",["common/utils/mediator"],function(e){var t=window,n=function(e){this.type=e};return n.prototype.setWindow=function(e){t=e},n.prototype.isAvailable=function(n){var o="local-storage-module-test",i=n||"test";try{return t[this.type].setItem(o,i),t[this.type].removeItem(o),!0}catch(s){return e.emit("module:error","Unable to save to local storage: "+s.message,"common/utils/storage.js"),!1}},n.prototype.set=function(e,n,o){var i=o||{},s=JSON.stringify({value:n,expires:i.expires});return this.isAvailable(s)?t[this.type].setItem(e,s):!1},n.prototype.get=function(e){var n=t[this.type].getItem(e);if(null===n)return null;var o;try{o=JSON.parse(n)}catch(i){return this.remove(e),null}return o.expires&&new Date>new Date(o.expires)?(this.remove(e),null):o.value},n.prototype.remove=function(e){return t[this.type].removeItem(e)},n.prototype.removeAll=function(){return t[this.type].clear()},n.prototype.length=function(){return t[this.type].length},n.prototype.getKey=function(e){return t[this.type].key(e)},n.prototype.clearByPrefix=function(e){for(var t=this.length()-1;t>-1;--t){var n=this.getKey(t);0===n.indexOf(e)&&this.remove(n)}},{local:new n("localStorage"),session:new n("sessionStorage")}}),define("common/modules/userPrefs",["common/utils/storage"],function(e){function t(e,t){f.set(m+e,t)}function n(e){return f.get(m+e)}function o(e){f.remove(m+e)}function i(e){f.set(m+"switch."+e,!0)}function s(e){f.set(m+"switch."+e,!1)}function r(e){f.remove(m+"switch."+e)}function a(e){return f.get(m+"switch."+e)===!0}function c(e){return f.get(m+"switch."+e)===!1}function l(e){return!isNaN(e)}function u(e){return"true"===e||"false"===e}function d(e){for(var n=e.hash.substr(1).split("&"),o=0,r=n.length;r>o;++o){var a=n[o].match(/^gu\.prefs\.(.*)=(.*)$/);if(a){var c=a[1],d=a[2];switch(c){case"switchOn":i(d);break;case"switchOff":s(d);break;default:var m=l(d)?+d:u(d)?"true"===String(d).toLowerCase():d;t(c,m)}}}}var m="gu.prefs.",f=e.local;return d(window.location),{set:t,get:n,remove:o,switchOn:i,switchOff:s,removeSwitch:r,isOn:a,isOff:c,setPrefs:d}}),function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define("bonzo",n):t[e]=n()}("bonzo",this,function(){function e(e,t){var n=null,o=j.defaultView.getComputedStyle(e,"");return o&&(n=o[t]),e.style[t]||n}function t(e){return e&&e.nodeName&&(1==e.nodeType||11==e.nodeType)}function n(e,n,o){var i,s,r;if("string"==typeof e)return k.create(e);if(t(e)&&(e=[e]),o){for(r=[],i=0,s=e.length;s>i;i++)r[i]=y(n,e[i]);return r}return e}function o(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)")}function i(e,t,n,o){for(var i,s=0,r=e.length;r>s;s++)i=o?e.length-s-1:s,t.call(n||e[i],e[i],i,e);return e}function s(e,n,o){for(var i=0,r=e.length;r>i;i++)t(e[i])&&(s(e[i].childNodes,n,o),n.call(o||e[i],e[i],i,e));return e}function r(e){return e.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}function a(e){return e?e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase():e}function c(e){e[$]("data-node-uid")||e[z]("data-node-uid",++R);var t=e[$]("data-node-uid");return U[t]||(U[t]={})}function l(e){var t=e[$]("data-node-uid");t&&delete U[t]}function u(e){var t;try{return null===e||void 0===e?void 0:"true"===e?!0:"false"===e?!1:"null"===e?null:(t=parseFloat(e))==e?t:e}catch(n){}return void 0}function d(e,t,n){for(var o=0,i=e.length;i>o;++o)if(t.call(n||null,e[o],o,e))return!0;return!1}function m(e){return"transform"==e&&(e=G.transform)||/^transform-?[Oo]rigin$/.test(e)&&(e=G.transform+"Origin"),e?r(e):null}function f(e,t,o,s){var r=0,a=t||this,c=[],l=Q&&"string"==typeof e&&"<"!=e.charAt(0)?Q(e):e;return i(n(l),function(e,t){i(a,function(n){o(e,c[r++]=t>0?y(a,n):n)},null,s)},this,s),a.length=r,i(c,function(e){a[--r]=e},null,!s),a}function p(e,t,n){var o=k(e),i=o.css("position"),s=o.offset(),r="relative",a=i==r,c=[parseInt(o.css("left"),10),parseInt(o.css("top"),10)];"static"==i&&(o.css("position",r),i=r),isNaN(c[0])&&(c[0]=a?0:e.offsetLeft),isNaN(c[1])&&(c[1]=a?0:e.offsetTop),null!=t&&(e.style.left=t-s.left+c[0]+H),null!=n&&(e.style.top=n-s.top+c[1]+H)}function h(e,t){return"function"==typeof t?t.call(e,e):t}function g(e,t,n){var o=this[0];return o?null==e&&null==t?(b(o)?w():{x:o.scrollLeft,y:o.scrollTop})[n]:(b(o)?S.scrollTo(e,t):(null!=e&&(o.scrollLeft=e),null!=t&&(o.scrollTop=t)),this):this}function v(e){if(this.length=0,e){e="string"==typeof e||e.nodeType||"undefined"==typeof e.length?[e]:e,this.length=e.length;for(var t=0;t<e.length;t++)this[t]=e[t]}}function y(e,t){var n,o,i,s=t.cloneNode(!0);if(e.$&&"function"==typeof e.cloneEvents)for(e.$(s).cloneEvents(t),n=e.$(s).find("*"),o=e.$(t).find("*"),i=0;i<o.length;i++)e.$(n[i]).cloneEvents(o[i]);return s}function b(e){return e===S||/^(?:body|html)$/i.test(e.tagName)}function w(){return{x:S.pageXOffset||E.scrollLeft,y:S.pageYOffset||E.scrollTop}}function _(e){var t=document.createElement("script"),n=e.match(L);return t.src=n[1],t}function k(e){return new v(e)}var x,C,T,S=window,j=S.document,E=j.documentElement,A="parentNode",O=/^(checked|value|selected|disabled)$/i,I=/^(select|fieldset|table|tbody|tfoot|td|tr|colgroup)$/i,L=/\s*<script +src=['"]([^'"]+)['"]>/,q=["<table>","</table>",1],D=["<table><tbody><tr>","</tr></tbody></table>",3],N=["<select>","</select>",1],M=["_","",0,1],F={thead:q,tbody:q,tfoot:q,colgroup:q,caption:q,tr:["<table><tbody>","</tbody></table>",2],th:D,td:D,col:["<table><colgroup>","</colgroup></table>",2],fieldset:["<form>","</form>",1],legend:["<form><fieldset>","</fieldset></form>",2],option:N,optgroup:N,script:M,style:M,link:M,param:M,base:M},P=/^(checked|selected|disabled)$/,U={},R=0,V=/^-?[\d\.]+$/,B=/^data-(.+)$/,H="px",z="setAttribute",$="getAttribute",G=function(){var e=j.createElement("p");return{transform:function(){var t,n=["transform","webkitTransform","MozTransform","OTransform","msTransform"];for(t=0;t<n.length;t++)if(n[t]in e.style)return n[t]}(),classList:"classList"in e}}(),W=/\s+/,Y=String.prototype.toString,K={lineHeight:1,zoom:1,zIndex:1,opacity:1,boxFlex:1,WebkitBoxFlex:1,MozBoxFlex:1},Q=j.querySelectorAll&&function(e){return j.querySelectorAll(e)};return G.classList?(x=function(e,t){return e.classList.contains(t)},C=function(e,t){e.classList.add(t)},T=function(e,t){e.classList.remove(t)}):(x=function(e,t){return o(t).test(e.className)},C=function(e,t){e.className=(e.className+" "+t).trim()},T=function(e,t){e.className=e.className.replace(o(t)," ").trim()}),v.prototype={get:function(e){return this[e]||null},each:function(e,t){return i(this,e,t)},deepEach:function(e,t){return s(this,e,t)},map:function(e,t){var n,o,i=[];for(o=0;o<this.length;o++)n=e.call(this,this[o],o),t?t(n)&&i.push(n):i.push(n);return i},html:function(e,t){var o=t?"textContent":"innerHTML",s=this,r=function(t,o){i(n(e,s,o),function(e){t.appendChild(e)})},a=function(n,i){try{if(t||"string"==typeof e&&!I.test(n.tagName))return n[o]=e}catch(s){}r(n,i)};return"undefined"!=typeof e?this.empty().each(a):this[0]?this[0][o]:""},text:function(e){return this.html(e,!0)},append:function(e){var t=this;return this.each(function(o,s){i(n(e,t,s),function(e){o.appendChild(e)})})},prepend:function(e){var t=this;return this.each(function(o,s){var r=o.firstChild;i(n(e,t,s),function(e){o.insertBefore(e,r)})})},appendTo:function(e,t){return f.call(this,e,t,function(e,t){e.appendChild(t)})},prependTo:function(e,t){return f.call(this,e,t,function(e,t){e.insertBefore(t,e.firstChild)},1)},before:function(e){var t=this;return this.each(function(o,s){i(n(e,t,s),function(e){o[A].insertBefore(e,o)})})},after:function(e){var t=this;return this.each(function(o,s){i(n(e,t,s),function(e){o[A].insertBefore(e,o.nextSibling)},null,1)})},insertBefore:function(e,t){return f.call(this,e,t,function(e,t){e[A].insertBefore(t,e)})},insertAfter:function(e,t){return f.call(this,e,t,function(e,t){var n=e.nextSibling;n?e[A].insertBefore(t,n):e[A].appendChild(t)},1)},replaceWith:function(e){var t=this;return this.each(function(o,s){i(n(e,t,s),function(e){o[A]&&o[A].replaceChild(e,o)})})},clone:function(e){var t,n,o=[];for(n=0,t=this.length;t>n;n++)o[n]=y(e||this,this[n]);return k(o)},addClass:function(e){return e=Y.call(e).split(W),this.each(function(t){i(e,function(e){e&&!x(t,h(t,e))&&C(t,h(t,e))})})},removeClass:function(e){return e=Y.call(e).split(W),this.each(function(t){i(e,function(e){e&&x(t,h(t,e))&&T(t,h(t,e))
})})},hasClass:function(e){return e=Y.call(e).split(W),d(this,function(t){return d(e,function(e){return e&&x(t,e)})})},toggleClass:function(e,t){return e=Y.call(e).split(W),this.each(function(n){i(e,function(e){e&&("undefined"!=typeof t?t?!x(n,e)&&C(n,e):T(n,e):x(n,e)?T(n,e):C(n,e))})})},show:function(e){return e="string"==typeof e?e:"",this.each(function(t){t.style.display=e})},hide:function(){return this.each(function(e){e.style.display="none"})},toggle:function(e,t){return t="string"==typeof t?t:"","function"!=typeof e&&(e=null),this.each(function(n){n.style.display=n.offsetWidth||n.offsetHeight?"none":t,e&&e.call(n)})},first:function(){return k(this.length?this[0]:[])},last:function(){return k(this.length?this[this.length-1]:[])},next:function(){return this.related("nextSibling")},previous:function(){return this.related("previousSibling")},parent:function(){return this.related(A)},related:function(e){return k(this.map(function(t){for(t=t[e];t&&1!==t.nodeType;)t=t[e];return t||0},function(e){return e}))},focus:function(){return this.length&&this[0].focus(),this},blur:function(){return this.length&&this[0].blur(),this},css:function(t,n){function o(e,t,n){for(var o in s)if(s.hasOwnProperty(o)){n=s[o],(t=m(o))&&V.test(n)&&!(t in K)&&(n+=H);try{e.style[t]=h(e,n)}catch(i){}}}var i,s=t;return void 0===n&&"string"==typeof t?(n=this[0],n?n===j||n===S?(i=n===j?k.doc():k.viewport(),"width"==t?i.width:"height"==t?i.height:""):(t=m(t))?e(n,t):null:null):("string"==typeof t&&(s={},s[t]=n),this.each(o))},offset:function(e,t){if(e&&"object"==typeof e&&("number"==typeof e.top||"number"==typeof e.left))return this.each(function(t){p(t,e.left,e.top)});if("number"==typeof e||"number"==typeof t)return this.each(function(n){p(n,e,t)});if(!this[0])return{top:0,left:0,height:0,width:0};var n=this[0],o=n.ownerDocument.documentElement,i=n.getBoundingClientRect(),s=w(),r=n.offsetWidth,a=n.offsetHeight,c=i.top+s.y-Math.max(0,o&&o.clientTop,j.body.clientTop),l=i.left+s.x-Math.max(0,o&&o.clientLeft,j.body.clientLeft);return{top:c,left:l,height:a,width:r}},dim:function(){if(!this.length)return{height:0,width:0};var e=this[0],t=9==e.nodeType&&e.documentElement,n=t||!e.style||e.offsetWidth||e.offsetHeight?null:function(t){var n={position:e.style.position||"",visibility:e.style.visibility||"",display:e.style.display||""};return t.first().css({position:"absolute",visibility:"hidden",display:"block"}),n}(this),o=t?Math.max(e.body.scrollWidth,e.body.offsetWidth,t.scrollWidth,t.offsetWidth,t.clientWidth):e.offsetWidth,i=t?Math.max(e.body.scrollHeight,e.body.offsetHeight,t.scrollHeight,t.offsetHeight,t.clientHeight):e.offsetHeight;return n&&this.first().css(n),{height:i,width:o}},attr:function(e,t){var n,o=this[0];if("string"!=typeof e&&!(e instanceof String)){for(n in e)e.hasOwnProperty(n)&&this.attr(n,e[n]);return this}return"undefined"==typeof t?o?O.test(e)?P.test(e)&&"string"==typeof o[e]?!0:o[e]:o[$](e):null:this.each(function(n){O.test(e)?n[e]=h(n,t):n[z](e,h(n,t))})},removeAttr:function(e){return this.each(function(t){P.test(e)?t[e]=!1:t.removeAttribute(e)})},val:function(e){return"string"==typeof e||"number"==typeof e?this.attr("value",e):this.length?this[0].value:null},data:function(e,t){var n,o,s=this[0];return"undefined"==typeof t?s?(n=c(s),"undefined"==typeof e?(i(s.attributes,function(e){(o=(""+e.name).match(B))&&(n[r(o[1])]=u(e.value))}),n):("undefined"==typeof n[e]&&(n[e]=u(this.attr("data-"+a(e)))),n[e])):null:this.each(function(n){c(n)[e]=t})},remove:function(){return this.deepEach(l),this.detach()},empty:function(){return this.each(function(e){for(s(e.childNodes,l);e.firstChild;)e.removeChild(e.firstChild)})},detach:function(){return this.each(function(e){e[A]&&e[A].removeChild(e)})},scrollTop:function(e){return g.call(this,null,e,"y")},scrollLeft:function(e){return g.call(this,e,null,"x")}},k.setQueryEngine=function(e){Q=e,delete k.setQueryEngine},k.aug=function(e,t){for(var n in e)e.hasOwnProperty(n)&&((t||v.prototype)[n]=e[n])},k.create=function(e){return"string"==typeof e&&""!==e?function(){if(L.test(e))return[_(e)];var t=e.match(/^\s*<([^\s>]+)/),n=j.createElement("div"),o=[],s=t?F[t[1].toLowerCase()]:null,r=s?s[2]+1:1,a=s&&s[3],c=A;for(n.innerHTML=s?s[0]+e+s[1]:e;r--;)n=n.firstChild;a&&n&&1!==n.nodeType&&(n=n.nextSibling);do t&&1!=n.nodeType||o.push(n);while(n=n.nextSibling);return i(o,function(e){e[c]&&e[c].removeChild(e)}),o}():t(e)?[e.cloneNode(!0)]:[]},k.doc=function(){var e=k.viewport();return{width:Math.max(j.body.scrollWidth,E.scrollWidth,e.width),height:Math.max(j.body.scrollHeight,E.scrollHeight,e.height)}},k.firstChild=function(e){for(var t,n=e.childNodes,o=0,i=n&&n.length||0;i>o;o++)1===n[o].nodeType&&(t=n[i=o]);return t},k.viewport=function(){return{width:S.innerWidth,height:S.innerHeight}},k.isAncestor="compareDocumentPosition"in E?function(e,t){return 16==(16&e.compareDocumentPosition(t))}:function(e,t){return e!==t&&e.contains(t)},k}),function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define("qwery",n):t[e]=n()}("qwery",this,function(){function e(e){return[].slice.call(e,0)}function t(e){var t;return e&&"object"==typeof e&&(t=e.nodeType)&&(1==t||9==t)}function n(e){var t,n,o=[];e:for(t=0;t<e.length;t++){for(n=0;n<o.length;n++)if(o[n]==e[t])continue e;o[o.length]=e[t]}return o}function o(n,r){var c,l="string"==typeof r?o(r)[0]:r||s;return l=isFinite(l.length)&&l[0]&&!l.nodeName?l[0]:l,l&&n?s.getElementsByClassName&&"string"==n&&(c=n.match(i))?e(l.getElementsByClassName(c[1])):n&&(n.document||n.nodeType&&9==n.nodeType)?r?[]:[n]:t(n)?!r||a(n,l)?[n]:[]:e(l.querySelectorAll(n)):[]}var i=/^\.([\w\-]+)$/,s=document,r=s.documentElement,a="compareDocumentPosition"in r?function(e,t){return 16==(16&t.compareDocumentPosition(e))}:function(e,t){return t=t==s||t==window?r:t,t!==e&&t.contains(e)};return o.uniq=n,o},this),define("common/$",["bonzo","qwery"],function(e,t){function n(n,o){return e(t(n,o))}return n}),define("common/utils/deferToLoad",[],function(){function e(e){"complete"===document.readyState?e():window.addEventListener("load",function(){e()})}return e}),define("lodash/internals/isNative",[],function(){function e(e){return"function"==typeof e&&o.test(e)}var t=Object.prototype,n=t.toString,o=RegExp("^"+String(n).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return e}),define("lodash/internals/objectTypes",[],function(){var e={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};return e}),define("lodash/objects/isObject",["../internals/objectTypes"],function(e){function t(t){return!(!t||!e[typeof t])}return t}),define("lodash/utilities/noop",[],function(){function e(){}return e}),define("lodash/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(e,t){function n(e){return t(e)?o(e):{}}var o=e(o=Object.create)&&o;return o||(n=function(){function e(){}return function(n){if(t(n)){e.prototype=n;var o=new e;e.prototype=null}return o||window.Object()}}()),n}),define("lodash/internals/setBindData",["./isNative","../utilities/noop"],function(e,t){var n={configurable:!1,enumerable:!1,value:null,writable:!1},o=function(){try{var t={},n=e(n=Object.defineProperty)&&n,o=n(t,t,t)&&n}catch(i){}return o}(),i=o?function(e,t){n.value=t,o(e,"__bindData__",n)}:t;return i}),define("lodash/internals/slice",[],function(){function e(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var o=-1,i=n-t||0,s=Array(0>i?0:i);++o<i;)s[o]=e[t+o];return s}return e}),define("lodash/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(e,t,n,o){function i(i){function s(){if(c){var n=o(c);r.apply(n,arguments)}if(this instanceof s){var i=e(a.prototype),u=a.apply(i,n||arguments);return t(u)?u:i}return a.apply(l,n||arguments)}var a=i[0],c=i[2],l=i[4];return n(s,i),s}var s=[],r=s.push;return i}),define("lodash/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(e,t,n,o){function i(s){function a(){var n=p?m:this;if(u){var s=o(u);r.apply(s,arguments)}if((d||g)&&(s||(s=o(arguments)),d&&r.apply(s,d),g&&s.length<f))return l|=16,i([c,v?l:-4&l,s,null,m,f]);if(s||(s=arguments),h&&(c=n[y]),this instanceof a){n=e(c.prototype);var b=c.apply(n,s);return t(b)?b:n}return c.apply(n,s)}var c=s[0],l=s[1],u=s[2],d=s[3],m=s[4],f=s[5],p=1&l,h=2&l,g=4&l,v=8&l,y=c;return n(a,s),a}var s=[],r=s.push;return i}),define("lodash/objects/isFunction",[],function(){function e(e){return"function"==typeof e}return e}),define("lodash/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(e,t,n,o){function i(s,c,l,u,d,m){var f=1&c,p=2&c,h=4&c,g=16&c,v=32&c;if(!p&&!n(s))throw new TypeError;g&&!l.length&&(c&=-17,g=l=!1),v&&!u.length&&(c&=-33,v=u=!1);var y=s&&s.__bindData__;if(y&&y!==!0)return y=o(y),y[2]&&(y[2]=o(y[2])),y[3]&&(y[3]=o(y[3])),!f||1&y[1]||(y[4]=d),!f&&1&y[1]&&(c|=8),!h||4&y[1]||(y[5]=m),g&&r.apply(y[2]||(y[2]=[]),l),v&&a.apply(y[3]||(y[3]=[]),u),y[1]|=c,i.apply(null,y);var b=1==c||17===c?e:t;return b([s,c,l,u,d,m])}var s=[],r=s.push,a=s.unshift;return i}),define("lodash/functions/bind",["../internals/createWrapper","../internals/slice"],function(e,t){function n(n,o){return arguments.length>2?e(n,17,t(arguments,2),null,o):e(n,1,null,null,o)}return n}),define("lodash/utilities/identity",[],function(){function e(e){return e}return e}),define("lodash/support",["./internals/isNative"],function(e){var t=/\bthis\b/,n={};return n.funcDecomp=!e(window.WinRTError)&&t.test(function(){return this}),n.funcNames="string"==typeof Function.name,n}),define("lodash/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(e,t,n,o){function i(i,c,l){if("function"!=typeof i)return t;if("undefined"==typeof c||!("prototype"in i))return i;var u=i.__bindData__;if("undefined"==typeof u&&(o.funcNames&&(u=!i.name),u=u||!o.funcDecomp,!u)){var d=a.call(i);o.funcNames||(u=!s.test(d)),u||(u=r.test(d),n(i,u))}if(u===!1||u!==!0&&1&u[1])return i;switch(l){case 1:return function(e){return i.call(c,e)};case 2:return function(e,t){return i.call(c,e,t)};case 3:return function(e,t,n){return i.call(c,e,t,n)};case 4:return function(e,t,n,o){return i.call(c,e,t,n,o)}}return e(i,c)}var s=/^\s*function[ \n\r\t]+\w/,r=/\bthis\b/,a=Function.prototype.toString;return i}),define("lodash/internals/shimKeys",["./objectTypes"],function(e){var t=Object.prototype,n=t.hasOwnProperty,o=function(t){var o,i=t,s=[];if(!i)return s;if(!e[typeof t])return s;for(o in i)n.call(i,o)&&s.push(o);return s};return o}),define("lodash/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(e,t,n){var o=e(o=Object.keys)&&o,i=o?function(e){return t(e)?o(e):[]}:n;return i}),define("lodash/objects/assign",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(e,t,n){var o=function(o,i,s){var r,a=o,c=a;if(!a)return c;var l=arguments,u=0,d="number"==typeof s?2:l.length;if(d>3&&"function"==typeof l[d-2])var m=e(l[--d-1],l[d--],2);else d>2&&"function"==typeof l[d-1]&&(m=l[--d]);for(;++u<d;)if(a=l[u],a&&n[typeof a])for(var f=-1,p=n[typeof a]&&t(a),h=p?p.length:0;++f<h;)r=p[f],c[r]=m?m(c[r],a[r]):a[r];return c};return o}),define("lodash/utilities/now",["../internals/isNative"],function(e){var t=e(t=Date.now)&&t||function(){return(new Date).getTime()};return t}),define("lodash/functions/debounce",["../objects/isFunction","../objects/isObject","../utilities/now"],function(e,t,n){function o(o,r,a){var c,l,u,d,m,f,p,h=0,g=!1,v=!0;if(!e(o))throw new TypeError;if(r=s(0,r)||0,a===!0){var y=!0;v=!1}else t(a)&&(y=a.leading,g="maxWait"in a&&(s(r,a.maxWait)||0),v="trailing"in a?a.trailing:v);var b=function(){var e=r-(n()-d);if(0>=e){l&&clearTimeout(l);var t=p;l=f=p=i,t&&(h=n(),u=o.apply(m,c),f||l||(c=m=null))}else f=setTimeout(b,e)},w=function(){f&&clearTimeout(f),l=f=p=i,(v||g!==r)&&(h=n(),u=o.apply(m,c),f||l||(c=m=null))};return function(){if(c=arguments,d=n(),m=this,p=v&&(f||!y),g===!1)var e=y&&!f;else{l||y||(h=d);var t=g-(d-h),i=0>=t;i?(l&&(l=clearTimeout(l)),h=d,u=o.apply(m,c)):l||(l=setTimeout(w,t))}return i&&f?f=clearTimeout(f):f||r===g||(f=setTimeout(b,r)),e&&(i=!0,u=o.apply(m,c)),!i||f||l||(c=m=null),u}}var i,s=Math.max;return o}),define("lodash/functions/throttle",["./debounce","../objects/isFunction","../objects/isObject"],function(e,t,n){function o(o,s,r){var a=!0,c=!0;if(!t(o))throw new TypeError;return r===!1?a=!1:n(r)&&(a="leading"in r?r.leading:a,c="trailing"in r?r.trailing:c),i.leading=a,i.maxWait=s,i.trailing=c,e(o,s,i)}var i={leading:!1,maxWait:0,trailing:!1};return o}),define("common/utils/to-array",[],function(){function e(e){return Array.prototype.slice.call(e)}return e}),define("common/utils/lazy-load-css",["bonzo"],function(e){function t(t){e(document.createElement("link")).attr("rel","stylesheet").attr("type","text/css").attr("href",guardian.css[t]).appendTo(document.querySelector("body"))}return t}),define("common/utils/atob",[],function(){return window.atob?function(e){return window.atob(e)}:function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(){try{document.createElement("$")}catch(e){return e}}();return function(n){if(n=n.replace(/[=]+$/,""),n.length%4===1)throw t;for(var o,i,s=0,r=0,a="";i=n.charAt(r++);~i&&(o=s%4?64*o+i:i,s++%4)?a+=String.fromCharCode(255&o>>(-2*s&6)):0)i=e.indexOf(i);return a}}()}),define("common/utils/request-animation-frame",[],function(){function e(e){for(var t=0,n=["ms","moz","webkit","o"],o=0;o<n.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[n[o]+"RequestAnimationFrame"];window.requestAnimationFrame?window.requestAnimationFrame(e):window.requestAnimationFrame=function(e){var n=(new Date).getTime(),o=Math.max(0,16-(n-t)),i=window.setTimeout(function(){e(n+o)},o);return t=n+o,i}}return e}),define("common/common",["common/$","common/utils/mediator","common/utils/deferToLoad","lodash/objects/assign","lodash/functions/debounce","lodash/functions/throttle","common/utils/to-array","common/utils/lazy-load-css","common/utils/atob","common/utils/request-animation-frame"],function(e,t,n,o,i,s,r,a,c,l){return{mediator:t,$g:e,deferToLoadEvent:n,extend:o,debounce:i,rateLimit:s,toArray:r,lazyLoadCss:a,atob:c,requestAnimationFrame:l}}),define("common/utils/detect",["common/modules/userPrefs","common/common"],function(e,t){function n(){var e=u();return function(t){var n=u();n!==e&&(e=n,t(n))}}function o(e){var t,n,o,i=e||window.performance||window.msPerformance||window.webkitPerformance||window.mozPerformance;return i&&i.timing&&(t=i.timing.requestStart||i.timing.fetchStart||i.timing.navigationStart,n=i.timing.responseEnd,t&&n&&(o=n-t)),o}function i(e,t,n){t=t||navigator.connection||navigator.mozConnection||navigator.webkitConnection||{type:"unknown"};var i=3===t.type||4===t.type||/^[23]g$/.test(t.type);if(i)return"low";var s=o(e),r="high";return n&&(r="unknown"),s&&s>1e3&&(r="medium",s>3e3&&(r="low")),r}function s(e){var t="woff";return e=e.toLowerCase(),e.indexOf("android")>-1&&(t="ttf"),t}function r(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch}function a(){return void 0!==p?p:(window.history&&history.pushState&&(p=!0,window.navigator.userAgent.match(/Android/i)&&(p=!!window.navigator.userAgent.match(/(Chrome|Firefox)/i))),p)}function c(){var e=document.createElement("video"),t={};try{e.canPlayType&&(t.mp4=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),t.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),t.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(n){}return t}function l(){return window.innerHeight>window.innerWidth?"portrait":"landscape"}function u(){var e=document.body&&window.getComputedStyle(document.body,":after").getPropertyValue("content")||"mobile";return e.replace(/^"([^"]*)"$/,"$1")}function d(){function e(e){var o="visible",i="hidden",s={focus:o,focusin:o,pageshow:o,blur:i,focusout:i,pagehide:i};e=e||window.event,h=e.type in s?s[e.type]:this[n]?"hidden":"visible",t.mediator.emit("modules:detect:pagevisibility:"+h)}var n="hidden";n in document?document.addEventListener("visibilitychange",e):(n="mozHidden")in document?document.addEventListener("mozvisibilitychange",e):(n="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e):(n="msHidden")in document?document.addEventListener("msvisibilitychange",e):"onfocusin"in document?document.onfocusin=document.onfocusout=e:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e}function m(){return"visible"===h?!0:!1}function f(){return"WebSocket"in window}var p,h=document.visibilityState||document.webkitVisibilityState||document.mozVisibilityState||document.msVisibilityState||"visible";return{hasCrossedBreakpoint:n,getConnectionSpeed:i,getFontFormatSupport:s,getVideoFormatSupport:c,hasTouchScreen:r,hasPushStateSupport:a,getOrientation:l,getBreakpoint:u,initPageVisibility:d,pageVisible:m,hasWebSocket:f}}),define("common/utils/config",["lodash/objects/assign"],function(e){var t=function(e,t){for(var n=""+e;n.length<t;)n="0"+n;return n},n=guardian.config;return e({hasTone:function(e){return(n.page.tones||"").indexOf(e)>-1},hasSeries:function(e){return(n.page.series||"").indexOf(e)>-1},referencesOfType:function(e){return(n.page.references||[]).filter(function(t){return"undefined"!=typeof t[e]}).map(function(t){return t[e]})},referenceOfType:function(e){return this.referencesOfType(e)[0]},webPublicationDateAsUrlPart:function(){if(this.page.webPublicationDate){var e=new Date(this.page.webPublicationDate);return e.getFullYear()+"/"+t(e.getMonth()+1,2)+"/"+t(e.getDate(),2)}}},n)}),define("common/utils/context",[],function(){var e=document.body,t=function(){return e};return t.set=function(t){e=t},t}),define("common/utils/userTiming",[],function(){function e(e){t&&"mark"in t&&t.mark("gu."+e)}var t=window.performance||window.msPerformance||window.webkitPerformance||window.mozPerformance;return{mark:e}}),define("common/modules/analytics/beacon",["common/utils/config"],function(e){return{fire:function(t){if(!e.page.isSSL){var n=new Image;n.src=e.page.beaconUrl+t}}}}),define("common/modules/analytics/errors",["common/modules/userPrefs","common/modules/analytics/beacon"],function(e,t){var n=function(n){var o=n||{},i=void 0!==o.isDev?o.isDev:!1,s=o.console||window.console,r=o.window||window,a=o.userPrefs||e,c=o.buildNumber||"unknown",l=function(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return"/js.gif?"+t.join("&")},u=function(e,n,o,r){"[object Event]"===e.toString()&&e.target instanceof HTMLScriptElement&&(e="Syntax or http error: "+e.target.src);var u="js";("common/modules/adverts/documentwriteslot.js"===n||"Script error."===e)&&(u="ads");var d={message:e,filename:n,lineno:o,build:c,type:u};return i?(r!==!0&&s.error(d),!1):(t.fire(l(d)),a.isOn("showErrors")?!1:!0)},d=function(){r.onerror=function(e,t,n){return u(e,t,n,!0)}};return{log:u,init:d}};return n}),define("common/modules/ui/fonts",["common/utils/ajax","common/common","common/utils/storage"],function(e,t,n){function o(o,i){function s(e){var t=e.getAttribute("data-cache-file-woff").match(/fonts\/(.*)\.woff(?:\.(.*))?\.json$/);return t.shift(),t}function r(e){if(n.local.isAvailable()){var t=s(e),o=n.local.get(a+t[0]+"."+t[1]),i=!0,r=e.getAttribute("data-min-width");return r&&parseInt(r,10)>=window.innerWidth&&(i=!1),null===o&&i}return!1}var a="gu.fonts.";this.ajax=e,this.view={showFont:function(e,t){e.innerHTML=t.css}},this.loadFromServer=function(e,c){e=e||"";for(var l=0,u=o.length;u>l;++l){var d=o[l];if(r(d)){var m=this;this.ajax({url:e+d.getAttribute("data-cache-file-"+i),type:"jsonp",jsonpCallbackName:"guFont",success:function(e){return function(o){if(!o)return void t.mediator.emit("module:error","Failed to load fonts","fonts.js");"function"==typeof c&&c(e,o);var i=s(e);m.clearFont(i[0]),n.local.set(a+i[0]+"."+i[1],o.css),t.mediator.emit("modules:fonts:loaded",[o.name])}}(d)})}else t.mediator.emit("modules:fonts:notloaded",[])}},this.loadFromServerAndApply=function(e){var t=this;this.loadFromServer(e,function(e,n){t.view.showFont(e,n)})},this.clearFont=function(e){n.local.clearByPrefix(a+e)},this.clearAllFontsFromStorage=function(){n.local.clearByPrefix(a)}}return o}),define("common/utils/cookies",[],function(){function e(e){for(var t=0,n=e.length;n>t;++t)o(e[t])}function t(){return document.domain.replace(/^(www|dev)\./,".")}function n(e){t()!==document.domain&&e.forEach(function(e){s(e).length>1&&o(e)})}function o(e){document.cookie=e+"=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function i(e,n,o){var i=new Date;o?i.setDate(i.getDate()+o):(i.setMonth(i.getMonth()+5),i.setDate(1)),document.cookie=e+"="+n+"; path=/; expires="+i.toUTCString()+"; domain="+t()+";"}function s(e){var t=[],n=e+"=",o=document.cookie.split(";");return o.forEach(function(e){for(;" "===e.charAt(0);)e=e.substring(1,e.length);0===e.indexOf(n)&&t.push(e.substring(n.length,e.length))}),t}function r(e){var t=s(e);return t.length>0?t[0]:null}return{cleanUp:e,cleanUpDuplicates:n,add:i,remove:o,get:r}}),define("common/modules/asyncCallMerger",[],function(){function e(e){function t(){r=arguments,s="complete";for(var e=0;e<i.length;e++)i[e].apply(null,r)}function n(n){"init"===s?(s="waiting",i.push(n),e(t)):"waiting"===s?i.push(n):n.apply(null,r)}function o(){i=[],s="init",r=null}var i,s,r;return o(),n.reset=o,n}return{mergeCalls:e}}),define("common/modules/identity/api",["common/utils/atob","common/utils/cookies","common/utils/storage","common/utils/ajax","common/modules/asyncCallMerger"],function(e,t,n,o,i){var s={},r=null;return s.cookieName="GU_U",s.signOutCookieName="GU_SO",s.fbCheckKey="gu.id.nextFbCheck",s.idApiRoot=null,s.idUrl=null,s.init=function(e){s.idApiRoot=e.page.idApiUrl,s.idUrl=e.page.idUrl},s.reset=function(){s.getUserFromApi.reset(),r=null},s.getUserFromCookie=function(){if(null===r){var e=t.get(s.cookieName),n=e?JSON.parse(s.decodeBase64(e.split(".")[0])):null;n&&(r={id:n[0],primaryEmailAddress:n[1],displayName:n[2],accountCreatedDate:n[6],emailVerified:n[7],rawResponse:e})}return r},s.getCookie=function(){return t.get(s.cookieName)},s.isUserLoggedIn=function(){return null!==s.getUserFromCookie()},s.getUrl=function(){return s.idUrl},s.getUserFromApi=i.mergeCalls(function(e){s.isUserLoggedIn()?o({url:s.idApiRoot+"/user/me",type:"jsonp",crossOrigin:!0}).then(function(t){e("ok"===t.status?t.user:null)}):e(null)}),s.getUserFromApiWithRefreshedCookie=function(){var e="/user/me",t=o({url:s.idApiRoot+e,type:"jsonp",data:{refreshCookie:!0}});return t},s.getUserOrSignIn=function(e){if(s.isUserLoggedIn())return s.getUserFromCookie();e=encodeURIComponent(e||document.location.href);var t=s.getUrl()+"/signin?returnUrl="+e;s.redirectTo(t)},s.redirectTo=function(e){window.location.href=e},s.decodeBase64=function(t){return decodeURIComponent(escape(e(t.replace(/-/g,"+").replace(/_/g,"/").replace(/,/g,"="))))},s.hasUserSignedOutInTheLast24Hours=function(){var e=t.get(s.signOutCookieName);return e?Math.round((new Date).getTime()/1e3)<parseInt(e,10)+86400:!1},s.shouldAutoSigninInUser=function(){var e=!!t.get(s.cookieName),o=!!n.local.get(s.fbCheckKey);return!e&&!o&&!this.hasUserSignedOutInTheLast24Hours()},s.setNextFbCheckTime=function(e){n.local.set(s.fbCheckKey,{},{expires:e})},s.emailSignup=function(e){var t="/useremails/"+s.getUserFromCookie().id+"/subscriptions",n={listId:e},i=o({url:s.idApiRoot+t,type:"jsonp",crossOrigin:!0,data:{body:JSON.stringify(n),method:"post"}});return i},s.sendValidationEmail=function(){var e="/user/send-validation-email",t=o({url:s.idApiRoot+e,type:"jsonp",crossOrigin:!0,data:{method:"post"}});return t},s}),define("common/utils/time",[],function(){return{currentDate:function(){return new Date}}}),define("common/modules/adverts/userAdTargeting",["common/utils/storage","common/modules/identity/api","common/utils/time"],function(e,t,n){function o(){if(e.local.isAvailable()){var n=e.local.get(s),o=t.getUserFromCookie();if(n){if(o&&n.userHash===o.id%9999)return n.segments;e.local.remove(s)}}return[]}function i(){e.local.isAvailable()&&null===e.local.get(s)&&t.getUserFromCookie()&&t.getUserFromApi(function(t){if(t.adData){var o=[];for(var i in t.adData)o.push(i+t.adData[i]);e.local.set(s,{segments:o,userHash:t.id%9999},{expires:n.currentDate().getTime()+864e5})}})}var s="gu.ads.userSegmentsData";return{getUserSegments:o,requestUserSegmentsFromId:i}}),define("common/modules/discussion/api",["common/common","common/utils/ajax","common/utils/cookies"],function(e,t,n){var o={root:null,clientHeader:null};return o.init=function(e){o.root="https:"===document.location.protocol?e.page.secureDiscussionApiRoot:e.page.discussionApiRoot,o.clientHeader=e.page.discussionApiClientHeader},o.send=function(e,i,s){s=s||{},n.get("GU_U")&&(s.GU_U=n.get("GU_U"));var r=t({url:o.root+e,type:"get"===i?"jsonp":"json",method:i,crossOrigin:!0,data:s,headers:{"D2-X-UID":"zHoBy6HNKsk","GU-Client":o.clientHeader}});return r},o.postComment=function(e,t){var n="/discussion/"+e+"/comment"+(t.replyTo?"/"+t.replyTo.commentId+"/reply":"");return o.send(n,"post",t)},o.recommendComment=function(e){var t="/comment/"+e+"/recommend";return o.send(t,"post")},o.pickComment=function(e){var t="/comment/"+e+"/highlight";return o.send(t,"post")},o.unPickComment=function(e){var t="/comment/"+e+"/unhighlight";return o.send(t,"post")},o.getUser=function(e){var t="/profile/"+(e?e:"me");return o.send(t,"get")},o}),function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define("bean",n):t[e]=n()}("bean",this,function(e,t){e=e||"bean",t=t||this;var n,o=window,i=t[e],s=/[^\.]*(?=\..*)\.|.*/,r=/\..*/,a="addEventListener",c="removeEventListener",l=document||{},u=l.documentElement||{},d=u[a],m=d?a:"attachEvent",f={},p=Array.prototype.slice,h=function(e,t){return e.split(t||" ")},g=function(e){return"string"==typeof e},v=function(e){return"function"==typeof e},y="click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange message error abort scroll ",b="show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend textinputreadystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ",w=function(e,t,n){for(n=0;n<t.length;n++)t[n]&&(e[t[n]]=1);return e}({},h(y+(d?b:""))),_=function(){var e="compareDocumentPosition"in u?function(e,t){return t.compareDocumentPosition&&16===(16&t.compareDocumentPosition(e))}:"contains"in u?function(e,t){return t=9===t.nodeType||t===window?u:t,t!==e&&t.contains(e)}:function(e,t){for(;e=e.parentNode;)if(e===t)return 1;return 0},t=function(t){var n=t.relatedTarget;return n?n!==this&&"xul"!==n.prefix&&!/document/.test(this.toString())&&!e(n,this):null==n};return{mouseenter:{base:"mouseover",condition:t},mouseleave:{base:"mouseout",condition:t},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),k=function(){var e=h("altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which propertyName"),t=e.concat(h("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement")),n=t.concat(h("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis")),i=e.concat(h("char charCode key keyCode keyIdentifier keyLocation location")),s=e.concat(h("data")),r=e.concat(h("touches targetTouches changedTouches scale rotation")),a=e.concat(h("data origin source")),c=e.concat(h("state")),d=/over|out/,m=[{reg:/key/i,fix:function(e,t){return t.keyCode=e.keyCode||e.which,i}},{reg:/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,fix:function(e,n,o){return n.rightClick=3===e.which||2===e.button,n.pos={x:0,y:0},e.pageX||e.pageY?(n.clientX=e.pageX,n.clientY=e.pageY):(e.clientX||e.clientY)&&(n.clientX=e.clientX+l.body.scrollLeft+u.scrollLeft,n.clientY=e.clientY+l.body.scrollTop+u.scrollTop),d.test(o)&&(n.relatedTarget=e.relatedTarget||e[("mouseover"==o?"from":"to")+"Element"]),t}},{reg:/mouse.*(wheel|scroll)/i,fix:function(){return n}},{reg:/^text/i,fix:function(){return s}},{reg:/^touch|^gesture/i,fix:function(){return r}},{reg:/^message$/i,fix:function(){return a}},{reg:/^popstate$/i,fix:function(){return c}},{reg:/.*/,fix:function(){return e}}],f={},p=function(e,t,n){if(arguments.length&&(e=e||((t.ownerDocument||t.document||t).parentWindow||o).event,this.originalEvent=e,this.isNative=n,this.isBean=!0,e)){var i,s,r,a,c,l=e.type,u=e.target||e.srcElement;if(this.target=u&&3===u.nodeType?u.parentNode:u,n){if(c=f[l],!c)for(i=0,s=m.length;s>i;i++)if(m[i].reg.test(l)){f[l]=c=m[i].fix;break}for(a=c(e,this,l),i=a.length;i--;)!((r=a[i])in this)&&r in e&&(this[r]=e[r])}}};return p.prototype.preventDefault=function(){this.originalEvent.preventDefault?this.originalEvent.preventDefault():this.originalEvent.returnValue=!1},p.prototype.stopPropagation=function(){this.originalEvent.stopPropagation?this.originalEvent.stopPropagation():this.originalEvent.cancelBubble=!0},p.prototype.stop=function(){this.preventDefault(),this.stopPropagation(),this.stopped=!0},p.prototype.stopImmediatePropagation=function(){this.originalEvent.stopImmediatePropagation&&this.originalEvent.stopImmediatePropagation(),this.isImmediatePropagationStopped=function(){return!0}},p.prototype.isImmediatePropagationStopped=function(){return this.originalEvent.isImmediatePropagationStopped&&this.originalEvent.isImmediatePropagationStopped()},p.prototype.clone=function(e){var t=new p(this,this.element,this.isNative);return t.currentTarget=e,t},p}(),x=function(e,t){return d||t||e!==l&&e!==o?e:u},C=function(){var e=function(e,t,n,o){var i=function(n,i){return t.apply(e,o?p.call(i,n?0:1).concat(o):i)},s=function(n,o){return t.__beanDel?t.__beanDel.ft(n.target,e):o},r=n?function(e){var t=s(e,this);return n.apply(t,arguments)?(e&&(e.currentTarget=t),i(e,arguments)):void 0}:function(e){return t.__beanDel&&(e=e.clone(s(e))),i(e,arguments)};return r.__beanDel=t.__beanDel,r},t=function(t,n,o,i,s,r,a){var c,l=_[n];"unload"==n&&(o=A(O,t,n,o,i)),l&&(l.condition&&(o=e(t,o,l.condition,r)),n=l.base||n),this.isNative=c=w[n]&&!!t[m],this.customType=!d&&!c&&n,this.element=t,this.type=n,this.original=i,this.namespaces=s,this.eventType=d||c?n:"propertychange",this.target=x(t,c),this[m]=!!this.target[m],this.root=a,this.handler=e(t,o,null,r)};return t.prototype.inNamespaces=function(e){var t,n,o=0;if(!e)return!0;if(!this.namespaces)return!1;for(t=e.length;t--;)for(n=this.namespaces.length;n--;)e[t]==this.namespaces[n]&&o++;return e.length===o},t.prototype.matches=function(e,t,n){return!(this.element!==e||t&&this.original!==t||n&&this.handler!==n)},t}(),T=function(){var e={},t=function(n,o,i,s,r,a){var c=r?"r":"$";if(o&&"*"!=o){var l,u=0,d=e[c+o],m="*"==n;if(!d)return;for(l=d.length;l>u;u++)if((m||d[u].matches(n,i,s))&&!a(d[u],d,u,o))return}else for(var f in e)f.charAt(0)==c&&t(n,f.substr(1),i,s,r,a)},n=function(t,n,o,i){var s,r=e[(i?"r":"$")+n];if(r)for(s=r.length;s--;)if(!r[s].root&&r[s].matches(t,o,null))return!0;return!1},o=function(e,n,o,i){var s=[];return t(e,n,o,null,i,function(e){return s.push(e)}),s},i=function(t){var n=!t.root&&!this.has(t.element,t.type,null,!1),o=(t.root?"r":"$")+t.type;return(e[o]||(e[o]=[])).push(t),n
},s=function(n){t(n.element,n.type,null,n.handler,n.root,function(t,n,o){return n.splice(o,1),t.removed=!0,0===n.length&&delete e[(t.root?"r":"$")+t.type],!1})},r=function(){var t,n=[];for(t in e)"$"==t.charAt(0)&&(n=n.concat(e[t]));return n};return{has:n,get:o,put:i,del:s,entries:r}}(),S=function(e){n=arguments.length?e:l.querySelectorAll?function(e,t){return t.querySelectorAll(e)}:function(){throw new Error("Bean: No selector engine installed")}},j=function(e,t){if(d||!t||!e||e.propertyName=="_on"+t){var n=T.get(this,t||e.type,null,!1),o=n.length,i=0;for(e=new k(e,this,!0),t&&(e.type=t);o>i&&!e.isImmediatePropagationStopped();i++)n[i].removed||n[i].handler.call(this,e)}},E=d?function(e,t,n){e[n?a:c](t,j,!1)}:function(e,t,n,o){var i;n?(T.put(i=new C(e,o||t,function(t){j.call(e,t,o)},j,null,null,!0)),o&&null==e["_on"+o]&&(e["_on"+o]=0),i.target.attachEvent("on"+i.eventType,i.handler)):(i=T.get(e,o||t,j,!0)[0],i&&(i.target.detachEvent("on"+i.eventType,i.handler),T.del(i)))},A=function(e,t,n,o,i){return function(){o.apply(this,arguments),e(t,n,i)}},O=function(e,t,n,o){var i,s,a=t&&t.replace(r,""),c=T.get(e,a,null,!1),l={};for(i=0,s=c.length;s>i;i++)n&&c[i].original!==n||!c[i].inNamespaces(o)||(T.del(c[i]),!l[c[i].eventType]&&c[i][m]&&(l[c[i].eventType]={t:c[i].eventType,c:c[i].type}));for(i in l)T.has(e,l[i].t,null,!1)||E(e,l[i].t,!1,l[i].c)},I=function(e,t){var o=function(t,o){for(var i,s=g(e)?n(e,o):e;t&&t!==o;t=t.parentNode)for(i=s.length;i--;)if(s[i]===t)return t},i=function(e){var n=o(e.target,this);n&&t.apply(n,arguments)};return i.__beanDel={ft:o,selector:e},i},L=d?function(e,t,n){var i=l.createEvent(e?"HTMLEvents":"UIEvents");i[e?"initEvent":"initUIEvent"](t,!0,!0,o,1),n.dispatchEvent(i)}:function(e,t,n){n=x(n,e),e?n.fireEvent("on"+t,l.createEventObject()):n["_on"+t]++},q=function(e,t,n){var o,i,a,c,l=g(t);if(l&&t.indexOf(" ")>0){for(t=h(t),c=t.length;c--;)q(e,t[c],n);return e}if(i=l&&t.replace(r,""),i&&_[i]&&(i=_[i].base),!t||l)(a=l&&t.replace(s,""))&&(a=h(a,".")),O(e,i,n,a);else if(v(t))O(e,null,t);else for(o in t)t.hasOwnProperty(o)&&q(e,o,t[o]);return e},D=function(e,t,o,i){var a,c,l,u,d,g,y;{if(void 0!==o||"object"!=typeof t){for(v(o)?(d=p.call(arguments,3),i=a=o):(a=i,d=p.call(arguments,4),i=I(o,a,n)),l=h(t),this===f&&(i=A(q,e,t,i,a)),u=l.length;u--;)y=T.put(g=new C(e,l[u].replace(r,""),i,a,h(l[u].replace(s,""),"."),d,!1)),g[m]&&y&&E(e,g.eventType,!0,g.customType);return e}for(c in t)t.hasOwnProperty(c)&&D.call(this,e,c,t[c])}},N=function(e,t,n,o){return D.apply(null,g(n)?[e,n,t,o].concat(arguments.length>3?p.call(arguments,5):[]):p.call(arguments))},M=function(){return D.apply(f,arguments)},F=function(e,t,n){var o,i,a,c,l,u=h(t);for(o=u.length;o--;)if(t=u[o].replace(r,""),(c=u[o].replace(s,""))&&(c=h(c,".")),c||n||!e[m])for(l=T.get(e,t,null,!1),n=[!1].concat(n),i=0,a=l.length;a>i;i++)l[i].inNamespaces(c)&&l[i].handler.apply(e,n);else L(w[t],t,e);return e},P=function(e,t,n){for(var o,i,s=T.get(t,n,null,!1),r=s.length,a=0;r>a;a++)s[a].original&&(o=[e,s[a].type],(i=s[a].handler.__beanDel)&&o.push(i.selector),o.push(s[a].original),D.apply(null,o));return e},U={on:D,add:N,one:M,off:q,remove:q,clone:P,fire:F,Event:k,setSelectorEngine:S,noConflict:function(){return t[e]=i,this}};if(o.attachEvent){var R=function(){var e,t=T.entries();for(e in t)t[e].type&&"unload"!==t[e].type&&q(t[e].element,t[e].type);o.detachEvent("onunload",R),o.CollectGarbage&&o.CollectGarbage()};o.attachEvent("onunload",R)}return S(),U}),define("enhancer",["require"],function(e){function t(t,n,o,i){var s,r=t.getAttribute("data-interactive"),a=t;s=/^https?:\/\//.test(r)?r:o.page.interactiveUrl+r+"/boot.js",e([s],function(e){e.boot(a,n,o,i)})}return{render:t}}),define("common/modules/lazyload",["common/common","common/utils/ajax","bonzo"],function(e,t,n){var o=function(o){var i,s={success:function(){},error:function(){},always:function(){},beforeInsert:function(e){return e},force:!1},r=e.extend(s,o||{});this.load=function(){return r.url&&r.container&&(i=n(r.container),r.force||!i.hasClass("lazyloaded"))?t({url:r.url,type:"json",crossOrigin:!0}).then(function(e){i.html(r.beforeInsert(e.html)),i.addClass("lazyloaded"),r.success(e)},function(e){r.error(e)}).always(function(e){r.always(e)}):void 0}};return o}),define("lodash/objects/forIn",["../internals/baseCreateCallback","../internals/objectTypes"],function(e,t){var n=function(n,o,i){var s,r=n,a=r;if(!r)return a;if(!t[typeof r])return a;o=o&&"undefined"==typeof i?o:e(o,i,3);for(s in r)if(o(r[s],s,n)===!1)return a;return a};return n}),define("lodash/internals/arrayPool",[],function(){var e=[];return e}),define("lodash/internals/getArray",["./arrayPool"],function(e){function t(){return e.pop()||[]}return t}),define("lodash/internals/maxPoolSize",[],function(){var e=40;return e}),define("lodash/internals/releaseArray",["./arrayPool","./maxPoolSize"],function(e,t){function n(n){n.length=0,e.length<t&&e.push(n)}return n}),define("lodash/internals/baseIsEqual",["../objects/forIn","./getArray","../objects/isFunction","./objectTypes","./releaseArray"],function(e,t,n,o,i){function s(p,v,y,b,w,_){if(y){var k=y(p,v);if("undefined"!=typeof k)return!!k}if(p===v)return 0!==p||1/p==1/v;var x=typeof p,C=typeof v;if(!(p!==p||p&&o[x]||v&&o[C]))return!1;if(null==p||null==v)return p===v;var T=h.call(p),S=h.call(v);if(T==r&&(T=d),S==r&&(S=d),T!=S)return!1;switch(T){case c:case l:return+p==+v;case u:return p!=+p?v!=+v:0==p?1/p==1/v:p==+v;case m:case f:return p==String(v)}var j=T==a;if(!j){var E=g.call(p,"__wrapped__"),A=g.call(v,"__wrapped__");if(E||A)return s(E?p.__wrapped__:p,A?v.__wrapped__:v,y,b,w,_);if(T!=d)return!1;var O=p.constructor,I=v.constructor;if(O!=I&&!(n(O)&&O instanceof O&&n(I)&&I instanceof I)&&"constructor"in p&&"constructor"in v)return!1}var L=!w;w||(w=t()),_||(_=t());for(var q=w.length;q--;)if(w[q]==p)return _[q]==v;var D=0;if(k=!0,w.push(p),_.push(v),j){if(q=p.length,D=v.length,k=D==q,k||b)for(;D--;){var N=q,M=v[D];if(b)for(;N--&&!(k=s(p[N],M,y,b,w,_)););else if(!(k=s(p[D],M,y,b,w,_)))break}}else e(v,function(e,t,n){return g.call(n,t)?(D++,k=g.call(p,t)&&s(p[t],e,y,b,w,_)):void 0}),k&&!b&&e(p,function(e,t,n){return g.call(n,t)?k=--D>-1:void 0});return w.pop(),_.pop(),L&&(i(w),i(_)),k}var r="[object Arguments]",a="[object Array]",c="[object Boolean]",l="[object Date]",u="[object Number]",d="[object Object]",m="[object RegExp]",f="[object String]",p=Object.prototype,h=p.toString,g=p.hasOwnProperty;return s}),define("lodash/utilities/property",[],function(){function e(e){return function(t){return t[e]}}return e}),define("lodash/functions/createCallback",["../internals/baseCreateCallback","../internals/baseIsEqual","../objects/isObject","../objects/keys","../utilities/property"],function(e,t,n,o,i){function s(s,r,a){var c=typeof s;if(null==s||"function"==c)return e(s,r,a);if("object"!=c)return i(s);var l=o(s),u=l[0],d=s[u];return 1!=l.length||d!==d||n(d)?function(e){for(var n=l.length,o=!1;n--&&(o=t(e[l[n]],s[l[n]],null,!0)););return o}:function(e){var t=e[u];return d===t&&(0!==d||1/d==1/t)}}return s}),define("lodash/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(e,t,n){var o=function(o,i,s){var r,a=o,c=a;if(!a)return c;if(!n[typeof a])return c;i=i&&"undefined"==typeof s?i:e(i,s,3);for(var l=-1,u=n[typeof a]&&t(a),d=u?u.length:0;++l<d;)if(r=u[l],i(a[r],r,o)===!1)return c;return c};return o}),define("lodash/collections/filter",["../functions/createCallback","../objects/forOwn"],function(e,t){function n(n,o,i){var s=[];o=e(o,i,3);var r=-1,a=n?n.length:0;if("number"==typeof a)for(;++r<a;){var c=n[r];o(c,r,n)&&s.push(c)}else t(n,function(e,t,n){o(e,t,n)&&s.push(e)});return s}return n}),define("lodash/collections/where",["./filter"],function(e){var t=e;return t}),define("common/modules/analytics/register",["common/utils/deferToLoad","lodash/collections/where"],function(e,t){function n(e){a.push({name:e,status:"unfinished"})}function o(e){t(a,{name:e}).forEach(function(e){e.status="completed",e.endTime=Date.now()-c+"ms"})}function i(e){t(a,{name:e}).forEach(function(e){e.status="failed",e.endTime=Date.now()-c+"ms"})}function s(){require("ophan/ng",function(e){e.record({register:a})})}function r(){e(function(){window.setTimeout(s,5e3)})}var a=[],c=Date.now();return{initialise:r,begin:n,end:o,error:i}}),define("common/modules/onward/popular",["common/common","common/modules/lazyload","common/modules/analytics/register"],function(e,t,n){function o(o,i,s,r,a){n.begin("popular-in-section"),a=a||".js-popular";var c=i.querySelector(a);if(c){var l=o.page&&o.page.section&&"global"!==o.page.section,u=s?"/expandable":"";r=r||"/most-read"+u+(l?"/"+o.page.section:""),new t({url:r+".json",container:c,success:function(){e.mediator.emit("modules:popular:loaded",c),e.mediator.emit("fragment:ready:images",c),n.end("popular-in-section")},error:function(t){e.mediator.emit("module:error","Failed to load most read: "+t.statusText,"common/modules/popular.js"),n.error("popular-in-section")}}).load()}}return o}),define("common/modules/ui/expandable",["common/common","bean","bonzo"],function(e,t,n){var o=function(o){var i=o||{},s=e.$g(i.dom),r=i.expanded===!1?!1:!0,a=document.createElement("button"),c=i.showCount===!1?!1:!0,l={updateCallToAction:function(){var e="Show ";c&&(e+=u.getCount()+" "),e+=r?"fewer":"more",a.innerHTML=e,a.setAttribute("data-link-name","Show "+(r?"more":"fewer")),a.setAttribute("data-is-ajax","1")},renderState:function(){r?s.removeClass("shut"):s.addClass("shut")},renderCallToAction:function(){t.add(a,"click",function(){u.toggleExpanded()}),a.className="cta",i.buttonAfterEl?n(i.buttonAfterEl).after(a):s[0].appendChild(a),l.updateCallToAction()},scrollToCallToAction:function(){r||window.setTimeout(function(){a.scrollIntoView()},550)}},u={toggleExpanded:function(){r=r?!1:!0,l.renderState(),l.updateCallToAction()},getCount:function(){return parseInt(s.attr("data-count"),10)},isOpen:function(){return s.hasClass("shut")?!1:!0}};return{init:function(){return s.hasClass("expandable-initialised")||!s.html()||u.getCount()<3?!1:(s.addClass("expandable-initialised"),l.renderCallToAction(),void l.renderState())},toggle:u.toggleExpanded}};return o});var ImagerOptions,ImagerStrategyOptions;Imager.prototype.process=function(e){var t=this.nodes.length,n=this,o=n.strategy;if(!n._processing){for(n._processing=!0;t--;)o.requiresPlaceholder(n.nodes[t])&&(n.nodes[t]=o.createPlaceholder(n.nodes[t]));return this.nextTick(function(){n.updateImagesSource(),n._processing=!1,(e||function(){}).call(n)}),n}},Imager.prototype.update=function(e){this.nodes=[].slice.call(e||[])},Imager.prototype.updateImagesSource=function(){for(var e=this.nodes.length,t=this,n=t.strategy;e--;)n.updatePlaceholderUri(this.nodes[e],Imager.replaceUri(this.nodes[e].getAttribute("data-src"),{width:t.getBestWidth(this.nodes[e].clientWidth,this.nodes[e].getAttribute("data-width"))}))},Imager.prototype.getBestWidth=function(e,t){for(var n=t||this.availableWidths[0],o=this.availableWidths.length;o--;)if(e<=this.availableWidths[o])return this.availableWidths[o];return n},Imager.prototype.nextTick=function(e){0===this.replacementDelay?e():setTimeout(e,this.replacementDelay)},Imager.init=function(e,t){return new Imager(e,t).process()},Imager.replaceUri=function(e,t){var n=[];for(var o in t)n.push(o);return e.replace(new RegExp("{("+n.join("|")+")}","g"),function(e,n){return t[n]||""})},Imager.strategies={},define("components/imager.js/src/imager",function(){}),function(e){function t(e){e=e||{},this.matchingClassName=e.matchingClassName||"responsive-img",this.element=e.element||document.createElement("img"),this.element.src=e.src||"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACwAAAAAAQABAAACAkQBADs=",this.element.className+=" "+this.matchingClassName}t._id="container",t.prototype.applyOnPlaceholder=function(e,t){for(var n=e.children.length;n--;)if(e.children[n].className.match(new RegExp("(^| )"+this.matchingClassName+"( |$)")))return t&&t(e.children[n],e),!0;return!1},t.prototype.createPlaceholder=function(e){var t=this.element.cloneNode();return e.hasAttribute("data-width")&&(t.width=e.getAttribute("data-width")),t.className=this.matchingClassName,e.appendChild(t),e},t.prototype.requiresPlaceholder=function(e){return e.hasAttribute("data-src")&&this.applyOnPlaceholder(e)===!1},t.prototype.updatePlaceholderUri=function(e,t){this.applyOnPlaceholder(e,function(e){e.src=t})},e[t._id]=t}(Imager.strategies),define("imager",["components/imager.js/src/imager"],function(e){return function(){var t;return t||e.Imager}}(this)),define("common/modules/ui/images",["common/$","bonzo","common/utils/mediator","imager"],function(e,t,n,o){var i={upgrade:function(n){n=n||document;var i={availableWidths:[140,220,300,460,620,700,940],strategy:"container",replacementDelay:0},s=e(".js-image-upgrade",n).map(function(e){return e},function(e){return"none"!==t(e).css("display")});o.init(s,i),s.forEach(function(n){e("img",n).each(function(e){var n=t(e);null===n.attr("alt")&&n.attr("alt","")})})},listen:function(){n.addListeners({"window:resize":function(){i.upgrade()},"window:orientationchange":function(){i.upgrade()},"ui:images:upgrade":function(){i.upgrade()}})}};return i}),define("common/modules/onward/history",["lodash/objects/assign","common/utils/storage"],function(e,t){var n=function(t){return this.id=t.id,this.timestamp=Date.now(),e(this,t.meta),this},o=function(t){return this.config=e(this.DEFAULTS,t),this};return o.prototype.DEFAULTS={storageKey:"gu.history",maxSize:100},o.prototype.set=function(e){return t.local.set(this.config.storageKey,e)},o.prototype.get=function(){var e=t.local.get(this.config.storageKey);return null===e?[]:e},o.prototype.getSize=function(){return this.get().length},o.prototype.contains=function(e){return this.get().some(function(t){return t.id===e})},o.prototype.capToSize=function(e){var t=this.get();return t.length>e&&(t.length=e),t},o.prototype.log=function(e){var t=this.capToSize(this.config.maxSize-1),o=new n(e);t.unshift(o),this.set(t)},o}),define("common/modules/onward/related",["common/common","common/modules/lazyload","common/modules/ui/expandable","common/modules/ui/images","common/modules/onward/history","qwery","bonzo","common/$","common/modules/analytics/register"],function(e,t,n,o,i,s,r,a,c){function l(){}return l.overrideUrl="",l.setOverrideUrl=function(e){l.overrideUrl=e},l.prototype.renderRelatedComponent=function(i,s){var r;i.page&&i.page.hasStoryPackage&&!l.overrideUrl?(new n({dom:s.querySelector(".related-trails"),expanded:!1,showCount:!1}).init(),e.mediator.emit("modules:related:loaded",i,s)):i.switches&&i.switches.relatedContent&&(c.begin("related-content"),r=s.querySelector(".js-related"),r&&new t({url:l.overrideUrl||"/related/"+i.page.pageId+".json",container:r,success:function(){l.overrideUrl&&i.page.hasStoryPackage&&a(".more-on-this-story").addClass("u-h");var t=r.querySelector(".related-trails");new n({dom:t,expanded:!1,showCount:!1}).init(),o.upgrade(t),e.mediator.emit("modules:related:loaded",i,s),c.end("related-content")},error:function(t){e.mediator.emit("module:error","Failed to load related: "+t.statusText,"common/modules/related.js"),c.error("related-content")}}).load())},l}),define("common/modules/navigation/profile",["common/common","common/utils/ajax","bonzo","bean","common/utils/detect","common/modules/identity/api"],function(e,t,n,o,i,s){function r(t,n){this.context=t,this.config=e.extend(this.config,n),this.dom.container=t.querySelector("."+r.CONFIG.classes.container),this.dom.content=this.dom.container.querySelector("."+r.CONFIG.classes.content),this.dom.popup=t.querySelector("."+r.CONFIG.classes.popup)}return r.CONFIG={eventName:"modules:profilenav",classes:{container:"js-profile-nav",content:"js-profile-info",popup:"js-profile-nav-popup"}},r.prototype.config={url:"https://profile.theguardian.com"},r.prototype.dom={},r.prototype.context=null,r.prototype.init=function(){this.setFragmentFromCookie()},r.prototype.setFragmentFromCookie=function(){var e=s.getUserFromCookie(),t=n(this.dom.container),o=n(this.dom.content),i=n(this.dom.popup);t.removeClass("js-hidden"),e?(o.text(e.displayName),t.addClass("is-signed-in"),i.html('<ul class="nav nav--columns" data-link-name="Sub Sections">'+this.menuListItem("Edit profile",this.config.url+"/public/edit")+this.menuListItem("Email preferences",this.config.url+"/email-prefs")+this.menuListItem("Sign out",this.config.url+"/signout")+"</ul>")):i.remove(),this.emitLoadedEvent(e)},r.prototype.menuListItem=function(e,t){return'<li class="nav__item"><a href="'+t+'" class="nav__link" data-link-name="'+e+'">'+e+"</a></li>"},r.prototype.emitLoadedEvent=function(t){e.mediator.emit(r.CONFIG.eventName+":loaded",t)},r.prototype.emitErrorEvent=function(){e.mediator.emit(r.CONFIG.eventName+":error")},r}),define("common/modules/navigation/sections",["common/common","bonzo","common/utils/mediator","common/utils/detect"],function(e,t,n,o){function i(){var i="is-off",s=this,r=o.hasCrossedBreakpoint(),a={};this.view={bindings:function(c){var l=c.id;if(!a[l]){a[l]=!0;var u=c.querySelector(".nav-popup--sections"),d=c.querySelector(".nav--global");u&&d&&(n.addListener("window:resize",function(){r(function(n){t(u).addClass(i),"mobile"!==n?(s.view.hideColumns(u,d),e.$g(".nav-popup--localnav").addClass("is-off")):s.view.showColumns(u,d)})}),"mobile"!==o.getBreakpoint()&&s.view.hideColumns(u,d))}},showColumns:function(t){e.$g(".nav__item",t).removeClass("u-h")},hideColumns:function(n,o){var i,s=[],r=e.$g(".nav__item",n).removeClass("u-h");e.$g(".nav__item",o).each(function(e){i=i||t(e).offset().top,t(e).offset().top===i&&s.push(e)});for(var a=0,c=s.length;c>a;a++)t(r[a]).addClass("u-h")},upgradeLocalNav:function(t){t.querySelector(".js-localnav--small")&&(e.$g("#preloads").addClass("has-localnav"),e.$g(".js-localnav--small").removeClass("is-hidden"))}},this.init=function(e){this.view.bindings(e),this.view.upgradeLocalNav(e)}}return i}),define("common/modules/navigation/search",["common/$","common/common","bean"],function(e,t,n){var o=function(o){var i,s,r,a,c=this;if(o.switches.googleSearch&&o.page.googleSearchUrl&&o.page.googleSearchId){i=!0,s=o.page.googleSearchUrl+"?cx="+o.page.googleSearchId;var l=t.rateLimit(function(){c.load()});n.on(document,"click touchstart",".js-search-toggle",function(e){l(),c.focusSearchField(),e.preventDefault()}),n.on(document,"click touchstart",".search-results",function(e){var t=e.target;"a"===t.nodeName.toLowerCase()&&(t.target="_self")})}this.focusSearchField=function(){var t=e("input.gsc-input");t.length>0&&t.focus()},this.load=function(){var e,t;a=r.querySelector(".js-search-placeholder"),window.__gcse={callback:c.focusSearchField},Array.prototype.forEach.call(document.querySelectorAll(".js-search-placeholder"),function(e){e!==a&&(e.innerHTML="")}),a.innerHTML||(a.innerHTML='<div class="search-box" role="search"><gcse:searchbox></gcse:searchbox></div><div class="search-results" data-link-name="search"><gcse:searchresults></gcse:searchresults></div>',e=document.createElement("script"),e.async=!0,e.src=s,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t))},this.init=function(e){i&&(r=e)}};return o}),define("common/modules/ui/tabs",["common/common","bean","bonzo"],function(e,t,n){var o=function(){var o={showTab:function(t,o,i){var s="tabs__tab--selected tone-colour tone-accent-border",r=e.$g(".tabs__tab--selected a",t)[0],a=t.querySelector("#"+o.getAttribute("href").substring(1)),c=t.querySelector("#"+r.getAttribute("href").substring(1));n(r.parentNode).removeClass(s),n(o.parentNode).addClass(s),n(r.parentNode).attr("aria-selected",!1),n(o.parentNode).attr("aria-selected",!0),n(c).hide(),n(a).removeClass("js-hidden").show().focus(),i.preventDefault()}};this.init=function(i){Array.prototype.forEach.call(i.querySelectorAll(".tabs"),function(i){var s=e.$g(".js-tabs",i)[0],r=0,a=0,c=0,l=0;if(s){if(s.getAttribute("data-is-bound")===!0)return!1;r=n(s).offset().height,a=n(s).offset().top,t.add(s,"click",function(e){var t=e.target;"a"===t.nodeName.toLowerCase()&&(o.showTab(i,t,e),c=n(i).offset().height-r,l>a&&window.scrollTo(0,a))}),s.setAttribute("data-is-bound",!0)}})}};return o}),define("common/modules/ui/toggles",["common/common","bean","bonzo"],function(e,t,n){var o=function(){var e,o=this,i="js-toggle-ready";this.init=function(s){e=s.querySelectorAll("[data-toggle]"),Array.prototype.forEach.call(e,function(r){if(!n(r).hasClass(i)){var a=o.getTarget(r,s);a&&(r.toggleTarget=a,n(r).addClass(i),t.add(r,"click touchstart",function(t){t.preventDefault(),o.toggle(r,e)}))}})},this.reset=function(){Array.prototype.forEach.call(e,o.close)}};return o.prototype.toggle=function(e,t){var o=this;Array.prototype.forEach.call(t,function(t){t===e?o[n(t).hasClass("is-active")?"close":"open"](t):o.close(t)})},o.prototype.getTarget=function(e,t){var o=n(e).data("toggle");return o?t.querySelector("."+o):void 0},o.prototype.open=function(e){n(e).addClass("is-active"),n(e.toggleTarget).removeClass("is-off")},o.prototype.close=function(e){n(e).removeClass("is-active"),n(e.toggleTarget).addClass("is-off")},o}),define("common/modules/ui/relativedates",["common/common","bonzo"],function(e,t){function n(e){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]}function o(e){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e]}function i(e){return 10>e?"0"+e:e}function s(e){return 12>e?"am":"pm"}function r(e){return e>12?e-12:e}function a(e){var t=new Date;return e.toDateString()===t.toDateString()}function c(e){var t=new Date;return e.valueOf()>t.valueOf()-864e5}function l(e){var t=new Date,n=new Date;return n.setDate(t.getDate()-1),e.toDateString()===n.toDateString()}function u(e){var t=(new Date).valueOf()-6048e5;return e.valueOf()>=t}function d(e){return"[object Date]"!==Object.prototype.toString.call(e)?!1:!isNaN(e.getTime())}function m(e,t,n){var o={s:{"short":"s","long":" second ago",plural:" seconds ago"},m:{"short":"m","long":" minute ago",plural:" minutes ago"},h:{"short":"h","long":" hour ago",plural:" hours ago"},d:{"short":"d","long":" day ago",plural:" days ago"}};return o[e]?1===n||"short"===t?o[e][t]:o[e].plural:""}function f(e,t){var i,s=new Date(Number(e)),r=new Date;if(t=t||{},!d(s))return!1;if(i=parseInt((r.getTime()-s)/1e3,10),0>i)return!1;if(55>i)return i+m("s",t.format||"short",i);if(3300>i){var f=Math.round(i/60,10);return f+m("m",t.format||"short",f)}if(a(s)||c(s)&&"short"===t.format){var h=Math.round(i/3600);return h+m("h",t.format||"short",h)}if(u(s)&&"short"===t.format){var g=Math.round(i/3600/24);return g+m("d",t.format||"short",g)}return l(s)?"Yesterday"+p(s):432e3>i?[n(s.getDay()),s.getDate(),o(s.getMonth()),s.getFullYear()].join(" ")+(t.showTime?p(s):""):[s.getDate(),o(s.getMonth()),s.getFullYear()].join(" ")+(t.showTime?p(s):"")}function p(e){return", "+r(e.getHours())+":"+i(e.getMinutes())+s(e.getHours())}function h(t){return e.$g(".js-timestamp, .block-time time, .js-item__timestamp",t)}function g(e){h(e).each(function(e){var n=t(e),o=parseInt(n.attr("data-timestamp"),10)||n.attr("datetime"),i=new Date(o),s=f(i.getTime(),{showTime:t(n.parent()).hasClass("block-time"),format:n.attr("data-relativeformat")});if(n.removeClass("js-timestamp"),s){var r=n[0].querySelector(".timestamp__text")||n[0];r.getAttribute("title")||r.setAttribute("title",t(r).text()),r.innerHTML=s}})}function v(e){g(e)}return["related","autoupdate"].forEach(function(t){e.mediator.on("modules:"+t+":render",g)}),{makeRelativeDate:f,init:v}}),define("common/modules/analytics/mvt-cookie",["common/utils/cookies"],function(e){function t(){if(!i()||i()>u){var t=r(u,1);e.add(a,t,365)}e.cleanUp(["GU_mvtid"])}function n(t){e.add(a,t,365)}function o(){var t=e.get(l),n=i(),o=e.get(c);return o||(o="unknown-visitor-id"),t||(t="unknown-browser-id"),n||(n="unknown-mvt-id"),o+" "+t+" "+n}function i(){return e.get(a)}function s(){return u}function r(e,t){return Math.floor(Math.random()*(t-e+1)+e)}var a="GU_mvt_id",c="s_vi",l="bwid",u=1e6;return{generateMvtCookie:t,getMvtFullId:o,getMvtValue:i,getMvtNumValues:s,overwriteMvtCookie:n,MAX_INT:u}}),define("common/modules/experiments/tests/aa",[],function(){var e=function(){this.id="Abcd",this.expiry="2013-12-31",this.audience=.25,this.audienceOffset=0,this.description="A/A test to prove we bucket users evenly",this.canRun=function(){return!0},this.variants=[{id:"control",test:function(){return!0}},{id:"bucketA",test:function(){return!0}},{id:"bucketB",test:function(){return!0}},{id:"bucketC",test:function(){return!0}},{id:"bucketD",test:function(){return!0}}]};return e}),define("lodash/objects/has",[],function(){function e(e,t){return e?n.call(e,t):!1}var t=Object.prototype,n=t.hasOwnProperty;return e}),define("common/utils/get-property",["lodash/objects/has"],function(e){return function(t,n,o){var i=n.split(".").reduce(function(t,n){return e(t,n)?t[n]:void 0},t);return void 0!==i?i:void 0!==o?o:!1}}),define("common/utils/template",[],function(){return function(e,t){return Object.keys(t).reduce(function(e,n){return e.replace("{{"+n+"}}",t[n])},e)}}),define("common/modules/experiments/tests/fronts-latest-reviews-card",["bonzo","qwery","common/utils/ajax","common/utils/detect","common/utils/get-property","common/utils/template"],function(e,t,n,o,i,s){return function(){this.id="FrontsLatestReviewsCard",this.start="2014-03-17",this.expiry="2014-03-24",this.author="Darren Hurley",this.description="Add a latest reviews card to the features container",this.audience=.04,this.audienceOffset=.04,this.successMeasure="Click-through for the page as a whole.",this.audienceCriteria="Users who are not on desktop or bigger, on the network front.",this.dataLinkNames="card | latest reviews | trail | {{index}}",this.idealOutcome="Click-through for the front increases, i.e. the card does not detract from the page's CTR.",this.canRun=function(e){return["desktop","wide"].indexOf(o.getBreakpoint())>-1&&/^\w{2}-alpha$/.test(e.page.pageId)},this.variants=[{id:"control",test:function(){}},{id:"latest-reviews",test:function(){n({url:"/tagged.json?tag=tone/reviews,culture/culture",type:"json",crossOrigin:!0}).then(function(n){var o=i(n,"trails",[]).map(function(e,t){return s('<li data-link-name="trail | {{index}}" class="card__item"><a href="{{url}}" class="card__item__link" data-link-name="article"><h4 class="card__item__title">{{section}}: {{headline}}</h4>'+(null!==e.starRating?'<span class="stars s-{{rating}}" itemprop="reviewRating" itemscope itemtype="http://schema.org/Rating"><meta itemprop="worstRating" content="1" /><span itemprop="ratingValue">{{rating}}</span> /<span itemprop="bestRating">5</span> stars</span>':"")+"</a></li>",{headline:e.webTitle,url:e.webUrl.replace(/https?:\/\/[^/]*/,""),section:e.sectionName,rating:e.starRating,index:t+1})}),r=e(e.create(s('<div class="container__card tone-feature tone-accent-border" data-link-name="card | latest reviews"><h3 class="container__card__title tone-colour">Latest reviews</h3><ul class="u-unstyled">{{reviews}}</ul></div>',{reviews:o.join("")}))).appendTo(t(".container--features").shift()),a=594-r.dim().height;r.css("top",a+"px")})}}]}}),define("common/modules/experiments/tests/fronts-cartoon-card",["bonzo","qwery","common/utils/ajax","common/utils/detect","common/utils/get-property","common/utils/template"],function(e,t,n,o,i,s){return function(){this.id="FrontsCartoonCard",this.start="2014-03-17",this.expiry="2014-03-24",this.author="Darren Hurley",this.description="Add a cartoon card to the Comment and Debate container",this.audience=.04,this.audienceOffset=0,this.successMeasure="Click-through for the page as a whole.",this.audienceCriteria="Users who are not on desktop or bigger, on the network front.",this.dataLinkNames="card | cartoon",this.idealOutcome="Click-through for the front increases, i.e. the card does not detract from the page's CTR.",this.canRun=function(e){return["desktop","wide"].indexOf(o.getBreakpoint())>-1&&/^\w{2}-alpha$/.test(e.page.pageId)},this.variants=[{id:"control",test:function(){}},{id:"cartoon",test:function(){n({url:"/tagged.json?tag=theguardian/series/guardiancommentcartoon",type:"json",crossOrigin:!0}).then(function(n){var o=i(n,"trails",[]).map(function(t){return e(e.create(s('<div class="container__card tone-comment tone-accent-border" data-link-name="card | cartoon"><h3 class="container__card__title tone-colour">Cartoon</h3><a href="{{url}}" data-link-name="article" class="card__item card__item__link"><h4 class="card__item__title">{{headline}}</h4><img src="{{thumbnail}}" alt="" width="140" height="84" class="card__item__image" /></a></div>',{headline:t.webTitle,url:t.webUrl.replace(/https?:\/\/[^/]*/,""),thumbnail:t.thumbnail})))}).shift().appendTo(t(".container--commentanddebate").shift()),r=383-o.dim().height;o.css("top",r+"px")})}}]}}),define("common/modules/experiments/tests/fronts-missed-card",["bonzo","qwery","common/utils/ajax","common/utils/detect","common/modules/onward/history","common/utils/get-property","common/utils/template"],function(e,t,n,o,i,s,r){var a={UK:"GB",US:"US",AU:"AU"};return function(){this.id="FrontsMissedCard",this.start="2014-03-17",this.expiry="2014-03-24",this.author="Darren Hurley",this.description="Add a `You might have missed` card to the news container",this.audience=.04,this.audienceOffset=.12,this.successMeasure="Click-through for the page as a whole.",this.audienceCriteria="Users who are not on desktop or bigger, on the network front.",this.dataLinkNames="card | missed | trail | {{index}}",this.idealOutcome="Click-through for the front increases, i.e. the card does not detract from the page's CTR.",this.canRun=function(e){return["desktop","wide"].indexOf(o.getBreakpoint())>-1&&/^\w{2}-alpha$/.test(e.page.pageId)},this.variants=[{id:"control",test:function(){}},{id:"missed",test:function(o,c){n({url:"/most-read-day.json?countryCode="+a[c.page.edition],type:"json",crossOrigin:!0}).then(function(n){var o=new i,a=s(n,"trails",[]).filter(function(e){return!o.contains("/"+e.id)}).slice(0,3).map(function(e,t){return r('<li data-link-name="trail | {{index}}" class="card__item"><a href="{{url}}" class="card__item__link" data-link-name="article"><h4 class="card__item__title">{{headline}}</h4></a></li>',{headline:e.headline,url:e.url,index:t+1})}),c=e(e.create(r('<div class="container__card container__card--missed tone-news tone-accent-border" data-link-name="card | missed"><h3 class="container__card__title tone-colour">You may have missed</h3><ul class="u-unstyled">{{articles}}</ul></div>',{articles:a.join("")}))).appendTo(t(".container--news").shift()),l=944-c.dim().height;c.css("top",l+"px")})}}]}}),define("common/modules/experiments/tests/fronts-live-card",["bonzo","qwery","common/utils/ajax","common/utils/detect","common/utils/get-property","common/utils/template"],function(e,t,n,o,i,s){return function(){this.id="FrontsLiveCard",this.start="2014-03-17",this.expiry="2014-03-24",this.author="Darren Hurley",this.description="Add a live card to the news container",this.audience=.04,this.audienceOffset=.08,this.successMeasure="Click-through for the page as a whole.",this.audienceCriteria="Users who are not on desktop or bigger, on the network front.",this.dataLinkNames="card | live | trail | {{index}}",this.idealOutcome="Click-through for the front increases, i.e. the card does not detract from the page's CTR.",this.canRun=function(e){return["desktop","wide"].indexOf(o.getBreakpoint())>-1&&/^\w{2}-alpha$/.test(e.page.pageId)},this.variants=[{id:"control",test:function(){}},{id:"live",test:function(){n({url:"/tagged.json?tag=tone/minutebyminute",type:"json",crossOrigin:!0}).then(function(n){var o=i(n,"trails",[]).map(function(e,t){return s('<li data-link-name="trail | {{index}}" class="card__item"><a href="{{url}}" class="card__item__link" data-link-name="article"><h4 class="card__item__title">'+(e.isLive?'<span class="item__live-indicator">Live</span> ':"")+"{{headline}}   </h4></a></li>",{headline:e.webTitle,url:e.webUrl.replace(/https?:\/\/[^/]*/,""),index:t+1})
}),r=e(e.create(s('<div class="container__card container__card--live tone-news tone-accent-border" data-link-name="card | live"><h3 class="container__card__title tone-colour">What\'s happening now</h3><ul class="u-unstyled">{{items}}</ul></div>',{items:o.join("")}))).appendTo(t(".container--news").shift()),a=944-r.dim().height;r.css("top",a+"px")})}}]}}),define("common/modules/experiments/ab",["common/common","common/utils/storage","common/utils/mediator","common/modules/analytics/mvt-cookie","common/modules/experiments/tests/aa","common/modules/experiments/tests/fronts-latest-reviews-card","common/modules/experiments/tests/fronts-cartoon-card","common/modules/experiments/tests/fronts-missed-card","common/modules/experiments/tests/fronts-live-card"],function(e,t,n,o,i,s,r,a,c){function l(){return t.local.get(C)||{}}function u(e){var t=l();return t[e.id]}function d(e,n){var o=l();o[e.id]={variant:n},t.local.set(C,o)}function m(e){var n=l();delete n[e.id],t.local.set(C,n)}function f(e){var t=l();Object.keys(t).forEach(function(t){if("undefined"==typeof e.switches["ab"+t])m({id:t});else{var n=x.some(function(e){return e.id===t});n||m({id:t})}})}function p(){return x.filter(function(e){var t=new Date-new Date(e.expiry)>0;return t?(m(e),!1):!0})}function h(){return x.filter(function(e){return new Date-new Date(e.expiry)>0})}function g(e,t){var n=new Date-new Date(e.expiry)>0;return e.canRun(t)&&!n&&_(e,t)}function v(e){var t=x.filter(function(t){return t.id===e});return t?t[0]:""}function y(e){var t=l(),n=[];return Object.keys(t).forEach(function(o){g(v(o),e)&&n.push(["AB",o,t[o].variant].join(" | "))}),n.join(",")}function b(e,t,n){if(u(e)&&g(e,t)){var o=l(),i=o[e.id].variant;e.variants.some(function(e){return e.id===i?(e.test(n,t),!0):void 0}),"notintest"===i&&e.notInTest&&e.notInTest()}}function w(e,t){if(g(e,t)&&!u(e)){var n=o.getMvtNumValues()*e.audienceOffset,i=n+o.getMvtNumValues()*e.audience,s=o.getMvtValue();if(s>=n&&i>s){var r=e.variants.map(function(e){return e.id}),a=s%r.length;d(e,r[a])}else d(e,"notintest")}}function _(e,t){return t.switches["ab"+e.id]}function k(e){var t=l()[e];return t&&t.variant}var x=[new i,new s,new r,new a,new c],C="gu.ab.participations",T={addTest:function(e){x.push(e)},clearTests:function(){x=[]},segment:function(e){p().forEach(function(t){w(t,e)})},forceSegment:function(e,t){p().filter(function(t){return t.id===e}).forEach(function(e){d(e,t)})},segmentUser:function(e){o.generateMvtCookie();var t=/^#ab/.test(window.location.hash);if(t){var n=window.location.hash.replace("#ab-","").split("="),i=n[0],s=n[1];T.forceSegment(i,s)}else T.segment(e);f(e)},run:function(e,t){p().forEach(function(n){b(n,e,t)})},isEventApplicableToAnActiveTest:function(e){var t=Object.keys(l());return t.some(function(t){var n=v(t).events;return n.some(function(t){return 0===e.indexOf(t)})})},getActiveTestsEventIsApplicableTo:function(e){function t(e,t){return 0===e.indexOf(t)}var n=e.tag;return n&&p().filter(function(e){var o=e.events;return o&&o.some(function(e){return t(n,e)})}).map(function(e){return e.id})},getAbLoggableObject:function(e){var t={};try{p().forEach(function(n){if(u(n)){var o=k(n.id);_(n,e)&&o&&"notintest"!==o&&(t["ab"+n.id]=o)}})}catch(o){t={},n.emit("module:error",o,"common/modules/experiments/ab.js",267)}return t},getParticipations:l,makeOmnitureTag:y,getExpiredTests:h,getActiveTests:p,getTestVariant:k};return T}),define("common/modules/analytics/clickstream",["common/common","common/utils/detect","bean","common/modules/experiments/ab"],function(e,t,n,o){var i=function(t){t=t||{};var i=t.filter||[],s=function(e){return i.filter(function(t){return t===e})},r=function(e){var t,n,o,i;return e=e||"",t=e.match(/:\/\/(.[^\/]+)/),t&&(t=t[1],n=e.match(/^(https?:)\/\//),n=n?n[1]:void 0,o=window.location.hostname,i=window.location.protocol),!t||t===o&&n===i},a=function(e,t){if(!e.el)return!1;var n,o=e.el,i=o.tagName.toLowerCase(),c=o.getAttribute("data-link-name");return c&&(e.tag=e.tag||[],e.tag.push(c)),"body"===i?e.validTarget&&e.tag&&e.tag.length?(e.tag=[].concat(e.tag).reverse().join(" | "),o.getAttribute("data-link-test")&&(e.tag=o.getAttribute("data-link-test")+" | "+e.tag),delete e.el,delete e.validTarget,e):!1:(e.validTarget||(e.validTarget=s(o.tagName.toLowerCase()).length>0||t,e.validTarget&&(e.target=o,n=o.getAttribute("href"),e.samePage=n&&0===n.indexOf("#")||"button"===i||o.hasAttribute("data-is-ajax"),e.sameHost=e.samePage||r(n))),!e.linkContext&&o.getAttribute("data-link-context-path")&&(e.linkContextPath=o.getAttribute("data-link-context-path"),e.linkContextName=o.getAttribute("data-link-context-name")),e.el=o.parentNode,a(e))};return t.addListener!==!1&&n.add(document.body,"click",function(n){var i={el:n.target};t.withEvent!==!1&&(i.event=n),i=a(i);var s=o.getActiveTestsEventIsApplicableTo(i);void 0!==s&&s.length>0&&(i.tag=s.map(function(e){var t=o.getTestVariant(e);return"AB,"+e+","+t+","+i.tag}).join(",")),i&&e.mediator.emit("module:clickstream:click",i)}),{getClickSpec:a}};return i});var s=s_gi(s_account);s.charSet="UTF-8",s.currencyCode="GBP",s.trackDownloadLinks=!0,s.trackExternalLinks=!0,s.trackInlineStats=!0,s.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx",s.linkInternalFilters="javascript:,adinfo-guardian.co.uk,dating.guardian.co.uk,guardian.co.uk,guardian.greatgetaways.co.uk,guardian.lcplc-online.co.uk,guardian.oddschecker.com,guardian.pickthescore.co.uk,guardian.sportinglife.com,guardian.touch-line.com,guardian.unbiased.co.uk,guardianapis.com,guardianapps.co.uk,guardianbooks.co.uk,guardianbookshop.co.uk,guardiancottages.co.uk,guardiandigitalcomparison.co.uk,guardiandirectsubs.co.uk,guardianeatright.co.uk,guardianecostore.co.uk,guardianenergycomparison.co.uk,guardianenergycomparison.com,guardianfashionstore.co.uk,guardiangardencentre.co.uk,guardiangiftexperiences.co.uk,guardianholidayoffers.co.uk,guardianhomeexchange.co.uk,guardianhomeexchange.com,guardianinvesting.co.uk,guardianjobs.co.uk,guardianjobs.com,guardianjobs.mobi,guardianjobsrecruiter.co.uk,guardiannews.com,guardian-newspaper.com,guardianoffers.co.uk,guardianprofessional.co.uk,guardianpublic.co.uk,guardiansubscriptions.co.uk,guardiantickets.co.uk,guardianvouchercodes.co.uk,guardianweekly.co.uk,guardianweekly.com,id.guardian.co.uk,ivebeenthere.co.uk,jobs.guardian.co.uk,kable.co.uk,money-deals.co.uk,mps-expenses.guardian.co.uk,ogenterprises.co.uk,ogtravelinsurance.co.uk,sixsongsof.me,sixwordmemoirs.co.uk,smarthealthcare.com,sofacinema.co.uk,static.guim.co.uk,theguardian.co.uk,theguardian.com,traffic.outbrain.com,tvlistings.guardian.co.uk",s.linkLeaveQueryString=!1,s.linkTrackVars="None",s.linkTrackEvents="None",s.usePlugins=!0,s.doPlugins=s_doPlugins;var s_sv_dynamic_root="survey.112.2o7.net/survey/dynamic",s_sv_gather_root="survey.112.2o7.net/survey/gather";s.loadMediaModule=function(e,t){var n=this;n.loadModule("Media"),n.Media.autoTrack=!1,n.Media.trackVars="events,prop44,eVar7,eVar43,eVar44,eVar45,eVar48,eVar61,eVar56,eVar47",n.Media.trackEvents="event17,event18,event21,event22,event23,event57,event63",n.Media.trackMilestones="25,50,75",n.Media.segmentByMilestones=!0,n.Media.trackUsingContextData=!0,n.Media.contextDataMapping={"a.media.name":"eVar44,prop44","a.media.segment":"eVar48","a.contentType":"eVar43","a.media.timePlayed":"event57","a.media.view":"event17","a.media.segmentView":"event63","a.media.complete":"event18","a.media.milestones":{25:"event21",50:"event22",75:"event23"}},n.Media.monitor=function(e,t){"OPEN"==t.event&&(e.eVar7=e.pageName,e.eVar61=e._GUVideo.restricted?"restricted":"not restricted",e._GUVideo.ad?e.eVar47="video ad":(e.eVar47="video content",e.eVar56=e._GUVideo.provider),e.Media.track(t.name))},n._GUVideo={},n._GUVideo.provider=e,n._GUVideo.restricted=t},s.trackVideoContent=function(e,t){var n=this;n.Media.autoTrack=!1,n.Media.trackVars="events,prop44,eVar7,eVar11,eVar43,eVar44,eVar45,eVar48,eVar61,eVar56,eVar47",n.Media.trackEvents="event17,event18,event21,event22,event23,event57,event63",n.Media.trackMilestones="25,50,75",n.Media.segmentByMilestones=!0,n.Media.trackUsingContextData=!0,n.Media.contextDataMapping={"a.media.name":"eVar44,prop44","a.media.segment":"eVar48","a.contentType":"eVar43","a.media.timePlayed":"event57","a.media.view":"event17","a.media.segmentView":"event63","a.media.complete":"event18","a.media.milestones":{25:"event21",50:"event22",75:"event23"}},n._GUVideo.ad=!1,n._GUVideo.provider=e,n._GUVideo.restricted=t},s.trackVideoAd=function(){var e=this;e.Media.autoTrack=!1,e.Media.trackVars="events,prop44,eVar7,eVar11,eVar43,eVar44,eVar45,eVar61,eVar56,eVar47",e.Media.trackEvents="event64,event57,event59",e.Media.segmentByMilestones=!1,e.Media.trackUsingContextData=!0,e.Media.contextDataMapping={"a.media.name":"eVar44,prop44","a.contentType":"eVar43","a.media.timePlayed":"event57","a.media.view":"event59","a.media.complete":"event64"},e._GUVideo.ad=!0,e._GUVideo.restricted=!1},s.trackingServer="hits.guardian.co.uk",s.trackingServerSecure="hits-secure.guardian.co.uk",s.visitorNamespace="guardian",s.getQueryParam=new Function("p","d","u","h","var s=this,v='',i,j,t;d=d?d:'';u=u?u:(s.pageURL?s.pageURL:s.wd.location);if(u=='f')u=s.gtfs().location;while(p){i=p.indexOf(',');i=i<0?p.length:i;t=s.p_gpv(p.substring(0,i),u+'',h);if(t){t=t.indexOf('#')>-1?t.substring(0,t.indexOf('#')):t;}if(t)v+=v?d+t:t;p=p.substring(i==p.length?i:i+1)}return v"),s.p_gpv=new Function("k","u","h","var s=this,v='',q;j=h==1?'#':'?';i=u.indexOf(j);if(k&&i>-1){q=u.substring(i+1);v=s.pt(q,'&','p_gvf',k)}return v"),s.p_gvf=new Function("t","k","if(t){var s=this,i=t.indexOf('='),p=i<0?t:t.substring(0,i),v=i<0?'True':t.substring(i+1);if(p.toLowerCase()==k.toLowerCase())return s.epa(v)}return''"),s.getValOnce=new Function("v","c","e","t","var s=this,a=new Date,v=v?v:'',c=c?c:'s_gvo',e=e?e:0,i=t=='m'?60000:86400000;k=s.c_r(c);if(v){a.setTime(a.getTime()+e*i);s.c_w(c,v,e==0?0:a);}return v==k?'':v"),s.getDaysSinceLastVisit=new Function("c","var s=this,e=new Date(),es=new Date(),cval,cval_s,cval_ss,ct=e.getTime(),day=24*60*60*1000,f1,f2,f3,f4,f5;e.setTime(ct+3*365*day);es.setTime(ct+30*60*1000);f0='Cookies Not Supported';f1='First Visit';f2='More than 30 days';f3='More than 7 days';f4='Less than 7 days';f5='Less than 1 day';cval=s.c_r(c);if(cval.length==0){s.c_w(c,ct,e);s.c_w(c+'_s',f1,es);}else{var d=ct-cval;if(d>30*60*1000){if(d>30*day){s.c_w(c,ct,e);s.c_w(c+'_s',f2,es);}else if(d<30*day+1 && d>7*day){s.c_w(c,ct,e);s.c_w(c+'_s',f3,es);}else if(d<7*day+1 && d>day){s.c_w(c,ct,e);s.c_w(c+'_s',f4,es);}else if(d<day+1){s.c_w(c,ct,e);s.c_w(c+'_s',f5,es);}}else{s.c_w(c,ct,e);cval_ss=s.c_r(c+'_s');s.c_w(c+'_s',cval_ss,es);}}cval_s=s.c_r(c+'_s');if(cval_s.length==0) return f0;else if(cval_s!=f1&&cval_s!=f2&&cval_s!=f3&&cval_s!=f4&&cval_s!=f5) return '';else return cval_s;"),s.crossVisitParticipation=new Function("v","cn","ex","ct","dl","ev","dv","var s=this,ce;if(typeof(dv)==='undefined')dv=0;if(s.events&&ev){var ay=s.split(ev,',');var ea=s.split(s.events,',');for(var u=0;u<ay.length;u++){for(var x=0;x<ea.length;x++){if(ay[u]==ea[x]){ce=1;}}}}if(!v||v==''){if(ce){s.c_w(cn,'');return'';}else return'';}v=escape(v);var arry=new Array(),a=new Array(),c=s.c_r(cn),g=0,h=new Array();if(c&&c!=''){arry=s.split(c,'],[');for(q=0;q<arry.length;q++){z=arry[q];z=s.repl(z,'[','');z=s.repl(z,']','');z=s.repl(z,\"'\",'');arry[q]=s.split(z,',')}}var e=new Date();e.setFullYear(e.getFullYear()+5);if(dv==0&&arry.length>0&&arry[arry.length-1][0]==v)arry[arry.length-1]=[v,new Date().getTime()];else arry[arry.length]=[v,new Date().getTime()];var start=arry.length-ct<0?0:arry.length-ct;var td=new Date();for(var x=start;x<arry.length;x++){var diff=Math.round((td.getTime()-arry[x][1])/86400000);if(diff<ex){h[g]=unescape(arry[x][0]);a[g]=[arry[x][0],arry[x][1]];g++;}}var data=s.join(a,{delim:',',front:'[',back:']',wrap:\"'\"});s.c_w(cn,data,e);var r=s.join(h,{delim:dl});if(ce)s.c_w(cn,'');return r;"),s.getNewRepeat=new Function("d","cn","var s=this,e=new Date(),cval,sval,ct=e.getTime();d=d?d:30;cn=cn?cn:'s_nr';e.setTime(ct+d*24*60*60*1000);cval=s.c_r(cn);if(cval.length==0){s.c_w(cn,ct+'-New',e);return'New';}sval=s.split(cval,'-');if(ct-sval[0]<30*60*1000&&sval[1]=='New'){s.c_w(cn,ct+'-New',e);return'New';}else{s.c_w(cn,ct+'-Repeat',e);return'Repeat';}"),s.getLoadTimeDim=new Function("","var t='';if(typeof performance!=='undefined'){t=(new Date()).getTime()-performance.timing.requestStart;t=t/1000;t=(t>=0&&t<500)?t.toFixed(1):'';}return t;"),s.inList=new Function("v","l","d","var s=this,ar=Array(),i=0,d=(d)?d:',';if(typeof(l)=='string'){if(s.split)ar=s.split(l,d);else if(l.split)ar=l.split(d);else return-1}else ar=l;while(i<ar.length){if(v==ar[i])return true;i++}return false;"),s.apl=new Function("l","v","d","u","var s=this,m=0;if(!l)l='';if(u){var i,n,a=s.split(l,d);for(i=0;i<a.length;i++){n=a[i];m=m||(u==1?(n==v):(n.toLowerCase()==v.toLowerCase()));}}if(!m)l=l?l+d+v:v;return l"),s.split=new Function("l","d","var i,x=0,a=new Array;while(l){i=l.indexOf(d);i=i>-1?i:l.length;a[x++]=l.substring(0,i);l=l.substring(i+d.length);}return a"),s.m_Survey_c='var m=s.m_i("Survey");m.launch=function(i,e,c,o,f){this._boot();var m=this,g=window.s_sv_globals||{},l,j;if(g.unloaded||m._blocked())return 0;i=i&&i.constructor&&i.constructor==Array?i:[i];l=g.manualTriggers;for(j=0;j<i.length;++j)l[l.length]={l:m._suites,i:i[j],e:e||0,c:c||0,o:o||0,f:f||0};m._execute();return 1;};m.version = 10001;m._t=function(){this._boot();var m=this,s=m.s,g=window.s_sv_globals||{},l,impr,i,k,impr={};if(m._blocked())return;for(i=0;i<s.va_t.length;i++){k=s.va_t[i];if(s[k]) impr[k]=s[k];}impr["l"]=m._suites;impr["n"]=impr["pageName"]||"";impr["u"]=impr["pageURL"]||"";impr["c"]=impr["campaign"]||"";impr["r"]=impr["referrer"]||"";l=g.pageImpressions;if(l.length > 4) l[l.length - 4]=null;l[l.length]=impr;m._execute();};m._rr=function(){var g=window.s_sv_globals||{},f=g.onScQueueEmpty||0;if(f)f();};m._blocked=function(){var m=this,g=window.s_sv_globals||{};return !m._booted||g.stop||!g.pending&&!g.triggerRequested;};m._execute=function(){if(s_sv_globals.execute)setTimeout("s_sv_globals.execute();",0);};m._boot=function(){var m=this,s=m.s,w=window,g,c,d=s.dc,e=s.visitorNamespace,n=navigator.appName.toLowerCase(),a=navigator.userAgent,v=navigator.appVersion,h,i,j,k,l,b;if(w.s_sv_globals)return;if(!((b=v.match(/AppleWebKit\\/([0-9]+)/))?521<b[1]:n=="netscape"?a.match(/gecko\\//i):(b=a.match(/opera[ \\/]?([0-9]+).[0-9]+/i))?7<b[1]:n=="microsoft internet explorer"&&!v.match(/macintosh/i)&&(b=v.match(/msie ([0-9]+).([0-9]+)/i))&&(5<b[1]||b[1]==5&&4<b[2])))return;g=w.s_sv_globals={};g.module=m;g.pending=0;g.incomingLists=[];g.pageImpressions=[];g.manualTriggers=[];e="survey";c=g.config={};m._param(c,"dynamic_root",(e?e+".":"")+d+".2o7.net/survey/dynamic");m._param(c,"gather_root",(e?e+".":"")+d+".2o7.net/survey/gather");g.url=location.protocol+"//"+c.dynamic_root;g.gatherUrl=location.protocol+"//"+c.gather_root;g.dataCenter=d;g.onListLoaded=new Function("r","b","d","i","l","s_sv_globals.module._loaded(r,b,d,i,l);");m._suites=(m.suites||s.un).toLowerCase().split(",");l=m._suites;b={};for(j=0;j<l.length;++j){i=l[j];if(i&&!b[i]){h=i.length;for(k=0;k<i.length;++k)h=(h&0x03ffffff)<<5^h>>26^i.charCodeAt(k);b[i]={url:g.url+"/suites/"+(h%251+100)+"/"+encodeURIComponent(i.replace(/\\|/,"||").replace(/\\//,"|-"))};++g.pending;}}g.suites=b;setTimeout("s_sv_globals.module._load();",0);m._booted=1;};m._param=function(c,n,v){var p="s_sv_",w=window,u="undefined";if(typeof c[n]==u)c[n]=typeof w[p+n]==u?v:w[p+n];};m._load=function(){var m=this,g=s_sv_globals,q=g.suites,r,i,n="s_sv_sid",b=m.s.c_r(n);if(!b){b=parseInt((new Date()).getTime()*Math.random());m.s.c_w(n,b);}for(i in q){r=q[i];if(!r.requested){r.requested=1;m._script(r.url+"/list.js?"+b);}}};m._loaded=function(r,b,d,i,l){var m=this,g=s_sv_globals,n=g.incomingLists;--g.pending;if(!g.commonRevision){g.bulkRevision=b;g.commonRevision=r;g.commonUrl=g.url+"/common/"+b;}else if(g.commonRevision!=r)return;if(!l.length)return;n[n.length]={r:i,l:l};if(g.execute)g.execute();else if(!g.triggerRequested){g.triggerRequested=1;m._script(g.commonUrl+"/trigger.js");}};m._script=function(u){var d=document,e=d.createElement("script");e.type="text/javascript";e.src=u;d.getElementsByTagName("head")[0].appendChild(e);};if(m.onLoad)m.onLoad(s,m)',s.m_i("Survey"),s.m_Media_c="var m=s.m_i('Media');if(m.completeByCloseOffset==undefined)m.completeByCloseOffset=1;if(m.completeCloseOffsetThreshold==undefined)m.completeCloseOffsetThreshold=1;m.cn=function(n){var m=this;return m.s.rep(m.s.rep(m.s.rep(n,\"\\n\",''),\"\\r\",''),'--**--','')};m.open=function(n,l,p,b){var m=this,i=new Object,tm=new Date,a='',x;n=m.cn(n);if(!l)l=-1;if(n&&p){if(!m.l)m.l=new Object;if(m.l[n])m.close(n);if(b&&b.id)a=b.id;if(a)for (x in m.l)if(m.l[x]&&m.l[x].a==a)m.close(m.l[x].n);i.n=n;i.l=l;i.o=0;i.x=0;i.p=m.cn(m.playerName?m.playerName:p);i.a=a;i.t=0;i.ts=0;i.s=Math.floor(tm.getTime()/1000);i.lx=0;i.lt=i.s;i.lo=0;i.e='';i.to=-1;i.tc=0;i.fel=new Object;i.vt=0;i.sn=0;i.sx=\"\";i.sl=0;i.sg=0;i.sc=0;i.us=0;i.ad=0;i.adpn;i.adpp;i.adppp;i.clk;i.CPM;i.co=0;i.cot=0;i.lm=0;i.lom=0;m.l[n]=i}};m.openAd=function(n,l,p,pn,pp,ppp,CPM,b){var m=this,i=new Object;n=m.cn(n);m.open(n,l,p,b);i=m.l[n];if(i){i.ad=1;i.adpn=m.cn(pn);i.adpp=pp;i.adppp=ppp;i.CPM=CPM}};m._delete=function(n){var m=this,i;n=m.cn(n);i=m.l[n];m.l[n]=0;if(i&&i.m)clearTimeout(i.m.i)};m.close=function(n){this.e(n,0,-1)};m.play=function(n,o,sn,sx,sl){var m=this,i;i=m.e(n,1,o,sn,sx,sl);if(i&&!i.m){i.m=new Object;i.m.m=new Function('var m=s_c_il['+m._in+'],i;if(m.l){i=m.l[\"'+m.s.rep(i.n,'\"','\\\\\"')+'\"];if(i){if(i.lx==1)m.e(i.n,3,-1);i.m.i=setTimeout(i.m.m,1000)}}');i.m.m()}};m.click=function(n,o){this.e(n,7,o)};m.complete=function(n,o){this.e(n,5,o)};m.stop=function(n,o){this.e(n,2,o)};m.track=function(n){this.e(n,4,-1)};m.bcd=function(vo,i){var m=this,ns='a.media.',v=vo.linkTrackVars,e=vo.linkTrackEvents,pe='m_i',pev3,c=vo.contextData,x;if(i.ad){ns+='ad.';if(i.adpn){c['a.media.name']=i.adpn;c[ns+'pod']=i.adpp;c[ns+'podPosition']=i.adppp;}if(!i.vt)c[ns+'CPM']=i.CPM;}if (i.clk) {c[ns+'clicked']=1;i.clk=0}c['a.contentType']='video'+(i.ad?'Ad':'');c['a.media.channel']=m.channel;c[ns+'name']=i.n;c[ns+'playerName']=i.p;if(i.l>0)c[ns+'length']=i.l;if(Math.floor(i.ts)>0)c[ns+'timePlayed']=Math.floor(i.ts);if(!i.vt){c[ns+'view']=true;pe='m_s';i.vt=1}if(i.sx){c[ns+'segmentNum']=i.sn;c[ns+'segment']=i.sx;if(i.sl>0)c[ns+'segmentLength']=i.sl;if(i.sc&&i.ts>0)c[ns+'segmentView']=true}if(!i.cot&&i.co){c[ns+\"complete\"]=true;i.cot=1}if(i.lm>0)c[ns+'milestone']=i.lm;if(i.lom>0)c[ns+'offsetMilestone']=i.lom;if(v)for(x in c)v+=',contextData.'+x;pev3=c['a.contentType'];vo.pe=pe;vo.pev3=pev3;var d=m.contextDataMapping,y,a,l,n;if(d){vo.events2='';if(v)v+=',events';for(x in d){if(x.substring(0,ns.length)==ns)y=x.substring(ns.length);else y=\"\";a=d[x];if(typeof(a)=='string'){l=m.s.sp(a,',');for(n=0;n<l.length;n++){a=l[n];if(x==\"a.contentType\"){if(v)v+=','+a;vo[a]=c[x]}else if(y=='view'||y=='segmentView'||y=='clicked'||y=='complete'||y=='timePlayed'||y=='CPM'){if(e)e+=','+a;if(y=='timePlayed'||y=='CPM'){if(c[x])vo.events2+=(vo.events2?',':'')+a+'='+c[x];}else if(c[x])vo.events2+=(vo.events2?',':'')+a}else if(y=='segment'&&c[x+'Num']){if(v)v+=','+a;vo[a]=c[x+'Num']+':'+c[x]}else{if(v)v+=','+a;vo[a]=c[x]}}}else if(y=='milestones'||y=='offsetMilestones'){x=x.substring(0,x.length-1);if(c[x]&&d[x+'s'][c[x]]){if(e)e+=','+d[x+'s'][c[x]];vo.events2+=(vo.events2?',':'')+d[x+'s'][c[x]]}}if(c[x])c[x]=undefined;if(y=='segment'&&c[x+'Num'])c[x+\"Num\"]=undefined}}vo.linkTrackVars=v;vo.linkTrackEvents=e};m.bpe=function(vo,i,x,o){var m=this,pe='m_o',pev3,d='--**--';pe='m_o';if(!i.vt){pe='m_s';i.vt=1}else if(x==4)pe='m_i';pev3=m.s.ape(i.n)+d+Math.floor(i.l>0?i.l:1)+d+m.s.ape(i.p)+d+Math.floor(i.t)+d+i.s+d+(i.to>=0?'L'+Math.floor(i.to):'')+i.e+(x!=0&&x!=2?'L'+Math.floor(o):'');vo.pe=pe;vo.pev3=pev3};m.e=function(n,x,o,sn,sx,sl,pd){var m=this,i,tm=new Date,ts=Math.floor(tm.getTime()/1000),c,l,v=m.trackVars,e=m.trackEvents,ti=m.trackSeconds,tp=m.trackMilestones,to=m.trackOffsetMilestones,sm=m.segmentByMilestones,so=m.segmentByOffsetMilestones,z=new Array,j,t=1,w=new Object,x,ek,tc,vo=new Object;if(!m.channel)m.channel=m.s.wd.location.hostname;n=m.cn(n);i=n&&m.l&&m.l[n]?m.l[n]:0;if(i){if(i.ad){ti=m.adTrackSeconds;tp=m.adTrackMilestones;to=m.adTrackOffsetMilestones;sm=m.adSegmentByMilestones;so=m.adSegmentByOffsetMilestones}if(o<0){if(i.lx==1&&i.lt>0)o=(ts-i.lt)+i.lo;else o=i.lo}if(i.l>0)o=o<i.l?o:i.l;if(o<0)o=0;i.o=o;if(i.l>0){i.x=(i.o/i.l)*100;i.x=i.x>100?100:i.x}if(i.lo<0)i.lo=o;tc=i.tc;w.name=n;w.ad=i.ad;w.length=i.l;w.openTime=new Date;w.openTime.setTime(i.s*1000);w.offset=i.o;w.percent=i.x;w.playerName=i.p;if(i.to<0)w.mediaEvent=w.event='OPEN';else w.mediaEvent=w.event=(x==1?'PLAY':(x==2?'STOP':(x==3?'MONITOR':(x==4?'TRACK':(x==5?'COMPLETE':(x==7?'CLICK':('CLOSE')))))));if(!pd){if(i.pd)pd=i.pd}else i.pd=pd;w.player=pd;if(x>2||(x!=i.lx&&(x!=2||i.lx==1))) {if(!sx){sn=i.sn;sx=i.sx;sl=i.sl}if(x){if(x==1)i.lo=o;if((x<=3||x>=5)&&i.to>=0){t=0;v=e=\"None\";if(i.to!=o){l=i.to;if(l>o){l=i.lo;if(l>o)l=o}z=tp?m.s.sp(tp,','):0;if(i.l>0&&z&&o>=l)for(j=0;j<z.length;j++){c=z[j]?parseFloat(''+z[j]):0;if(c&&(l/i.l)*100<c&&i.x>=c){t=1;j=z.length;w.mediaEvent=w.event='MILESTONE';i.lm=w.milestone=c}}z=to?m.s.sp(to,','):0;if(z&&o>=l)for(j=0;j<z.length;j++){c=z[j]?parseFloat(''+z[j]):0;if(c&&l<c&&o>=c){t=1;j=z.length;w.mediaEvent=w.event='OFFSET_MILESTONE';i.lom=w.offsetMilestone=c}}}}if(i.sg||!sx){if(sm&&tp&&i.l>0){z=m.s.sp(tp,',');if(z){z[z.length]='100';l=0;for(j=0;j<z.length;j++){c=z[j]?parseFloat(''+z[j]):0;if(c){if(i.x<c){sn=j+1;sx='M:'+l+'-'+c;j=z.length}l=c}}}}else if(so&&to){z=m.s.sp(to,',');if(z){z[z.length]=''+(i.l>0?i.l:'E');l=0;for(j=0;j<z.length;j++){c=z[j]?parseFloat(''+z[j]):0;if(c||z[j]=='E'){if(o<c||z[j]=='E'){sn=j+1;sx='O:'+l+'-'+c;j=z.length}l=c}}}}if(sx)i.sg=1}if((sx||i.sx)&&sx!=i.sx){i.us=1;if(!i.sx){i.sn=sn;i.sx=sx}if(i.to>=0)t=1}if((x>=2||i.x>=100)&&i.lo<o){i.t+=o-i.lo;i.ts+=o-i.lo}if(x<=2||(x==3&&!i.lx)){i.e+=(x==1||x==3?'S':'E')+Math.floor(o);i.lx=(x==3?1:x)}if(!t&&i.to>=0&&x<=3){ti=ti?ti:0;if(ti&&i.ts>=ti){t=1;w.mediaEvent=w.event='SECONDS'}}i.lt=ts;i.lo=o}if(!x||(x<=3&&i.x>=100)){if(i.lx!=2)i.e+='E'+Math.floor(o);x=0;v=e=\"None\";w.mediaEvent=w.event=\"CLOSE\"}if(x==7){w.clicked=i.clk=1;t=1}if(x==5||(m.completeByCloseOffset&&(!x||i.x>=100)&&i.l>0&&o>=i.l-m.completeCloseOffsetThreshold)){w.complete=i.co=1;t=1}ek=w.mediaEvent;if(ek=='MILESTONE')ek+='_'+w.milestone;else if(ek=='OFFSET_MILESTONE')ek+='_'+w.offsetMilestone;if(!i.fel[ek]) {w.eventFirstTime=true;i.fel[ek]=1}else w.eventFirstTime=false;w.timePlayed=i.t;w.segmentNum=i.sn;w.segment=i.sx;w.segmentLength=i.sl;if(m.monitor&&x!=4)m.monitor(m.s,w);if(x==0)m._delete(n);if(t&&i.tc==tc){vo=new Object;vo.contextData=new Object;vo.linkTrackVars=v;vo.linkTrackEvents=e;if(!vo.linkTrackVars)vo.linkTrackVars='';if(!vo.linkTrackEvents)vo.linkTrackEvents='';if(m.trackUsingContextData)m.bcd(vo,i);else m.bpe(vo,i,x,o);m.s.t(vo);if(i.us){i.sn=sn;i.sx=sx;i.sc=1;i.us=0}else if(i.ts>0)i.sc=0;i.e=\"\";i.lm=i.lom=0;i.ts-=Math.floor(i.ts);i.to=o;i.tc++}}}return i};m.ae=function(n,l,p,x,o,sn,sx,sl,pd,b){var m=this,r=0;if(n&&(!m.autoTrackMediaLengthRequired||(length&&length>0)) &&p){if(!m.l||!m.l[n]){if(x==1||x==3){m.open(n,l,p,b);r=1}}else r=1;if(r)m.e(n,x,o,sn,sx,sl,pd)}};m.a=function(o,t){var m=this,i=o.id?o.id:o.name,n=o.name,p=0,v,c,c1,c2,xc=m.s.h,x,e,f1,f2='s_media_'+m._in+'_oc',f3='s_media_'+m._in+'_t',f4='s_media_'+m._in+'_s',f5='s_media_'+m._in+'_l',f6='s_media_'+m._in+'_m',f7='s_media_'+m._in+'_c',tcf,w;if(!i){if(!m.c)m.c=0;i='s_media_'+m._in+'_'+m.c;m.c++}if(!o.id)o.id=i;if(!o.name)o.name=n=i;if(!m.ol)m.ol=new Object;if(m.ol[i])return;m.ol[i]=o;if(!xc)xc=m.s.b;tcf=new Function('o','var e,p=0;try{if(o.versionInfo&&o.currentMedia&&o.controls)p=1}catch(e){p=0}return p');p=tcf(o);if(!p){tcf=new Function('o','var e,p=0,t;try{t=o.GetQuickTimeVersion();if(t)p=2}catch(e){p=0}return p');p=tcf(o);if(!p){tcf=new Function('o','var e,p=0,t;try{t=o.GetVersionInfo();if(t)p=3}catch(e){p=0}return p');p=tcf(o)}}v=\"var m=s_c_il[\"+m._in+\"],o=m.ol['\"+i+\"']\";if(p==1){p='Windows Media Player '+o.versionInfo;c1=v+',n,p,l,x=-1,cm,c,mn;if(o){cm=o.currentMedia;c=o.controls;if(cm&&c){mn=cm.name?cm.name:c.URL;l=cm.duration;p=c.currentPosition;n=o.playState;if(n){if(n==8)x=0;if(n==3)x=1;if(n==1||n==2||n==4||n==5||n==6)x=2;}';c2='if(x>=0)m.ae(mn,l,\"'+p+'\",x,x!=2?p:-1,0,\"\",0,0,o)}}';c=c1+c2;if(m.s.isie&&xc){x=m.s.d.createElement('script');x.language='jscript';x.type='text/javascript';x.htmlFor=i;x.event='PlayStateChange(NewState)';x.defer=true;x.text=c;xc.appendChild(x);o[f6]=new Function(c1+'if(n==3){x=3;'+c2+'}setTimeout(o.'+f6+',5000)');o[f6]()}}if(p==2){p='QuickTime Player '+(o.GetIsQuickTimeRegistered()?'Pro ':'')+o.GetQuickTimeVersion();f1=f2;c=v+',n,x,t,l,p,p2,mn;if(o){mn=o.GetMovieName()?o.GetMovieName():o.GetURL();n=o.GetRate();t=o.GetTimeScale();l=o.GetDuration()/t;p=o.GetTime()/t;p2=o.'+f5+';if(n!=o.'+f4+'||p<p2||p-p2>5){x=2;if(n!=0)x=1;else if(p>=l)x=0;if(p<p2||p-p2>5)m.ae(mn,l,\"'+p+'\",2,p2,0,\"\",0,0,o);m.ae(mn,l,\"'+p+'\",x,x!=2?p:-1,0,\"\",0,0,o)}if(n>0&&o.'+f7+'>=10){m.ae(mn,l,\"'+p+'\",3,p,0,\"\",0,0,o);o.'+f7+'=0}o.'+f7+'++;o.'+f4+'=n;o.'+f5+'=p;setTimeout(\"'+v+';o.'+f2+'(0,0)\",500)}';o[f1]=new Function('a','b',c);o[f4]=-1;o[f7]=0;o[f1](0,0)}if(p==3){p='RealPlayer '+o.GetVersionInfo();f1=n+'_OnPlayStateChange';c1=v+',n,x=-1,l,p,mn;if(o){mn=o.GetTitle()?o.GetTitle():o.GetSource();n=o.GetPlayState();l=o.GetLength()/1000;p=o.GetPosition()/1000;if(n!=o.'+f4+'){if(n==3)x=1;if(n==0||n==2||n==4||n==5)x=2;if(n==0&&(p>=l||p==0))x=0;if(x>=0)m.ae(mn,l,\"'+p+'\",x,x!=2?p:-1,0,\"\",0,0,o)}if(n==3&&(o.'+f7+'>=10||!o.'+f3+')){m.ae(mn,l,\"'+p+'\",3,p,0,\"\",0,0,o);o.'+f7+'=0}o.'+f7+'++;o.'+f4+'=n;';c2='if(o.'+f2+')o.'+f2+'(o,n)}';if(m.s.wd[f1])o[f2]=m.s.wd[f1];m.s.wd[f1]=new Function('a','b',c1+c2);o[f1]=new Function('a','b',c1+'setTimeout(\"'+v+';o.'+f1+'(0,0)\",o.'+f3+'?500:5000);'+c2);o[f4]=-1;if(m.s.isie)o[f3]=1;o[f7]=0;o[f1](0,0)}};m.as=new Function('e','var m=s_c_il['+m._in+'],l,n;if(m.autoTrack&&m.s.d.getElementsByTagName){l=m.s.d.getElementsByTagName(m.s.isie?\"OBJECT\":\"EMBED\");if(l)for(n=0;n<l.length;n++)m.a(l[n]);}');if(s.wd.attachEvent)s.wd.attachEvent('onload',m.as);else if(s.wd.addEventListener)s.wd.addEventListener('load',m.as,false);if(m.onLoad)m.onLoad(s,m)",s.m_i("Media");var s_code="",s_objectID;s_giqf(),define("omniture",function(e){return function(){var t;return t||e.s}}(this)),define("common/modules/analytics/omniture",["common/common","common/utils/detect","common/modules/experiments/ab","common/utils/storage","common/modules/identity/api","common/utils/cookies","omniture","common/modules/analytics/mvt-cookie","common/modules/analytics/beacon"],function(e,t,n,o,i,s,r,a,c){function l(r,l){var u,d="gu.analytics.",m=this;l=l||{},this.pageviewSent=!1,this.logView=function(){r.t(),this.confirmPageView()},this.logUpdate=function(){r.linkTrackVars="events,eVar7",r.linkTrackEvents="event90",r.events="event90",r.eVar7=u.page.analyticsName,r.tl(!0,"o","AutoUpdate Refresh")},this.logTag=function(e){var t,n;e.tag&&(e.sameHost&&!e.samePage?(t={pageName:r.pageName,tag:e.tag,time:(new Date).getTime()},o.session.set(d+"referrerVars",t)):(m.populateEventProperties(e.tag),n=e.samePage?!0:e.target,r.tl(n,"o",e.tag)))},this.populateEventProperties=function(e){r.linkTrackVars="eVar37,events",r.linkTrackEvents="event37",r.events="event37",r.eVar37=u.page.contentType?u.page.contentType+":"+e:e},this.trackNonLinkEvent=function(e){r.linkTrackVars="eVar37,events",r.linkTrackEvents="event37",r.events="event37",r.eVar37=u.page.contentType?u.page.contentType+":"+e:e,r.tl(!0,"o",e)},this.populatePageProperties=function(){r.cookieDomainPeriods="2",r.linkInternalFilters+=",localhost,gucode.co.uk,gucode.com,guardiannews.com,int.gnl,proxylocal.com,theguardian.com",r.trackingServer="hits.theguardian.com",r.trackingServerSecure="hits-secure.theguardian.com",r.ce="UTF-8",r.pageName=u.page.analyticsName,r.prop1=u.page.headline||"",i.getUserFromCookie()&&(r.prop2="GUID:"+i.getUserFromCookie().id,r.eVar2="GUID:"+i.getUserFromCookie().id),r.prop3=u.page.publication||"",r.channel="Network Front"===u.page.contentType?"Network Front":u.page.section||"",r.prop9=u.page.contentType||"",r.prop4=u.page.keywords||"",r.prop6=u.page.author||"",r.prop7=u.page.webPublicationDate||"",r.prop8=u.page.pageCode||"",r.prop9=u.page.contentType||"",r.prop10=u.page.tones||"",r.prop13=u.page.series||"",r.prop25=u.page.blogs||"",r.prop14=u.page.buildNumber||"";var e="frontend";r.prop19=e,r.eVar19=e,r.prop31=i.getUserFromCookie()?"registered user":"guest user",r.eVar31=i.getUserFromCookie()?"registered user":"guest user",r.prop47=u.page.edition||"";var c=n.makeOmnitureTag(u,document);r.prop51=c,r.eVar51=c;var d="notAlpha,";"2"===s.get("GU_ALPHA")?(d="r2alph2,",r.prop51=d+r.prop51,r.eVar51=d+r.eVar51):"true"===s.get("GU_ALPHA")&&(d="r2alpha,",r.prop51=d+r.prop51,r.eVar51=d+r.eVar51),r.prop51&&(r.events=r.apl(r.events,"event58",","));var m=a.getMvtFullId();m&&(r.eVar60=m),u.page.commentable&&(r.events=r.apl(r.events,"event46",",")),"identity"===u.page.section&&(r.prop11="Users",r.prop9="userid",r.eVar27=u.page.omnitureErrorMessage||"",r.eVar42=u.page.returnUrl||"",r.hier2="GU/Users/Registration",r.events=r.apl(r.events,u.page.omnitureEvent,",")),r.prop56="Javascript",r.prop65=u.page.headline||"",r.prop67="nextgen-served",r.prop68=t.getConnectionSpeed(l.performance,null,!0),r.prop30=u.page.webPublicationDate?"content":"non-content",""!==r.getQueryParam("INTCMP")&&(r.eVar50=r.getQueryParam("INTCMP")),r.eVar50=r.getValOnce(r.eVar50,"s_intcampaign",0),u.page.inBodyInternalLinkCount&&(r.prop58=u.page.inBodyInternalLinkCount),u.page.inBodyExternalLinkCount&&(r.prop69=u.page.inBodyExternalLinkCount);var f=o.session.get("gu.analytics.referrerVars");if(f){var p=(new Date).getTime();p-f.time<6e4&&(r.eVar24=f.pageName,r.eVar37=f.tag,r.events="event37"),o.session.remove("gu.analytics.referrerVars")}r.prop75=u.page.wordCount||0,r.eVar75=u.page.wordCount||0},this.loaded=function(e){this.populatePageProperties(),this.logView(),"function"==typeof e&&e()},this.go=function(e,t){var n=this;u=e,window.s_account=u.page.omnitureAccount,r=window.s,n.loaded(t)},this.confirmPageView=function(){var t=this,n=setInterval(function(){"undefined"!=typeof s_i_guardian&&(s_i_guardian.complete===!0||s_i_guardian.width+s_i_guardian.height>0)&&(clearInterval(n),t.pageviewSent=!0,e.mediator.emit("module:analytics:omniture:pageview:sent"))},250);setTimeout(function(){clearInterval(n)},1e4)},e.mediator.on("module:clickstream:interaction",m.trackNonLinkEvent),e.mediator.on("module:clickstream:click",m.logTag),e.mediator.on("module:autoupdate:loaded",function(){m.populatePageProperties(),m.logUpdate()}),e.mediator.on("module:analytics:omniture:pageview:sent",function(){c.fire("/count/pva.gif")})}return l}),define("common/modules/analytics/scrollDepth",["common/utils/mediator","lodash/objects/assign"],function(e,t){function n(e){this.config=t(this.config,e),this.config.isContent&&(this.config.contentEl=this.contentEl||document.getElementById("article")),this.init()}return n.prototype.config={changeThreshold:10,isContent:!1,pageEl:document.body},n.prototype.data={page:{start:(new Date).getTime(),depth:0,duration:0},content:{depth:0}},n.prototype.timeSince=function(e){return(new Date).getTime()-e},n.prototype.getPercentageInViewPort=function(e){var t=e.getBoundingClientRect(),n=window.innerHeight||document.body.clientHeight;return t.bottom<0||t.bottom<n?100:t.top>n?0:t.top>0?100/(t.height||1)*(n-t.top):100/(t.height||1)*(Math.abs(t.top)+n)},n.prototype.isInViewport=function(e){var t=e.getBoundingClientRect();return t.top<(window.innerHeight||document.body.clientHeight)&&t.left<(window.innerWidth||document.body.clientWidth)},n.prototype.setData=function(e){var t=this.getPercentageInViewPort(this.config[e+"El"]);
return t-this.data[e].depth>this.config.changeThreshold?(this.data[e].depth=t,"number"==typeof this.data[e].duration&&(this.data[e].duration=this.timeSince(this.data[e].start)),!0):!1},n.prototype.hasDataChanged=function(){var e=this.setData("page"),t=this.config.isContent?this.setData("content"):!1;(e||t)&&this.log()},n.prototype.assertScrolling=function(){function t(){e.emit("scrolldepth:inactive")}"number"==typeof this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(t.bind(this),1e3)},n.prototype.log=function(){e.emit("scrolldepth:data",this.data)},n.prototype.init=function(){e.on("window:scroll",this.assertScrolling.bind(this)),e.on("scrolldepth:inactive",this.hasDataChanged.bind(this)),e.on("module:clickstream:click",this.hasDataChanged.bind(this))},n}),define("common/modules/analytics/commercial/tags/common/audience-science",["common/utils/cookies","common/utils/storage"],function(e,t){function n(){var e=t.local.get("gu.ads.audsci");return e?e:[]}function o(n){window.DM_prepClient=function(e,t){if(t.DM_addEncToLoc("siteName",""),t.DM_addEncToLoc("comFolder",""),t.DM_addEncToLoc("mobile",!0),n.audienceScienceData)for(var o=0,i=n.audienceScienceData.length;i>o;++o){var s=n.audienceScienceData[o];t.DM_addEncToLoc(s.name,s.value)}},window.DM_onSegsAvailable=function(n){t.local.set("gu.ads.audsci",i(n)),e.cleanUp(["rsi_segs"])},require([s],function(){window.E05516.DM_tag()})}function i(e){for(var t=[],n=/.*_5.*/,o=/([^_]{2})[^_]*_(.*)/,i=0,s=e.length;s>i&&100>i;++i)if(!n.test(e[i])){var r=o.exec(e[i]);null!==r&&(t.push(r[1]+r[2]),++i)}return t}var s="js!http://js.revsci.net/gateway/gw.js?csid=E05516";return{getSegments:n,load:o}}),define("common/modules/adverts/document-write",["common/utils/mediator","common/utils/ajax","common/utils/detect","common/modules/analytics/commercial/tags/common/audience-science"],function(e,t,n,o){function i(e){return e.map(function(e){return"&a="+e}).join("")}function s(e){var t=""===e.pageId?"":e.pageId+"/";return guardian.config.page.oasSiteIdHost+"/"+t+"oas.html"}function r(e){return e.keywords.split(",").map(function(e){return"k="+encodeURIComponent(e.replace(/\s/g,"-").toLowerCase())}).join("&")}function a(e){return encodeURIComponent(e.contentType.toLowerCase())}function c(e){return e.map(function(e){return e.name}).join(",")}function l(e){return e.map(function(e){return"&gdncrm="+encodeURIComponent(e)}).join("")}function u(e,t,n){var u=e.oasUrl+"adstream_[REQUEST_TYPE].ads/"+s(e)+"/[RANDOM]@[SLOTS][QUERY]",d="mjx",m="?";e.keywords&&(m+=r(e)),e.contentType&&(m+="&pt="+a(e),m+="&ct="+a(e)),e.section&&(m+="&cat="+encodeURIComponent(e.section.toLowerCase()));var f=o.getSegments();f&&(m+=i(f)),n&&(m+=l(n));var p=u;return p=p.replace("[RANDOM]",Math.random().toString().substring(2,11)),p=p.replace("[SLOTS]",c(t)),p=p.replace("[REQUEST_TYPE]",d),p=p.replace("[QUERY]",m)}function d(t){var n=!1;return function(){return t.readyState&&"complete"!==t.readyState&&"loaded"!==t.readyState||n?!1:(t.onload=t.onreadystatechange=null,n=!0,void e.emit("modules:adverts:docwrite:loaded"))}}function m(e){if(e.config){var t=e.url||u(e.config.page,e.slots,e.userSegments),n=document.createElement("script");n.type="text/javascript",n.src=t,n.async="async",n.onload=n.onreadystatechange=d(n),document.querySelector("head").appendChild(n)}}return{load:m,generateUrl:u,getKeywords:r}}),function(){function e(e,a){e=e||"",a=a||{};for(var c in t)t.hasOwnProperty(c)&&(a.autoFix&&(a["fix_"+c]=!0),a.fix=a.fix||a["fix_"+c]);var l=[],u=function(t){e+=t},d=function(t){e=t+e},m={comment:/^<!--/,endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s>]/i,startTag:/^</,chars:/^[^<]/},f={comment:function(){var t=e.indexOf("-->");return t>=0?{content:e.substr(4,t),length:t+3}:void 0},endTag:function(){var t=e.match(o);return t?{tagName:t[1],length:t[0].length}:void 0},atomicTag:function(){var t=f.startTag();if(t){var n=e.slice(t.length);if(n.match(new RegExp("</\\s*"+t.tagName+"\\s*>","i"))){var o=n.match(new RegExp("([\\s\\S]*?)</\\s*"+t.tagName+"\\s*>","i"));if(o)return{tagName:t.tagName,attrs:t.attrs,content:o[1],length:o[0].length+t.length}}}},startTag:function(){var t=e.match(n);if(t){var o={};return t[2].replace(i,function(e,t){var n=arguments[2]||arguments[3]||arguments[4]||s.test(t)&&t||null;o[t]=n}),{tagName:t[1],attrs:o,unary:!!t[3],length:t[0].length}}},chars:function(){var t=e.indexOf("<");return{length:t>=0?t:e.length}}},p=function(){for(var t in m)if(m[t].test(e)){r&&console.log("suspected "+t);var n=f[t]();return n?(r&&console.log("parsed "+t,n),n.type=n.type||t,n.text=e.substr(0,n.length),e=e.slice(n.length),n):null}},h=function(e){for(var t;t=p();)if(e[t.type]&&e[t.type](t)===!1)return},g=function(){var t=e;return e="",t},v=function(){return e};return a.fix&&!function(){var t=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i,n=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i,o=[];o.last=function(){return this[this.length-1]},o.lastTagNameEq=function(e){var t=this.last();return t&&t.tagName&&t.tagName.toUpperCase()===e.toUpperCase()},o.containsTagName=function(e){for(var t,n=0;t=this[n];n++)if(t.tagName===e)return!0;return!1};var i=function(e){return e&&"startTag"===e.type&&(e.unary=t.test(e.tagName)||e.unary),e},s=p,r=function(){var t=e,n=i(s());return e=t,n},c=function(){var e=o.pop();d("</"+e.tagName+">")},l={startTag:function(e){var t=e.tagName;"TR"===t.toUpperCase()&&o.lastTagNameEq("TABLE")?(d("<TBODY>"),m()):a.fix_selfClose&&n.test(t)&&o.containsTagName(t)?o.lastTagNameEq(t)?c():(d("</"+e.tagName+">"),m()):e.unary||o.push(e)},endTag:function(e){var t=o.last();t?a.fix_tagSoup&&!o.lastTagNameEq(e.tagName)?c():o.pop():a.fix_tagSoup&&u()}},u=function(){s(),m()},m=function(){var e=r();e&&l[e.type]&&l[e.type](e)};p=function(){return m(),i(s())}}(),{append:u,readToken:p,readTokens:h,clear:g,rest:v,stack:l}}var t=function(){var e,t={},n=this.document.createElement("div");return e="<P><I></P></I>",n.innerHTML=e,t.tagSoup=n.innerHTML!==e,n.innerHTML="<P><i><P></P></i></P>",t.selfClose=2===n.childNodes.length,t}(),n=/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,o=/^<\/([\-A-Za-z0-9_]+)[^>]*>/,i=/([\-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,s=/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i,r=!1;e.supports=t,e.tokenToString=function(e){var t={comment:function(e){return"<--"+e.content+"-->"},endTag:function(e){return"</"+e.tagName+">"},atomicTag:function(e){return console.log(e),t.startTag(e)+e.content+t.endTag(e)},startTag:function(e){var t="<"+e.tagName;for(var n in e.attrs){var o=e.attrs[n];t+=" "+n+'="'+(o?o.replace(/(^|[^\\])"/g,'$1\\"'):"")+'"'}return t+(e.unary?"/>":">")},chars:function(e){return e.text}};return t[e.type](e)},e.escapeAttributes=function(e){var t={};for(var n in e){var o=e[n];t[n]=o&&o.replace(/(^|[^\\])"/g,'$1\\"')}return t};for(var a in t)e.browserHasFlaw=e.browserHasFlaw||!t[a]&&a;this.htmlParser=e}(),function(){function e(){}function t(e){return"function"==typeof e}function n(e,t,n){var o,i=e&&e.length||0;for(o=0;i>o;o++)t.call(n,e[o],o)}function o(e,t,n){var o;for(o in e)e.hasOwnProperty(o)&&t.call(n,o,e[o])}function i(e,t){return o(t,function(t,n){e[t]=n}),e}function s(e,t){return e=e||{},o(t,function(t,n){null==e[t]&&(e[t]=n)}),e}function r(e){try{return u.call(e)}catch(t){var o=[];return n(e,function(e){o.push(e)}),o}}function a(e){return/^script$/i.test(e.tagName)}var c=this;if(!c.postscribe){var l=!1,u=Array.prototype.slice,d=function(){function e(e,t,n){var o=u+t;if(2===arguments.length){var i=e.getAttribute(o);return null==i?i:String(i)}null!=n&&""!==n?e.setAttribute(o,n):e.removeAttribute(o)}function s(t,n){var o=t.ownerDocument;i(this,{root:t,options:n,win:o.defaultView||o.parentWindow,doc:o,parser:c.htmlParser("",{autoFix:!0}),actuals:[t],proxyHistory:"",proxyRoot:o.createElement(t.nodeName),scriptStack:[],writeQueue:[]}),e(this.proxyRoot,"proxyof",0)}var u="data-ps-";return s.prototype.write=function(){[].push.apply(this.writeQueue,arguments);for(var e;!this.deferredRemote&&this.writeQueue.length;)e=this.writeQueue.shift(),t(e)?this.callFunction(e):this.writeImpl(e)},s.prototype.callFunction=function(e){var t={type:"function",value:e.name||e.toString()};this.onScriptStart(t),e.call(this.win,this.doc),this.onScriptDone(t)},s.prototype.writeImpl=function(e){this.parser.append(e);for(var t,n=[];(t=this.parser.readToken())&&!a(t);)n.push(t);this.writeStaticTokens(n),t&&this.handleScriptToken(t)},s.prototype.writeStaticTokens=function(e){var t=this.buildChunk(e);if(t.actual)return t.html=this.proxyHistory+t.actual,this.proxyHistory+=t.proxy,this.proxyRoot.innerHTML=t.html,l&&(t.proxyInnerHTML=this.proxyRoot.innerHTML),this.walkChunk(),l&&(t.actualInnerHTML=this.root.innerHTML),t},s.prototype.buildChunk=function(e){var t=this.actuals.length,o=[],i=[],s=[];return n(e,function(e){if(o.push(e.text),e.attrs){if(!/^noscript$/i.test(e.tagName)){var n=t++;i.push(e.text.replace(/(\/?>)/," "+u+"id="+n+" $1")),"ps-script"!==e.attrs.id&&s.push("atomicTag"===e.type?"":"<"+e.tagName+" "+u+"proxyof="+n+(e.unary?" />":">"))}}else i.push(e.text),s.push("endTag"===e.type?e.text:"")}),{tokens:e,raw:o.join(""),actual:i.join(""),proxy:s.join("")}},s.prototype.walkChunk=function(){for(var t,n=[this.proxyRoot];null!=(t=n.shift());){var o=1===t.nodeType,i=o&&e(t,"proxyof");if(!i){o&&(this.actuals[e(t,"id")]=t,e(t,"id",null));var s=t.parentNode&&e(t.parentNode,"proxyof");s&&this.actuals[s].appendChild(t)}n.unshift.apply(n,r(t.childNodes))}},s.prototype.handleScriptToken=function(e){var t=this.parser.clear();t&&this.writeQueue.unshift(t),e.src=e.attrs.src||e.attrs.SRC,e.src&&this.scriptStack.length?this.deferredRemote=e:this.onScriptStart(e);var n=this;this.writeScriptToken(e,function(){n.onScriptDone(e)})},s.prototype.onScriptStart=function(e){e.outerWrites=this.writeQueue,this.writeQueue=[],this.scriptStack.unshift(e)},s.prototype.onScriptDone=function(e){return e!==this.scriptStack[0]?void this.options.error({message:"Bad script nesting or script finished twice"}):(this.scriptStack.shift(),this.write.apply(this,e.outerWrites),void(!this.scriptStack.length&&this.deferredRemote&&(this.onScriptStart(this.deferredRemote),this.deferredRemote=null)))},s.prototype.writeScriptToken=function(e,t){var n=this.buildScript(e),o=this.shouldRelease(n),i=this.options.afterAsync;e.src&&(n.src=e.src,this.scriptLoadHandler(n,o?i:function(){t(),i()}));try{this.insertScript(n),(!e.src||o)&&t()}catch(s){this.options.error(s),t()}},s.prototype.buildScript=function(e){var t=this.doc.createElement(e.tagName);return o(e.attrs,function(e,n){t.setAttribute(e,n)}),e.content&&(t.text=e.content),t},s.prototype.insertScript=function(e){this.writeImpl('<span id="ps-script"/>');var t=this.doc.getElementById("ps-script");t.parentNode.replaceChild(e,t)},s.prototype.scriptLoadHandler=function(e,t){function n(){e=e.onload=e.onreadystatechange=e.onerror=null,t()}var o=this.options.error;i(e,{onload:function(){n()},onreadystatechange:function(){/^(loaded|complete)$/.test(e.readyState)&&n()},onerror:function(){o({message:"remote script failed "+e.src}),n()}})},s.prototype.shouldRelease=function(e){var t=/^script$/i.test(e.nodeName);return!t||!!(this.options.releaseAsync&&e.src&&e.hasAttribute("async"))},s}(),m=function(){function n(){var e=u.shift();e&&(e.stream=o.apply(null,e))}function o(t,o,s){function c(e){e=s.beforeWrite(e),m.write(e),s.afterWrite(e)}m=new d(t,s),m.id=l++,m.name=s.name||m.id,a.streams[m.name]=m;var u=t.ownerDocument,f={write:u.write,writeln:u.writeln};i(u,{write:function(){return c(r(arguments).join(""))},writeln:function(){return c(r(arguments).join("")+"\n")}});var p=m.win.onerror||e;return m.win.onerror=function(e,t,n){s.error({msg:e+" - "+t+":"+n}),p.apply(m.win,arguments)},m.write(o,function(){i(u,f),m.win.onerror=p,s.done(),m=null,n()}),m}function a(o,i,r){t(r)&&(r={done:r}),r=s(r,{releaseAsync:!1,afterAsync:e,done:e,error:function(e){throw e},beforeWrite:function(e){return e},afterWrite:e}),o=/^#/.test(o)?c.document.getElementById(o.substr(1)):o.jquery?o[0]:o;var a=[o,i,r];return o.postscribe={cancel:function(){a.stream?a.stream.abort():a[1]=e}},u.push(a),m||n(),o.postscribe}var l=0,u=[],m=null;return i(a,{streams:{},queue:u,WriteStream:d})}();c.postscribe=m}}(),define("postscribe",function(e){return function(){var t;return t||e.postscribe}}(this)),define("common/modules/adverts/documentwriteslot",["common/utils/mediator","bonzo","postscribe","bean"],function(e,t,n,o){var i=function(e,t){this.name=e,this.el=t,this.loaded=!1};return i.prototype.setDimensions=function(e){this.dimensions=e},i.prototype.render=function(){try{var i=this.el;n(i,'<script>OAS_RICH("'+this.name+'")</script>'),this.loaded=!0,o.fire(i,"ad-load")}catch(s){var r="Top2"===this.name?this.el.parentNode.parentNode:this.el.parentNode;t(r).addClass("u-h"),e.emit("module:error",s,"common/modules/adverts/documentwriteslot.js",27)}},i}),define("common/modules/adverts/dimensionMap",[],function(){return{Top2:{width:"300",height:"50"},Top:{width:"728",height:"90"},Bottom2:{width:"300",height:"50"},Bottom:{width:"728",height:"90"}}}),define("common/modules/adverts/adverts",["common/$","qwery","bonzo","common/utils/ajax","common/modules/userPrefs","common/utils/detect","common/modules/adverts/document-write","common/modules/adverts/documentwriteslot","common/modules/adverts/dimensionMap","common/modules/adverts/userAdTargeting"],function(e,t,n,o,i,s,r,a,c,l){function u(t){g=[],v=t;for(var n=window.innerWidth>810?"median":"base",o=document.querySelectorAll(".ad-slot"),i=0,s=o.length;s>i;i++){var u=o[i];if("none"!==e(u).css("display")){var d,m,f=u.querySelector(".ad-container");f.innerHTML="",d=u.getAttribute("data-"+n),m=new a(d,f),m.setDimensions(c[d]),g.push(m)}}r.load({config:v,slots:g,userSegments:l.getUserSegments()})}function d(){for(var e=0,t=g.length;t>e;++e)g[e].loaded||""!==g[e].el.innerHTML||g[e].render()}function m(){if(g.length)for(var e=0,t=g.length;t>e;++e)g[e].el.innerHTML="",g[e].loaded=!1}function f(){m(),u(v)}function p(e){return e.offsetTop<window.innerHeight+window.pageYOffset&&e.offsetTop+e.offsetHeight>window.pageYOffset}function h(){e(".ad-slot").addClass("is-hidden"),e(".top-banner-ad-container").addClass("is-invisible")}var g,v;return{hideAds:h,init:u,load:d,reload:f,isOnScreen:p}}),define("common/modules/analytics/omnitureMedia",["common/common","bean"],function(e,t){function n(n){var o,i=this,r=n.config,a=n.el,c="content",l="HTML5 Video",u=r.page.webTitle,d=r.page.source||"",m=r.page.blockVideoAds||"",f={advert:!0,content:!0};this.getDuration=function(){return a.duration},this.getPosition=function(){return a.currentTime},this.play=function(){f.content===!0&&f.advert===!0&&i.execWhenDuration(function(){i.trackUserInteraction("Play","User clicked play",!1),a.advertWasRequested&&i.trackUserInteraction("Advert","Video advert was requested",!1)}),"content"===c&&f[c]===!0||"advert"===c&&f[c]===!0?(i.execWhenDuration(function(){s.Media.open(u,i.getDuration(),l),s.Media.play(u,i.getPosition())}),f[c]=!1):s.Media.play(u,i.getPosition())},this.pause=function(){s.Media.stop(u,this.getPosition())},this.buffer=function(){s.Media.stop(u,this.getPosition())},this.seeking=function(){s.Media.stop(u,this.getPosition())},this.seeked=function(){s.Media.play(u,this.getPosition())},this.trackUserInteraction=function(e,t,n){clearTimeout(o);var i=function(){var n;switch(e){case"Play":n="event98";break;case"Advert":n="event97";break;default:n="event14"}s.prop41=e,s.linkTrackVars="prop43,prop44,prop45,eVar43,eVar44,eVar45,prop41,events",s.linkTrackEvents=n,s.events=n,s.tl(!0,"o",t)};n?o=setTimeout(i,250):i()},this.trackVideoAdvert=function(){c="advert",s.trackVideoAd()},this.trackVideoContent=function(){c="content",s.trackVideoContent(d,m)},this.execWhenDuration=function(e){var t=this.getDuration();t>0?e():setTimeout(function(){i.execWhenDuration(e)},100)},this.init=function(){var n=this;s.loadMediaModule(d,m),s.prop43="Video",s.prop44=r.page.analyticsName,s.prop45=s.channel,s.eVar43=s.prop43,s.eVar44=s.prop44,s.eVar45=s.prop45;var o=e.debounce(n.play,250);t.on(a,"play",o),t.on(a,"pause",function(){n.pause()}),t.on(a,"seeking",function(){n.seeking()}),t.on(a,"seeked",function(){n.seeked()}),t.on(a,"volumechange",function(){n.trackUserInteraction("Volume","User Changed Volume",!0)}),t.on(a,"play:advert",function(){n.trackVideoAdvert()}),t.on(a,"play:content",function(){n.trackVideoContent()})}}return n}),define("common/modules/analytics/livestats",["common/utils/cookies","common/utils/storage","common/modules/analytics/beacon","common/modules/experiments/ab"],function(e,t,n,o){function i(){var e="gu.session";return"undefined"!=typeof r?r:(t.session.get(e)?r=!1:(t.session.set(e,"true"),r=!0),r)}function s(e,t){var n=[];for(var o in e)n.push(o+"="+encodeURIComponent(e[o]));return t+"?"+n.join("&")}var r,a={log:function(t){if(t.switches.liveStats){var r=!!e.get("GU_ALPHA");if(r){var a={platform:"responsive"};a.type=i()?"session":"view",n.fire(s(a,"/px.gif"))}}if(t.switches.liveAbTestStats){var c=o.getAbLoggableObject(t);c.type=i()?"session":"view",n.fire(s(c,"/ab.gif"))}}};return a}),define("common/modules/adverts/video",["common/$","common/utils/mediator","common/utils/to-array","bean","common/utils/ajax"],function(e,t,n,o,i){function s(e){this.config=e.config,this.context=e.context,this.support=e.support,this.video=e.el,this.played=!1,this.timer=!1,this.events={},this.vastData={trackingEvents:{}}}function r(e){this.url=e,this.hasFired=!1}return s.prototype.play=function(n){var i,s=this,r=this.video.querySelectorAll("source");this.played=!0,"mp4"===n&&window.navigator.userAgent.match(/(iPad|iPhone|iPod)/g)&&(n="m3u8");for(var a=0,c=r.length;c>a;a++)if(r[a].src.search("."+n)>-1){i=r[a].src;break}o.on(this.video,"ended error",function(){t.emit("video:ads:finished",s.config,s.context),o.off(s.video,"ended error"),o.off(s.video,"click.ct touchstart.ct"),o.fire(s.video,"play:content"),s.video.src=i,s.video.play(),e(s.video).removeClass("has-cursor"),s.events.complete&&!s.events.complete.hasFired&&(s.logEvent(s.events.complete),clearInterval(s.timer))}),this.video.style.height=this.video.offsetHeight+"px",o.fire(this.video,"play:advert"),this.video.src=this.vastData.file,this.video.play(),this.vastData.trackingEvents&&this.initTracking(this.vastData.trackingEvents),this.vastData.impressionEvents&&this.initImpressions(this.vastData.impressionEvents)},s.prototype.initImpressions=function(e){var t=this;e.forEach(function(e){t.logEvent(new r(e))})},s.prototype.initTracking=function(t,n){var i=this;for(var s in t)this.events[s]=new r(t[s]);n&&n.length&&n.forEach(function(e){i.logEvent(new r(e))}),this.events.oasImpression&&this.logEvent(this.events.oasImpression),this.events.start&&this.logEvent(this.events.start),this.events.clickThrough&&(e(this.video).addClass("has-cursor"),o.one(i.video,"click.ct touchstart.ct",function(){i.events.oasClickThrough&&i.logEvent(i.events.oasClickThrough),window.open(i.events.clickThrough.url)})),this.timer=setInterval(function(){var e=i.getProgress(),t=i.getDuration();e>t/2&&i.events.midpoint&&!i.events.midpoint.hasFired&&i.logEvent(i.events.midpoint)},1e3)},s.prototype.getProgress=function(){return this.video.currentTime},s.prototype.getDuration=function(){return this.video.duration},s.prototype.logEvent=function(e){var t=new Image;t.src=e.url,t.width=0,t.height=0,document.body.appendChild(t),e.hasFired=!0},s.prototype.trimText=function(e){return e.replace(/^\s+|\s+$/g,"")},s.prototype.getNodeContent=function(e){return e&&e.textContent?this.trimText(e.textContent):void 0},s.prototype.parseVast=function(e){var t,o=this;this.vastData.file=this.getNodeContent(e.querySelector("MediaFile")),this.vastData.file&&(this.vastData.trackingEvents.clickThrough=this.getNodeContent(e.querySelector("ClickThrough")),t=e.querySelectorAll(e.querySelector("Impression URL")?"Impression URL":"Impression"),this.vastData.impressionEvents=n(t).map(function(e){return o.getNodeContent(e)}),n(e.querySelectorAll("Tracking")).forEach(function(e){o.vastData.trackingEvents[e.getAttribute("event")]=o.trimText(e.textContent)}))},s.prototype.parseVideoAdServingTemplate=function(e){return this.vastData.trackingEvents.oasImpression=this.getNodeContent(e.querySelector("Impression URL")),this.vastData.trackingEvents.oasClickThrough=this.getNodeContent(e.querySelector("ClickTracking URL")),this.getNodeContent(e.querySelector("VASTAdTagURL URL"))},s.prototype.getVastData=function(e){var t=this;this.video.advertWasRequested=!0,i({url:e,method:"get",type:"xml",crossOrigin:!0,success:function(e){if(e&&e.documentElement){var n=e.documentElement.querySelector("VASTAdTagURL");if(n){var o=t.parseVideoAdServingTemplate(e.documentElement);t.getVastData(o)}else t.parseVast(e.documentElement)}}})},s.prototype.init=function(e){var n=""===e.pageId?"":e.pageId+"/",i="localhost"===window.location.hostname?"m.code.dev-theguardian.com":window.location.hostname,s="http://"+e.oasHost+"//2/"+i+"/"+n+"oas.html/"+(new Date).getTime()+"@x50";this.getVastData(s);var r=!1,a=this;for(var c in this.support)if(this.support.hasOwnProperty(c)&&"probably"===this.support[c]){r=c;break}"mp4"===r?o.on(a.video,"play",function(){a.played||a.play(r)}):t.emit("video:ads:finished",a.config,a.context)},s}),define("common/modules/discussion/comment-count",["common/common","bonzo","common/utils/ajax"],function(e,t,n){function o(e){var t=e.querySelectorAll("["+c+"]"),n=t.length-1,o="";return Array.prototype.forEach.call(t,function(e,t){o+=e.getAttribute(c),n>t&&(o+=",")}),o}function i(e){return e.getElementsByTagName("a")[0].pathname+"#comments"}function s(e,n){e.forEach(function(e){var o=n.querySelector('[data-discussion-id="'+e.id+'"]');if(o){if("true"===o.getAttribute("data-discussion-closed")&&0===e.count)return;var s=i(o),r=u.replace("[URL]",s);r=r.replace("[LABEL]",1===e.count?"comment":"comments");var a=o.querySelector(".item__meta, .card__meta, .js-append-commentcount"),l=t(a?a:o);l.append(r.replace("[COUNT]",e.count)),o.removeAttribute(c)}})}function r(t){var i=o(t);n({url:l+i,type:"json",method:"get",crossOrigin:!0,success:function(n){n&&n.counts&&(s(n.counts,t),e.mediator.emit("modules:commentcount:loaded",n.counts))}})}function a(t){t.querySelector("[data-discussion-id]")&&r(t),e.mediator.on("module:trailblock-show-more:render",function(){r(t)}),e.mediator.on("modules:related:loaded",function(){r(t)})}var c="data-discussion-id",l="/discussion/comment-counts.json?shortUrls=",u='<span class="trail__count trail__count--commentcount">';return u+='<a href="[URL]" data-link-name="Comment count"><i class="i i-comment-light-grey"></i>[COUNT]',u+='<span class="u-h"> [LABEL]</span></a></span>',{init:a,getCommentCounts:r,getContentIds:o}}),define("common/utils/url",["common/utils/detect","common/common"],function(e,t){var n=e.hasPushStateSupport(),o={getUrlVars:function(e){for(var t,n=e||{},i={},s=(n.query||o.getCurrentQueryString()).split("&"),r=s.length,a=0;r>a;a++)t=s[a].split("="),i[t[0]]=t[1];return i},getCurrentQueryString:function(){return window.location.search.replace(/^\?/,"")},pushQueryString:function(e){e.querystring&&n&&o.getCurrentQueryString()!==e.querystring&&history.pushState(e.state||{},e.title||window.title,e.querystring+window.location.hash)},pushUrl:function(e,t,o,i){n&&window.history[i?"replaceState":"pushState"](e,t,o)}};return t.mediator.on("modules:url:pushquerystring",o.pushQueryString),{getUrlVars:o.getUrlVars,pushUrl:o.pushUrl}}),define("common/modules/ui/overlay",["bean","common/common","bonzo"],function(e,t,n){function o(o){this.loadingHtml='<div class="preload-msg"><div class="is-updating is-updating--dark"></div></div>',o=o||this.loadingHtml;var i=this,s='<div class="overlay">  <div class="overlay__header u-cf">    <div class="overlay__toolbar u-cf"></div>    <button class="overlay__cta overlay__cta--close js-overlay-close" data-link-name="Close overlay">      <i class="i i-close-icon"></i>    </button>  </div>  <div class="overlay__body">'+o+"</div></div>";n(document.body).append(s),this._savedPos=0,this.node=document.body.querySelector(".overlay"),this.headerNode=this.node.querySelector(".overlay__header"),this.toolbarNode=this.node.querySelector(".overlay__toolbar"),this.bodyNode=this.node.querySelector(".overlay__body"),this.node.style.display="none",e.on(this.node,"click",".js-overlay-close",function(e){e.preventDefault(),i.hide(),t.mediator.emit("modules:overlay:close",i)})}return o.prototype.showLoading=function(){this.setBody(this.loadingHtml),this.show()},o.prototype.show=function(){this._savedPos=window.pageYOffset,n(document.body).addClass("has-overlay"),this.node.style.display="block",window.scrollTo(window.pageXOffset,0),t.mediator.emit("modules:overlay:show",this)},o.prototype.hide=function(){var e=this;n(document.body).removeClass("has-overlay");var o=0;setTimeout(function(){window.scrollTo(window.pageXOffset,e._savedPos)},o),this.node.style.display="none",t.mediator.emit("modules:overlay:hide",this)},o.prototype.setBody=function(e){this.bodyNode.innerHTML=e},o.prototype.remove=function(){this.node.parentNode&&this.node.parentNode.removeChild(this.node)},o}),define("common/modules/gallery/lightbox",["common/$","bean","common/utils/mediator","lodash/functions/debounce","common/utils/ajax","bonzo","qwery","common/utils/detect","common/utils/url","common/modules/ui/overlay"],function(e,t,n,o,i,s,r,a,c,l){function u(u,d){var m,f,p,h,g,v,y,b,w,_=this,k="/"+u.page.pageId,x=1,C=0,T="fullimage",S=5e3,j=!0;this.selector=".js-gallerythumbs",this.galleryEndpoint="",this.init=function(n){if(_.opts=n||{},u.switches.lightboxGalleries||_.opts.overrideSwitch){e(_.selector+" a",d).attr("data-is-ajax","1"),t.on(d,"click",_.selector,function(t){t.preventDefault();var n=t.currentTarget,o=e(n).attr("data-gallery-url");if(!o){var i="A"===n.nodeName?n:n.querySelector("a");o=i.getAttribute("href")}if(-1!==o.indexOf("index=")){var s=c.getUrlVars({query:o.split("?")[1]});x=parseInt(s.index,10)}_.loadGallery({url:o})});var o=c.getUrlVars();o.index&&this.loadGallery({url:"/"+u.page.pageId,startingImage:parseInt(o.index,10)})}},this.bindEvents=function(){t.on(p.toolbarNode,"touchstart click",".js-gallery-grid",this.switchToGrid),t.on(p.toolbarNode,"touchstart click",".js-gallery-full",this.switchToFullImage),t.on(p.toolbarNode,"click",".js-start-slideshow",this.startSlideshow),t.on(p.toolbarNode,"click",".js-stop-slideshow",this.stopSlideshow),t.on(p.bodyNode,"click",".js-gallery-prev",this.prev),t.on(p.bodyNode,"click",".js-gallery-next",this.next),t.on(p.bodyNode,"click",".js-load-gallery",this.loadGallery),t.on(p.bodyNode,"click",".js-toggle-furniture",this.toggleFurniture),t.on(p.bodyNode,"click",".gallery--fullimage-mode .gallery__item",function(t){if(h&&!g){var n=r(".js-gallery-item-"+x,m)[0],o=!1;if(e(".gallerycaption, .captioncontrol",n).each(function(e){s.isAncestor(e,t.target)&&(o=!0)}),o)return;var i=t.pageX/m.offsetWidth*100;25>i?_.swipe.prev():_.swipe.next()}}),t.on(p.bodyNode,"touchmove",".gallery__item",function(){g=!0,_.stopSlideshow()}),t.on(p.bodyNode,"touchend",".gallery__item",function(){setTimeout(function(){g=!1},250)}),t.on(p.bodyNode,"click",".gallery--grid-mode .gallery__item",function(e){var t=parseInt(e.currentTarget.getAttribute("data-index"),10);_.goTo(t)}),n.addListener("window:orientationchange",function(){_.layout(),"landscape"===a.getOrientation()&&_.jumpToContent()}),n.addListener("window:resize",function(){_.layout()}),n.on("modules:overlay:hide",function(){t.off(p.toolbarNode,"click"),t.off(p.bodyNode,"click touchmove touchend"),t.off(document.body,"keydown",_.handleKeyEvents),_.removeOverlay(),_.stopSlideshow(),j&&c.pushUrl({},document.title,k,!0)}),t.on(window,"popstate",function(e){e.state&&e.state.lightbox&&e.state.currentImage?_.goTo(e.state.currentImage,{dontUpdateUrl:!0}):e.state&&e.state.lightbox&&!e.state.currentImage&&(setTimeout(function(){p.hide(),_.removeOverlay()},10),t.off(document.body,"keydown",_.handleKeyEvents),n.emit("module:clickstream:interaction","Lightbox Gallery - Back button exit"))})},this.handleKeyEvents=function(e){37===e.keyCode?(_.prev(),_.trackInteraction("keyboard:previous")):39===e.keyCode?(_.next(),_.trackInteraction("keyboard:next")):27===e.keyCode&&p.hide()},this.loadGallery=function(o){h=!1,p=new l,p.showLoading(),this.galleryEndpoint=o.url.split("?")[0]+"/lightbox.json",this.bindEvents(),o.startingImage&&(x=o.startingImage),i({url:_.galleryEndpoint,type:"json",method:"get",crossOrigin:!0,success:function(o){_.galleryUrl="/"+o.config.page.pageId,p.setBody(o.html),m=r(".gallery--lightbox",p.bodyNode)[0],b=e(".gallery__nav",m),w=e(".gallery__img",m),C=parseInt(m.getAttribute("data-total"),10),c.pushUrl({lightbox:!0},document.title,_.galleryUrl),f=r(".gallery__images",m)[0],y=f.innerHTML,(!x||x>C)&&(x=1),_.layout(),_.setupOverlayHeader(),_.goTo(x),t.on(document.body,"keydown",_.handleKeyEvents),n.emit("module:lightbox-gallery:loaded",o.config,m)},error:function(){var e='<div class="preload-msg">Error loading gallery  <button class="cta js-load-gallery" data-link-name="Try loading gallery again" data-is-ajax>Try again</button></div>';p.setBody(e)}})},this.setupOverlayHeader=function(){var e='<button class="overlay__cta js-gallery-grid" data-link-name="Gallery grid mode">  <i class="i i-gallery-thumb-icon"></i> </button><button class="overlay__cta js-gallery-full" data-link-name="Gallery full image mode">  <i class="i i-gallery-fullimage-icon"></i> </button><button class="overlay__cta js-start-slideshow" data-link-name="Gallery start slideshow">  <i class="i i-gallery-play-slideshow"></i> </button><button class="overlay__cta js-stop-slideshow" data-link-name="Gallery stop slideshow">  <i class="i i-gallery-pause-slideshow"></i> </button><div class="overlay__cta gallery__counter">  <span class="js-image-index gallery__counter--current-image"></span> | '+C+"</div>";p.toolbarNode.innerHTML=e,_.imageIndexNode=p.toolbarNode.querySelector(".js-image-index"),_.gridModeCta=p.headerNode.querySelector(".js-gallery-grid"),_.fullModeCta=p.headerNode.querySelector(".js-gallery-full"),p.toolbarNode.querySelector(".js-stop-slideshow").style.display="none"},this.removeOverlay=o(function(){return p.remove(),!0},500),this.prev=function(e){e&&e.preventDefault(),_.stopSlideshow(),h?_.swipe.prev():_.goTo(x-1)},this.next=function(e){e&&e.preventDefault(),_.stopSlideshow(),h?_.swipe.next():_.goTo(x+1)},this.goTo=function(t,n){n=n||{},t>C?t=1:1>t&&(t=C),e(".gallery__item",p.bodyNode).each(function(e){var n=parseInt(e.getAttribute("data-index"),10);n===t?(s(e).addClass("gallery__item--active"),_.currentImageNode=e):s(e).removeClass("gallery__item--active")}),x=t,_.imageIndexNode.innerHTML=x,_.switchToFullImage(),n.dontUpdateUrl||_.pushUrlState()},this.switchToGrid=function(t){v&&_.stopSlideshow(),h&&_.removeSwipe(),T="grid",s(m).removeClass("gallery--fullimage-mode").addClass("gallery--grid-mode"),e(".gallery__img",p.bodyNode).each(function(e){e.src=e.getAttribute("data-src")}),_.gridModeCta.style.display="none",_.fullModeCta.style.display="block",_.layout(),t&&t.preventDefault()},this.switchToFullImage=function(e){T="fullimage",!a.hasTouchScreen()||h||_.opts.disableSwipe||v||_.setupSwipe(),s(m).removeClass("gallery--grid-mode").addClass("gallery--fullimage-mode"),_.gridModeCta.style.display="block",_.fullModeCta.style.display="none",_.layout(),_.preloadImages(),e&&e.preventDefault()},this.preloadImages=function(){Array.prototype.forEach.call(w,function(e,t){(t===x-1||t===x)&&(e.src=e.getAttribute("data-fullsrc"))})},this.toggleFurniture=function(){s(m).toggleClass("gallery--hide-furniture"),_.layout()},this.layout=function(){var t=s.viewport().height-p.headerNode.offsetHeight;h&&(m.style.height=r(".js-gallery-item-"+x,m)[0].offsetHeight+"px"),w=e(".gallery__img",m);var n=e(".gallery__item",m);
"fullimage"===T?(w.css({"max-height":t+"px",width:"auto","max-width":"100%"}),n.css("height",t+"px")):(w.removeAttr("style"),n.removeAttr("style"))},this.jumpToContent=function(){window.scrollTo(0,p.headerNode.offsetHeight)},this.setupSwipe=function(){require(["js!swipe"],function(){s(m).addClass("gallery--swipe"),_.swipe=new Swipe(m,{startSlide:x-1,speed:200,continuous:!0,callback:function(e){var t=e+1>x?"next":"prev";_.trackInteraction("Lightbox gallery swipe - "+t),x=e+1,_.imageIndexNode.innerHTML=x,_.layout(),_.preloadImages(),_.pushUrlState()}}),h=!0})},this.removeSwipe=function(){_.swipe.kill(),s(f).removeAttr("style").html(y),s(m).removeClass("gallery--swipe").css("height","auto"),h=!1},this.pushUrlState=function(e){if(e=e||{},j){var t={lightbox:!0,currentImage:x};c.pushUrl(t,document.title,_.galleryUrl+"?index="+x,e.replace)}},this.trackInteraction=function(e){n.emit("module:clickstream:interaction",e)},this.startSlideshow=function(){v=!0,s(m).addClass("gallery--slideshow"),r(".js-start-slideshow",p.toolbarNode)[0].style.display="none",r(".js-stop-slideshow",p.toolbarNode)[0].style.display="block",h&&_.removeSwipe(),_.goTo(x),_.slideshowTimer=setInterval(function(){_.goTo(x+1)},S)},this.stopSlideshow=function(){v&&(v=!1,s(m).removeClass("gallery--slideshow"),r(".js-start-slideshow",p.toolbarNode)[0].style.display="block",r(".js-stop-slideshow",p.toolbarNode)[0].style.display="none",clearInterval(_.slideshowTimer),_.goTo(x))}}return u}),define("common/modules/onward/sequence",["bean","common/utils/ajax","common/utils/mediator","common/utils/storage","common/utils/config","lodash/collections/filter","common/modules/onward/history"],function(e,t,n,o,i,s,r){function a(e,t){y.set(b[e],t),n.emit("modules:sequence:"+e+":loaded",t)}function c(e){return y.get(b[e])}function l(){var e=c("sequence");return e?{name:e.name,items:m(e.items)}:null}function u(){return{name:c("contextName"),path:c("contextPath")}}function d(){y.remove(b.contextName),y.remove(b.contextPath)}function m(e){var t=new r({}).get().map(function(e){return e.id});return s(e,function(e){return t.indexOf(e.url)<0&&e.url!==v})}function f(){var e="page"in i&&""!==i.page.section?"/"+i.page.section:"";return{path:"most-read"+e}}function p(e){t({url:"/"+e.path+".json",type:"json",crossOrigin:!0}).then(function(t){t&&"trails"in t&&(a("sequence",{name:e.name,items:m(t.trails)}),d(),n.emit("modules:sequence:loaded",l()))}).fail(function(e){n.emit("modules:error","Failed to load sequence: "+e.statusText,"common/modules/onwards/sequence.js")})}function h(){n.on("module:clickstream:click",function(e){e.sameHost&&!e.samePage&&e.linkContextPath&&(a("contextPath",e.linkContextPath),a("contextName",e.linkContextName))})}function g(e){var t=u();v=e,null!==t.path?p(t):null===l()?p(f()):n.emit("modules:sequence:loaded",l()),h()}var v,y=o.session,b={contextName:"gu.context.name",contextPath:"gu.context.path",sequence:"gu.sequence"};return{getSequence:l,getContext:u,init:g}}),define("lodash/internals/baseIndexOf",[],function(){function e(e,t,n){for(var o=(n||0)-1,i=e?e.length:0;++o<i;)if(e[o]===t)return o;return-1}return e}),define("lodash/internals/keyPrefix",[],function(){var e=+new Date+"";return e}),define("lodash/internals/cacheIndexOf",["./baseIndexOf","./keyPrefix"],function(e,t){function n(n,o){var i=typeof o;if(n=n.cache,"boolean"==i||null==o)return n[o]?0:-1;"number"!=i&&"string"!=i&&(i="object");var s="number"==i?o:t+o;return n=(n=n[i])&&n[s],"object"==i?n&&e(n,o)>-1?0:-1:n?0:-1}return n}),define("lodash/internals/cachePush",["./keyPrefix"],function(e){function t(t){var n=this.cache,o=typeof t;if("boolean"==o||null==t)n[t]=!0;else{"number"!=o&&"string"!=o&&(o="object");var i="number"==o?t:e+t,s=n[o]||(n[o]={});"object"==o?(s[i]||(s[i]=[])).push(t):s[i]=!0}}return t}),define("lodash/internals/objectPool",[],function(){var e=[];return e}),define("lodash/internals/getObject",["./objectPool"],function(e){function t(){return e.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}return t}),define("lodash/internals/releaseObject",["./maxPoolSize","./objectPool"],function(e,t){function n(o){var i=o.cache;i&&n(i),o.array=o.cache=o.criteria=o.object=o.number=o.string=o.value=null,t.length<e&&t.push(o)}return n}),define("lodash/internals/createCache",["./cachePush","./getObject","./releaseObject"],function(e,t){function n(n){var o=-1,i=n.length,s=n[0],r=n[i/2|0],a=n[i-1];if(s&&"object"==typeof s&&r&&"object"==typeof r&&a&&"object"==typeof a)return!1;var c=t();c["false"]=c["null"]=c["true"]=c.undefined=!1;var l=t();for(l.array=n,l.cache=c,l.push=e;++o<i;)l.push(n[o]);return l}return n}),define("lodash/internals/largeArraySize",[],function(){var e=75;return e}),define("lodash/internals/baseUniq",["./baseIndexOf","./cacheIndexOf","./createCache","./getArray","./largeArraySize","./releaseArray","./releaseObject"],function(e,t,n,o,i,s,r){function a(a,c,l){var u=-1,d=e,m=a?a.length:0,f=[],p=!c&&m>=i,h=l||p?o():f;if(p){var g=n(h);d=t,h=g}for(;++u<m;){var v=a[u],y=l?l(v,u,a):v;(c?!u||h[h.length-1]!==y:d(h,y)<0)&&((l||p)&&h.push(y),f.push(v))}return p?(s(h.array),r(h)):l&&s(h),f}return a}),define("lodash/arrays/uniq",["../internals/baseUniq","../functions/createCallback"],function(e,t){function n(n,o,i,s){return"boolean"!=typeof o&&null!=o&&(s=i,i="function"!=typeof o&&s&&s[o]===n?null:o,o=!1),null!=i&&(i=t(i,s,3)),e(n,o,i)}return n}),define("common/modules/ui/message",["common/$","bean","common/utils/storage","common/modules/userPrefs","lodash/arrays/uniq"],function(e,t,n,o,i){var s=function(e,t){var n=t||{};this.id=e,this.important=n.important||!1,this.permanent=n.permanent||!1,this.type=n.type||"banner",this.prefs="messages"};return s.prototype.show=function(n){return!e(".site-message").hasClass("is-hidden")&&!this.important||this.hasSeen()?!1:(e(".js-site-message-copy").html(n),e(".site-message").addClass("site-message--"+this.type),e(".site-message").removeClass("is-hidden"),this.permanent?(e(".site-message").addClass("site-message--permanent"),e(".site-message__close").addClass("is-hidden")):t.on(document,"click",".js-site-message-close",this.acknowledge.bind(this)),void("modal"===this.type&&this.bindModalListeners()))},s.prototype.bindModalListeners=function(){t.on(document,"click",".js-site-message-inner",function(e){e.stopImmediatePropagation(),e.stopPropagation()}),t.on(document,"click",".js-site-message",this.acknowledge.bind(this))},s.prototype.hide=function(){e("#header").removeClass("js-site-message"),e(".site-message").addClass("is-hidden")},s.prototype.hasSeen=function(){var e=o.get(this.prefs);return e&&e.indexOf(this.id)>-1},s.prototype.remember=function(){var e=o.get(this.prefs)||[];e.push(this.id),o.set(this.prefs,i(e))},s.prototype.acknowledge=function(){this.remember(),this.hide()},s}),define("common/modules/identity/facebook-authorizer",[""],function(){function e(e){n=this,this.appId=e,this.onConnected=new t,this.onFBScriptLoaded=new t,this.onUserDataLoaded=new t,this.onNotAuthorized=new t,this.onNotLoggedIn=new t,this.cancelledLogin=new t}function t(){this.callbacks=[]}var n=null;e.DEFAULT_PERMISSIONS={scope:"email,publish_actions,publish_stream"},e.prototype.onConnected=null,e.prototype.onFBScriptLoaded=null,e.prototype.onUserDataLoaded=null,e.prototype.onNotAuthorized=null,e.prototype.onNotLoggedIn=null,e.prototype.cancelledLogin=null,e.accessToken=null,e.userId=null,e.userData=null,e.prototype.login=function(t,n){return(n||!this.accessToken&&!this.loginPending)&&(this.cancelledLogin.reset(),this.onConnected.reset(),this.loginPending=!0,this._loadFacebookAPI().then(function(n){n.login(this._handleGotLoginStatus.bind(this,!0),t||e.DEFAULT_PERMISSIONS)}.bind(this))),this.onConnected},e.prototype.getLoginStatus=function(t){return this.loginStatusPending||(this.loginStatusPending=!0,this._loadFacebookAPI().then(function(n){n.getLoginStatus(this._handleGotLoginStatus.bind(this,!1),t||e.DEFAULT_PERMISSIONS)}.bind(this))),this.onConnected};var o="facebook-jssdk";return e.prototype._handleGotLoginStatus=function(e,t){switch(this.loginStatusPending=!1,this.loginPending=!1,t.status){case"connected":this.accessToken=t.authResponse.accessToken,this.userId=t.authResponse.userID,this._getUserData(),this.onConnected.resolve(FB,t.authResponse);break;case"not_authorized":this._getUserData(),this.onNotAuthorized.resolve(this);break;default:e&&this.cancelledLogin.resolve(),this.onNotLoggedIn.resolve()}},e.prototype._getUserData=function(){FB.api("/me",this._handleGotUserData.bind(this))},e.prototype._handleGotUserData=function(e){e&&!e.error&&(this.userData=e,this.onUserDataLoaded.resolve(e))},e.prototype._loadFacebookAPI=function(){return window.FB?this.onFBScriptLoaded.resolve(window.FB):document.getElementById(o)||this._requiredAlready||(this._requiredAlready=!0,this._loadFacebookScript()),this.onFBScriptLoaded},e.prototype._loadFacebookScript=function(){require(["js!facebook"],this._handleScriptLoaded.bind(this))},e.prototype._handleScriptLoaded=function(){FB.init({appId:this.appId,status:!0,cookie:!0,xfbml:!0}),this.onFBScriptLoaded.resolve(FB)},e.prototype.destroy=function(){n=null},t.prototype.resolve=function(){this.args=Array.prototype.slice.apply(arguments);var e,t=this.callbacks.length;for(e=0;t>e;e++)this.callbacks[e].apply(null,this.args);this.callbacks=[]},t.prototype.then=function(e){void 0!==this.args?e.apply(null,this.args):this.callbacks.push(e)},t.prototype.reset=function(){this.args=void 0},e}),define("common/modules/identity/autosignin",["common/utils/ajax","bonzo","common/common","common/modules/identity/api","common/modules/identity/facebook-authorizer","common/modules/navigation/profile","common/utils/storage","common/modules/userPrefs","common/utils/time","common/modules/ui/message"],function(e,t,n,o,i,s,r,a,c,l){function u(t){this.config=t;var n=this;n.header=document.body,this.init=function(){if(o.shouldAutoSigninInUser()){var e=this.config.page.fbAppId,t=new i(e);t.getLoginStatus(),t.onConnected.then(function(e,o){t.onUserDataLoaded.then(function(e){e.email&&n.signin(o,e.name)})}),t.onNotLoggedIn.then(function(){var e=c.currentDate();o.setNextFbCheckTime(e.setDate(e.getDate()+1))}),t.onNotAuthorized.then(function(){var e=c.currentDate();o.setNextFbCheckTime(e.setMonth(e.getMonth()+1))})}},this.signin=function(t,o){e({url:n.config.page.idWebAppUrl+"/jsapi/facebook/autosignup",cache:!1,crossOrigin:!0,type:"jsonp",data:{signedRequest:t.signedRequest,accessToken:t.accessToken},success:function(e){if(n.welcome(o),"ok"===e.status){var t=new s(n.header,{url:n.config.page.idUrl});t.init()}}})},this.welcome=function(e){var t='<p class="site-message__message">Welcome '+e+", you're signed into the Guardian using Facebook, or <a href=\""+n.config.page.idUrl+'/signout"/>sign out</a>.</p>';new l("fbauto",{important:!0}).show(t)}}return u}),define("common/modules/component",["bean","qwery","bonzo","common/utils/ajax"],function(e,t,n,o){function i(e){return new Error("Component: "+e)}var s=function(){};return s.prototype.useBem=!1,s.prototype.templateName=null,s.prototype.componentClass=null,s.prototype.endpoint=null,s.prototype.classes=null,s.prototype.elem=null,s.prototype.model=null,s.prototype.template=null,s.prototype.rendered=!1,s.prototype.destroyed=!1,s.prototype.elems=null,s.prototype.options=null,s.prototype.defaultOptions={},s.prototype.responseDataKey="html",s.prototype.autoupdated=!1,s.prototype.updateEvery=60,s.prototype.t=null,s.prototype.attachTo=function(e){if(this.checkAttached(),!e)throw new i("Need element to attach to");this.elem=e,this._prerender(),this._ready()},s.prototype.render=function(e){this.checkAttached();var t=n.create(this.template?this.template:document.getElementById("tmpl-"+this.templateName).innerHTML)[0],o=e||document.body;this.elem=t,this._prerender(),n(o).append(this.elem),this._ready()},s.prototype.checkAttached=function(){if(this.rendered)throw new i("Already rendered")},s.prototype.fetch=function(e,t){this.checkAttached(),this.responseDataKey=t||"html";var o=this;return this._fetch().then(function(t){o.elem=n.create(t[o.responseDataKey])[0],o._prerender(),o.destroyed||(n(e).append(o.elem),o._ready())})},s.prototype._fetch=function(){var e,t=this.endpoint;for(e in this.options)t=t.replace(":"+e,this.options[e]);return o({url:t,type:"json",method:"get",crossOrigin:!0})},s.prototype._ready=function(){this.destroyed||(this.rendered=!0,this._autoupdate(),this.ready())},s.prototype._prerender=function(){this.elems={},this.prerender()},s.prototype._autoupdate=function(){function e(){t._fetch().then(function(o){t.autoupdate(n.create(o[t.responseDataKey])[0]),t.autoupdated&&(t.t=setTimeout(e,1e3*t.updateEvery))})}var t=this;this.autoupdated&&(this.t=setTimeout(e,1e3*this.updateEvery))},s.prototype.prerender=function(){},s.prototype.ready=function(){},s.prototype.autoupdate=function(e){var t=this.elem;this.elem=e,this._prerender(),n(t).replaceWith(this.elem)},s.prototype.dispose=function(){},s.prototype.on=function(t,n,o){"function"==typeof n?(o=n,e.on(this.elem,t,o.bind(this))):(n=n.length?n:[n],e.on(this.elem,t,n,o.bind(this)))},s.prototype.emit=function(t,n){e.fire(this.elem,t,n)},s.prototype.getElem=function(e){if(this.elems[e])return this.elems[e];var n=t(this.getClass(e),this.elem)[0];return this.elems[e]=n,n},s.prototype.getClass=function(e,t){var n=this.useBem?this.componentClass+"__"+e:this.classes[e];return(t?"":".")+n},s.prototype.setState=function(e,t){var o=t?this.getElem(t):this.elem;n(o).addClass(this.componentClass+(t?"__"+t:"")+"--"+e)},s.prototype.removeState=function(e,t){var o=t?this.getElem(t):this.elem;return n(o).removeClass(this.componentClass+(t?"__"+t:"")+"--"+e)},s.prototype.hasState=function(e,t){var o=t?this.getElem(t):this.elem;return n(o).hasClass(this.componentClass+(t?"__"+t:"")+"--"+e)},s.prototype.setOptions=function(e){e=e||{},this.options={};for(var t in this.defaultOptions)this.options[t]=e.hasOwnProperty(t)?e[t]:this.defaultOptions[t]},s.prototype.detach=function(){e.off(this.elem)},s.prototype.destroy=function(){this.elem&&(n(this.elem).remove(),delete this.elem),clearTimeout(this.t),this.t=null,this.autoupdated=!1,this.detach(),this.destroyed=!0},s.define=function(e){function t(){}t.prototype=s.prototype,e.prototype=new t,e.prototype.constructor=e},s}),define("lodash/arrays/compact",[],function(){function e(e){for(var t=-1,n=e?e.length:0,o=[];++t<n;){var i=e[t];i&&o.push(i)}return o}return e}),define("lodash/objects/isArguments",[],function(){function e(e){return e&&"object"==typeof e&&"number"==typeof e.length&&o.call(e)==t||!1}var t="[object Arguments]",n=Object.prototype,o=n.toString;return e}),define("lodash/objects/isArray",["../internals/isNative"],function(e){var t="[object Array]",n=Object.prototype,o=n.toString,i=e(i=Array.isArray)&&i,s=i||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&o.call(e)==t||!1};return s}),define("lodash/internals/baseFlatten",["../objects/isArguments","../objects/isArray"],function(e,t){function n(o,i,s,r){for(var a=(r||0)-1,c=o?o.length:0,l=[];++a<c;){var u=o[a];if(u&&"object"==typeof u&&"number"==typeof u.length&&(t(u)||e(u))){i||(u=n(u,i,s));var d=-1,m=u.length,f=l.length;for(l.length+=m;++d<m;)l[f++]=u[d]}else s||l.push(u)}return l}return n}),define("lodash/collections/map",["../functions/createCallback","../objects/forOwn"],function(e,t){function n(n,o,i){var s=-1,r=n?n.length:0;if(o=e(o,i,3),"number"==typeof r)for(var a=Array(r);++s<r;)a[s]=o(n[s],s,n);else a=[],t(n,function(e,t,n){a[++s]=o(e,t,n)});return a}return n}),define("lodash/arrays/flatten",["../internals/baseFlatten","../collections/map"],function(e,t){function n(n,o,i,s){return"boolean"!=typeof o&&null!=o&&(s=i,i="function"!=typeof o&&s&&s[o]===n?null:o,o=!1),null!=i&&(n=t(n,i,s)),e(n,o)}return n}),define("lodash/internals/charAtCallback",[],function(){function e(e){return e.charCodeAt(0)}return e}),define("lodash/collections/forEach",["../internals/baseCreateCallback","../objects/forOwn"],function(e,t){function n(n,o,i){var s=-1,r=n?n.length:0;if(o=o&&"undefined"==typeof i?o:e(o,i,3),"number"==typeof r)for(;++s<r&&o(n[s],s,n)!==!1;);else t(n,o);return n}return n}),define("lodash/objects/isString",[],function(){function e(e){return"string"==typeof e||e&&"object"==typeof e&&o.call(e)==t||!1}var t="[object String]",n=Object.prototype,o=n.toString;return e}),define("lodash/collections/max",["../internals/charAtCallback","../functions/createCallback","./forEach","../objects/forOwn","../objects/isArray","../objects/isString"],function(e,t,n,o,i,s){function r(o,r,a){var c=-1/0,l=c;if("function"!=typeof r&&a&&a[r]===o&&(r=null),null==r&&i(o))for(var u=-1,d=o.length;++u<d;){var m=o[u];m>l&&(l=m)}else r=null==r&&s(o)?e:t(r,a,3),n(o,function(e,t,n){var o=r(e,t,n);o>c&&(c=o,l=e)});return l}return r}),define("lodash/collections/pluck",["./map"],function(e){var t=e;return t}),define("lodash/arrays/zip",["../collections/max","../collections/pluck"],function(e,t){function n(){for(var n=arguments.length>1?arguments:arguments[0],o=-1,i=n?e(t(n,"length")):0,s=Array(0>i?0:i);++o<i;)s[o]=t(n,o);return s}return n}),define("lodash/chaining/wrapperValueOf",["../collections/forEach","../support"],function(){function e(){return this.__wrapped__}return e}),define("lodash/internals/compareAscending",[],function(){function e(e,t){for(var n=e.criteria,o=t.criteria,i=-1,s=n.length;++i<s;){var r=n[i],a=o[i];if(r!==a){if(r>a||"undefined"==typeof r)return 1;if(a>r||"undefined"==typeof a)return-1}}return e.index-t.index}return e}),define("lodash/collections/sortBy",["../internals/compareAscending","../functions/createCallback","./forEach","../internals/getArray","../internals/getObject","../objects/isArray","./map","../internals/releaseArray","../internals/releaseObject"],function(e,t,n,o,i,s,r,a,c){function l(l,u,d){var m=-1,f=s(u),p=l?l.length:0,h=Array("number"==typeof p?p:0);for(f||(u=t(u,d,3)),n(l,function(e,t,n){var s=h[++m]=i();f?s.criteria=r(u,function(t){return e[t]}):(s.criteria=o())[0]=u(e,t,n),s.index=m,s.value=e}),p=h.length,h.sort(e);p--;){var g=h[p];h[p]=g.value,f||a(g.criteria),c(g)}return h}return l}),define("lodash/objects/mapValues",["../functions/createCallback","./forOwn"],function(e,t){function n(n,o,i){var s={};return o=e(o,i,3),t(n,function(e,t,n){s[t]=o(e,t,n)}),s}return n}),define("lodash/objects/pairs",["./keys"],function(e){function t(t){for(var n=-1,o=e(t),i=o.length,s=Array(i);++n<i;){var r=o[n];s[n]=[r,t[r]]}return s}return t}),define("lodash/objects/values",["./keys"],function(e){function t(t){for(var n=-1,o=e(t),i=o.length,s=Array(i);++n<i;)s[n]=t[o[n]];return s}return t}),define("lodash/objects/functions",["./forIn","./isFunction"],function(e,t){function n(n){var o=[];return e(n,function(e,n){t(e)&&o.push(n)}),o.sort()}return n}),define("lodash/utilities/mixin",["../collections/forEach","../objects/functions","../objects/isFunction","../objects/isObject"],function(e,t,n,o){function i(i,s,a){var c=!0,l=s&&t(s);a===!1?c=!1:o(a)&&"chain"in a&&(c=a.chain);var u=i,d=n(u);e(l,function(e){var t=i[e]=s[e];d&&(u.prototype[e]=function(){var e=this.__chain__,n=this.__wrapped__,s=[n];r.apply(s,arguments);var a=t.apply(i,s);if(c||e){if(n===a&&o(a))return this;a=new u(a),a.__chain__=e}return a})})}var s=[],r=s.push;return i}),define("lodash/internals/lodashWrapper",[],function(){function e(e,t){this.__chain__=!!t,this.__wrapped__=e}return e}),define("common/_",["lodash/arrays/compact","lodash/arrays/flatten","lodash/arrays/zip","lodash/chaining/wrapperValueOf","lodash/collections/forEach","lodash/collections/map","lodash/collections/pluck","lodash/collections/sortBy","lodash/objects/mapValues","lodash/collections/max","lodash/objects/pairs","lodash/objects/values","lodash/objects/forOwn","lodash/objects/isArray","lodash/utilities/mixin","lodash/internals/lodashWrapper","lodash/objects/functions","lodash/collections/filter"],function(e,t,n,o,i,s,r,a,c,l,u,d,m,f,p,h,g,v){function y(e){return e&&"object"==typeof e&&!f(e)&&_.call(e,"__wrapped__")?e:new h(e)}var b=[],w=Object.prototype,_=w.hasOwnProperty;return h.prototype=y.prototype,p=function(e){var t=t;return function(n,o,i){return o&&(i||t(o).length)||(null===i&&(i=o),o=n,n=y),e(n,o,i)}}(p),y.compact=e,y.flatten=t,y.forEach=i,y.filter=v,y.map=s,y.mapValues=c,y.max=l,y.pairs=u,y.pluck=r,y.sortBy=a,y.values=d,y.zip=n,p(y),y.mixin=p,p(function(){var e={};return m(y,function(t,n){y.prototype[n]||(e[n]=t)}),e}(),!1),m(y,function(e,t){var n="sample"!==t;y.prototype[t]||(y.prototype[t]=function(t,o){var i=this.__chain__,s=e(this.__wrapped__,t,o);return i||null!==t&&(!o||n&&"function"==typeof t)?new h(s,i):s})}),y.VERSION="2.4.1",y.prototype.valueOf=o,i(["join","pop","shift"],function(e){var t=b[e];y.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new h(n,e):n}}),i(["push","reverse","sort","unshift"],function(e){var t=b[e];y.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),i(["concat","slice","splice"],function(e){var t=b[e];y.prototype[e]=function(){return new h(t.apply(this.__wrapped__,arguments),this.__chain__)}}),y}),define("common/modules/onward/slot-controller",["common/common","common/$","qwery","bonzo","common/_"],function(e,t,n,o,i){function s(e,t){return"."+d+"--"+e+(t?":empty":"")}function r(e,t){var o=e.map(function(e){return s(e,t)}).join(", ");return n(o,".article-body")}function a(e,t){return r([e],t)}function c(){i(h).values().flatten().forEach(function(e){o(e).detach()})}function l(e){var t=f[e.slotContainerType];g[t](e)}function u(){c(),i(h).pairs().sortBy(function(e){return p.indexOf(e[0])}).pluck(1).zip().flatten().compact().forEach(l)}var d="slot",m={story:["text"],adRight:["posth2","block","text"],adBlock:["preh2","block","text"]},f={story:"largestBucket",adRight:"firstAvailable",adBlock:"firstAvailable"},p=["adRight","adBlock","commercialLeft","commercialRight","story"],h=i.mapValues(m,function(){return[]}),g={largestBucket:function(e){var t=i(m[e.slotContainerType]).map(function(e){return a(e,!0)}),n=t.max("length").valueOf();n.length>0&&o(n[0]).append(e)},firstAvailable:function(e){var t=r(m[e.slotContainerType],!0);t.length>0&&o(t[0]).append(e)}};return{getSlot:function(e){if(!m.hasOwnProperty(e))return null;var t=document.createElement("div");return o(t).addClass(d+"__container"),t.slotContainerType=e,h[e].push(t),u(),t},swapSlot:function(e,t){return this.releaseSlot(e,!0),this.getSlot(t)},releaseSlot:function(e,t){i(h).values().forEach(function(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}),o(e).remove(),t||u()}}}),define("common/modules/adverts/article-body-adverts",["common/$","common/common","common/modules/component","bonzo","bean","lodash/objects/assign","common/utils/detect","common/modules/onward/slot-controller"],function(e,t,n,o,i,s,r,a){function c(e){this.context=document,this.config=s(this.config,e)}return n.define(c),c.prototype.inlineSlots=[],c.prototype.config={inlineAdTemplate:'<div class="ad-slot ad-slot--inline" data-base="%slot%" data-median="%slot%"><div class="ad-slot__label">Advertisement</div><div class="ad-container"></div></div>'},c.prototype.generateInlineAdSlot=function(e){var t=this.config.inlineAdTemplate;return o(o.create(t.replace(/%slot%/g,e)))},c.prototype.getNewSlot=function(e){var t=a.getSlot(e);return this.inlineSlots.push(t),t},c.prototype.destroy=function(){this.inlineSlots.forEach(function(e){a.releaseSlot(e)}),this.inlineSlots=[]},c.prototype.reload=function(){this.destroy(),this.init()},c.prototype.init=function(){var e=r.getBreakpoint();/wide|desktop/.test(e)&&o(this.getNewSlot("adRight")).html(this.generateInlineAdSlot("Middle1")),/tablet/.test(e)&&(o(this.getNewSlot("adRight")).html(this.generateInlineAdSlot("Middle")),o(this.getNewSlot("adRight")).html(this.generateInlineAdSlot("Middle1"))),/mobile/.test(e)&&(o(this.getNewSlot("adBlock")).html(this.generateInlineAdSlot("x49")),o(this.getNewSlot("adBlock")).html(this.generateInlineAdSlot("Bottom2")))},c}),define("common/modules/adverts/dfp-events",[],function(){var e=function(){if(!(googletag.hasOwnProperty("on")||googletag.hasOwnProperty("off")||googletag.hasOwnProperty("trigger")||googletag.hasOwnProperty("events"))){var e=googletag.debug_log.log,t=[],n=function(e,n,o){t.push({name:e,id:n,match:o})};n("gpt-google_js_loaded",8,/Google service JS loaded/gi),n("gpt-gpt_fetch",46,/Fetching GPT implementation/gi),n("gpt-gpt_fetched",48,/GPT implementation fetched\./gi),n("gpt-page_load_complete",1,/Page load complete/gi),n("gpt-queue_start",31,/^Invoked queued function/gi),n("gpt-service_add_slot",40,/Associated ([\w]*) service with slot ([\/\w]*)/gi),n("gpt-service_add_targeting",88,/Setting targeting attribute ([\w]*) with value ([\w\W]*) for service ([\w]*)/gi),n("gpt-service_collapse_containers_enable",78,/Enabling collapsing of containers when there is no ad content/gi),n("gpt-service_create",35,/Created service: ([\w]*)/gi),n("gpt-service_single_request_mode_enable",63,/Using single request mode to fetch ads/gi),n("gpt-slot_create",2,/Created slot: ([\/\w]*)/gi),n("gpt-slot_add_targeting",17,/Setting targeting attribute ([\w]*) with value ([\w\W]*) for slot ([\/\w]*)/gi),n("gpt-slot_fill",50,/Calling fillslot/gi),n("gpt-slot_fetch",3,/Fetching ad for slot ([\/\w]*)/gi),n("gpt-slot_receiving",4,/Receiving ad for slot ([\/\w]*)/gi),n("gpt-slot_render_delay",53,/Delaying rendering of ad slot ([\/\w]*) pending loading of the GPT implementation/gi),n("gpt-slot_rendering",5,/^Rendering ad for slot ([\/\w]*)/gi),n("gpt-slot_rendered",6,/Completed rendering ad for slot ([\/\w]*)/gi),googletag.events=googletag.events||{},googletag.on=function(e,t,n){if(!t)return this;e=e.split(" ");var o=n?t:void 0,i=n||t,s=0,r="";for(i.data=o,r=e[s=0];s<e.length;r=e[++s])(this.events[r]=this.events[r]||[]).push(i);return this},googletag.off=function(e,t){e=e.split(" ");var n=0,o=0,i="",s=function(){};for(i=e[n];n<e.length;i=e[++n])if(this.events.hasOwnProperty(i))if(t){for(o=this.events[i].length-1,s=this.events[i][o];o>=0;s=this.events[i][--o])s===t&&this.events[i].splice(o,1);0===this.events[i].length&&delete this.events[i]}else delete this.events[i];return this},googletag.trigger=function(e,t){if(!this.events[e]||0===this.events[e].length)return this;var n=0,o=this.events[e][n];for(t=t||[],o;n<this.events[e].length&&o.apply(this,[{data:o.data}].concat(t))!==!1;o=this.events[e][++n]);return this},googletag.debug_log.log=function(n,o){if(o&&o.getMessageId&&"number"==typeof o.getMessageId()){var i=0,s=Array.prototype.slice.call(arguments);for(i;i<t.length;i++)t[i].id===o.getMessageId()&&googletag.trigger(t[i].name,s)}return e.apply(this,arguments)}}};return{init:e}}),define("common/modules/adverts/dfp",["common/$","bonzo","postscribe","common/modules/component","lodash/objects/assign","common/utils/cookies","common/utils/mediator","common/modules/analytics/commercial/tags/common/audience-science","common/modules/adverts/userAdTargeting","common/modules/adverts/dfp-events"],function(e,t,n,o,i,s,r,a,c,l){function u(e){this.context=document,this.config=i(this.config,e)}var d={breakout__html:"%content%",breakout__script:"<script>%content%</script>"};return o.define(u),u.prototype.config={dfpUrl:"//www.googletagservices.com/tag/js/gpt.js"},u.prototype.setListeners=function(){googletag.on("gpt-slot_rendered",this.checkForBreakout)},u.prototype.setTargetting=function(){var e=this.config.page,t=e.keywords?e.keywords.split(","):"",n=e.section?e.section.toLowerCase():"",o=e.contentType?e.contentType.toLowerCase():"";googletag.pubads().setTargeting("k",t),googletag.pubads().setTargeting("at",s.get("adtest")||""),googletag.pubads().setTargeting("pt",o),googletag.pubads().setTargeting("ct",o),googletag.pubads().setTargeting("cat",n),googletag.pubads().setTargeting("a",a.getSegments()||[]),googletag.pubads().setTargeting("gdncrm",c.getUserSegments()||[])},u.prototype.defineSlots=function(){var e=this.config.page.isFront?"networkfront":this.config.page.section,t="/"+this.config.page.dfpAccountId+"/"+this.config.page.dfpServer+"/"+e;this.dfpAdSlots.each(function(e){var n=e.id,o=e.getAttribute("data-name"),i=e.getAttribute("data-size").split(",").map(Number);googletag.defineSlot(t,i,n).addService(googletag.pubads()).setTargeting("slot",o)})},u.prototype.fireAdRequest=function(){googletag.pubads().enableSingleRequest(),googletag.pubads().enableAsyncRendering(),googletag.pubads().collapseEmptyDivs(),googletag.enableServices(),googletag.display(this.dfpAdSlots[0].id)},u.prototype.checkForBreakout=function(o,i,s,r,a){var c=e("#"+a.getSlotId().getDomId()),l=c[0].querySelector("iframe").contentDocument.body;for(var u in d){var m=t(l.querySelector("."+u));m.length>0&&(c.html(""),n(c[0],d[u].replace(/%content%/g,m.html())))}},u.prototype.loadLibrary=function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0],n="https:"===document.location.protocol;e.async=!0,e.type="text/javascript",e.src=(n?"https:":"http:")+this.config.dfpUrl,t.parentNode.insertBefore(e,t)},u.prototype.destroy=function(){this.dfpAdSlots=[]},u.prototype.load=function(){if(this.dfpAdSlots=e(".ad-slot__dfp"),0===this.dfpAdSlots.length)return!1;window.googletag=window.googletag||{cmd:[]},this.loadLibrary();try{googletag.cmd.push(l.init),googletag.cmd.push(this.setListeners.bind(this)),googletag.cmd.push(this.setTargetting.bind(this)),googletag.cmd.push(this.defineSlots.bind(this)),googletag.cmd.push(this.fireAdRequest.bind(this))}catch(t){r.emit("module:error","DFP ad loading error: "+t,"common/modules/adverts/dfp.js")}},u}),define("common/modules/analytics/commercial/tags/common/imrworldwide",[],function(){function e(){var e=new Image(1,1);e.src=["//secure-uk.imrworldwide.com/cgi-bin/m?ci=uk-305078h&cg=0&cc=1&si=",encodeURI(window.location.href),"&rp=",encodeURI(document.referrer),"&ts=compact&rnd=",(new Date).getTime()].join("")}return{load:e}}),define("common/modules/analytics/commercial/tags/au/amaa",[],function(){function e(){require([t],function(){})}var t="js!//c.supert.ag/the-guardian/the-guardian/supertag-async.js";return{load:e}}),define("common/modules/analytics/commercial/tags/au/effective-measure",[],function(){function e(){require([t],function(){})}var t="js!"+("https:"===document.location.protocol?"https://au-ssl":"http://au-cdn")+".effectivemeasure.net/em.js";return{load:e}}),define("common/modules/analytics/commercial/tags/container",["common/modules/analytics/commercial/tags/common/audience-science","common/modules/analytics/commercial/tags/common/imrworldwide","common/modules/analytics/commercial/tags/au/amaa","common/modules/analytics/commercial/tags/au/effective-measure"],function(e,t,n,o){function i(i){switch(i.page.edition.toLowerCase()){case"au":i.switches.amaa&&n.load(),i.switches.effectiveMeasure&&o.load(),i.switches.imrWorldwide&&t.load();break;default:i.switches.audienceScience&&e.load(i.page),i.switches.imrWorldwide&&t.load()}}return{init:i}}),define("common/modules/analytics/foresee-survey",[],function(){function e(){require(["js!foresee"],function(){})}return{load:e}}),define("common/modules/onward/right-most-popular",["qwery","common/utils/ajax","lodash/objects/assign","common/modules/analytics/register","common/modules/component"],function(e,t,n,o,i){function s(t,i){o.begin("right-most-popular"),this.config=n(this.config,i),this.mediator=t,this.fetch(e(".mpu-context"),"rightHtml")}return i.define(s),s.prototype.endpoint="/most-read.json",s.prototype.ready=function(){o.end("right-most-popular")},s}),define("common/bootstraps/common",["common/$","common/utils/mediator","common/utils/deferToLoad","common/utils/ajax","common/modules/userPrefs","bonzo","bean","enhancer","lodash/functions/debounce","common/utils/storage","common/utils/detect","common/modules/onward/popular","common/modules/onward/related","common/modules/ui/images","common/modules/navigation/profile","common/modules/navigation/sections","common/modules/navigation/search","common/modules/ui/tabs","common/modules/ui/toggles","common/modules/ui/relativedates","common/modules/analytics/clickstream","common/modules/analytics/omniture","common/modules/analytics/scrollDepth","common/modules/adverts/adverts","common/utils/cookies","common/modules/analytics/omnitureMedia","common/modules/analytics/livestats","common/modules/experiments/ab","common/modules/adverts/video","common/modules/discussion/comment-count","common/modules/gallery/lightbox","common/modules/onward/history","common/modules/onward/sequence","common/modules/ui/message","common/modules/identity/autosignin","common/modules/adverts/article-body-adverts","common/modules/adverts/dfp","common/modules/analytics/commercial/tags/container","common/modules/analytics/foresee-survey","common/modules/onward/right-most-popular","common/modules/analytics/register"],function(e,t,n,o,i,s,r,a,c,l,u,d,m,f,p,h,g,v,y,b,w,_,k,x,C,T,S,j,E,A,O,I,L,q,D,N,M,F,P,U,R){var V=u.hasCrossedBreakpoint(),B={upgradeImages:function(){f.upgrade(),f.listen()
},initialiseNavigation:function(e){var t=new h(e),n=new g(e),o=document.getElementById("header");if(o&&e.switches.idProfileNavigation){var i=new p(o,{url:e.page.idUrl});i.init()}t.init(document),n.init(o)},transcludeRelated:function(e,t){var n=new m;n.renderRelatedComponent(e,t)},transcludePopular:function(){t.on("page:common:ready",function(e,t){d(e,t)})},showTabs:function(){var e=new v;t.on("modules:popular:loaded",function(t){e.init(t)})},showToggles:function(){var e=new y;e.init(document),t.on("page:common:ready",function(){e.reset()})},showRelativeDates:function(){var e=b;t.on("page:common:ready",function(t,n){e.init(n)}),t.on("fragment:ready:dates",function(t){e.init(t)})},initClickstream:function(){new w({filter:["a","button"]})},transcludeCommentCounts:function(){t.on("page:common:ready",function(e,t){A.init(t)})},initLightboxGalleries:function(){var e;t.on("page:common:ready",function(t,n){var o=new O(t,n);e=t.page.pageId,o.init()}),t.on("module:lightbox-gallery:loaded",function(n,o){e!==n.page.pageId&&t.emit("page:common:deferred:loaded",n,o)})},initAbTests:function(e){j.segmentUser(e)},runAbTests:function(e,t){j.run(e,t)},initRightHandComponent:function(e){e.switches.rightHandMostPopular&&"Article"===e.page.contentType&&"mobile"!==u.getBreakpoint()&&parseInt(e.page.wordCount,10)>500&&new U(t,{type:"image",maxTrails:5})},logLiveStats:function(e){S.log(e)},loadAnalytics:function(e,n){var o=new _;o.go(e,function(){Array.prototype.forEach.call(n.getElementsByTagName("video"),function(t){s(t).hasClass("tracking-applied")||(s(t).addClass("tracking-applied"),new T({el:t,config:e}).init())})}),e.switches.ophan&&require("ophan/ng",function(n){n.record({ab:j.getParticipations()}),e.switches.scrollDepth&&(t.on("scrolldepth:data",n.record),new k({isContent:"Article"===e.page.contentType}))})},loadAdverts:function(e){if(i.isOff("adverts")||!e.switches.adverts||e.page.blockVideoAds||e.page.shouldHideAdverts)x.hideAds();else{var n=new M(e),o=function(){V(function(){x.reload(),t.emit("modules:adverts:reloaded")})};if("Article"===e.page.contentType&&!e.page.isLiveBlog){var s=new N;s.init(),o=function(){V(function(){s.reload(),x.reload(),t.emit("modules:adverts:reloaded")})}}t.on("page:common:deferred:loaded",function(e,t){x.init(e,t)}),t.on("modules:adverts:docwrite:loaded",function(){e.switches.dfpAdverts&&n.load(),x.load()}),t.on("window:resize",c(o,2e3))}},loadVideoAdverts:function(){t.on("page:common:ready",function(e,n){e.switches.videoAdverts&&!e.page.blockVideoAds?Array.prototype.forEach.call(n.querySelectorAll("video"),function(t){var o=u.getVideoFormatSupport();new E({el:t,support:o,config:e,context:n}).init(e.page)}):t.emit("video:ads:finished",e,n)})},cleanupCookies:function(){C.cleanUp(["mmcore.pd","mmcore.srv","mmid","GU_ABFACIA","GU_FACIA"]),C.cleanUpDuplicates(["GU_ALPHA","GU_VIEW"])},optIn:function(){var e=/#countmein/.test(window.location.hash);e&&C.add("GU_VIEW","responsive",365)},displayReleaseMessage:function(e){var t=document.location.pathname?document.location.pathname:"/",n="/preference/platform/classic?page="+encodeURIComponent(t+"?view=classic"),o='<p class="site-message__message" id="site-message__message">You’re viewing a beta release of the Guardian’s responsive website. We’d love to hear your <a href="https://www.surveymonkey.com/s/theguardian-beta-feedback" data-link-name="feedback">feedback</a></p><ul class="site-message__actions u-unstyled"><li class="site-message__actions__item"><i class="i i-back"></i><a class="js-main-site-link" rel="nofollow" href="'+n+'"data-link-name="opt-out">Opt-out and return to our current site </a></li></ul>',i=new q("alpha"),s=!!i.hasSeen("releaseMessage");e.switches.releaseMessage&&!s&&"mobile"!==u.getBreakpoint()&&(C.add("GU_VIEW","responsive",365),i.show(o))},displayOnboardMessage:function(e){if("#opt-in-message"===window.location.hash&&e.switches.networkFrontOptIn&&"mobile"!==u.getBreakpoint()){r.on(document,"click",".js-site-message-close",function(){C.add("GU_VIEW","responsive",365),C.add("GU_ALPHA","2",365)}),r.on(document,"click",".js-site-message",function(){C.add("GU_VIEW","responsive",365),C.add("GU_ALPHA","2",365)});var t=new q("onboard",{type:"modal"}),n=document.location.pathname?document.location.pathname:"/",o="/preference/platform/classic?page="+encodeURIComponent(n+"?view=classic"),i='<h2 class="site-message__header">Thanks for joining us.</h2><div class="site-message__message" id="site-message__message"><p>You’re looking at a prototype of our new website. Opt-out any time by clicking "Current version" at the bottom of the page. <a href="http://next.theguardian.com/">Find out more</a>.</p><ul class="site-message__list"><li class="site-message__list__item">We love feedback - <a href="https://www.surveymonkey.com/s/theguardian-beta-feedback">let us know yours</a>.</li><li class="site-message__list__item">Stay up to date with new releases on <a href="http://next.theguardian.com/blog/">our blog</a>.</li></ul><ul class="site-message__actions u-unstyled"><li class="site-message__actions__item"><i class="i i-arrow-white-circle"></i>  <a class="js-site-message-close" data-link-name="R2 alpha opt in" href="#" tabindex=1>Got it</a><li class="site-message__actions__item"><i class="i i-back-white"></i><a class="js-main-site-link" rel="nofollow" href="'+o+'"data-link-name="R2 alpha opt out">Opt-out and return to the current site </a></li></ul>';t.show(i)}},unshackleParagraphs:function(t,n){i.isOff("para-indents")&&e(".paragraph-spacing--indents",n).removeClass("paragraph-spacing--indents")},logReadingHistory:function(){t.on("page:common:ready",function(e){/Article|Video|Gallery|Interactive/.test(e.page.contentType)&&(new I).log({id:"/"+e.page.pageId,meta:{section:e.page.section,keywords:e.page.keywordIds.split(",").slice(0,5)}}),"identity"!==e.page.section&&L.init("/"+e.page.pageId)})},initAutoSignin:function(){t.on("page:common:ready",function(e){e.switches&&e.switches.facebookAutosignin&&"mobile"!==u.getBreakpoint()&&new D(e).init()})},loadTags:function(){t.on("page:common:ready",function(e){F.init(e)})},windowEventListeners:function(){var e={resize:"window:resize",orientationchange:"window:orientationchange",scroll:"window:scroll"},n=function(e){return function(n){t.emit(e,n)}};for(var o in e)r.on(window,o,c(n(e[o]),200))},checkIframe:function(){window.self!==window.top&&e("html").addClass("iframed")},runForseeSurvey:function(e){e.switches.foresee&&P.load()},augmentInteractive:function(){t.on("page:common:ready",function(n,o){/Article|Interactive/.test(n.page.contentType)&&e("figure.interactive").each(function(e){a.render(e,o,n,t)})})},startRegister:function(){R.initialise()}},H=function(e,o){var i=this;n(function(){i.initialisedDeferred||(i.initialisedDeferred=!0,B.initAbTests(e),B.logLiveStats(e),B.loadAdverts(e),B.loadAnalytics(e,o),B.cleanupCookies(o),B.runAbTests(e,o),B.transcludeRelated(e,o),B.initRightHandComponent(e,o)),t.emit("page:common:deferred:loaded",e,o)})},z=function(e,n){this.initialised||(this.initialised=!0,B.displayOnboardMessage(e),B.windowEventListeners(),B.checkIframe(),B.upgradeImages(),B.showTabs(),B.initialiseNavigation(e),B.showToggles(),B.showRelativeDates(),B.transcludePopular(),B.loadVideoAdverts(e),B.initClickstream(),B.transcludeCommentCounts(),B.initLightboxGalleries(),B.optIn(),B.displayReleaseMessage(e),B.logReadingHistory(),B.unshackleParagraphs(e,n),B.initAutoSignin(e),B.loadTags(e),B.augmentInteractive(),B.runForseeSurvey(e),B.startRegister()),t.emit("page:common:ready",e,n)},$=function(e,t){z(e,t),H(e,t)};return{init:$}}),define("common/modules/ui/collection-show-more",["common/$","bonzo","bean","qwery","common/utils/mediator","common/utils/detect","common/utils/ajax","common/modules/ui/relativedates","common/modules/discussion/comment-count"],function(e,t,n,o,i,s,r,a,c){var l="Show more",u=function(){return{wide:8,desktop:8,tablet:6,mobile:5}[s.getBreakpoint()]};return function(d){this._collection=d,this._$collection=t(d),this._items=null,this._$button=t(t.create('<button class="collection__show-more tone-background" data-link-name="'+l+' | 0"><span class="collection__show-more__icon"><span class="i i-plus-white-mask"></span><span class="i i-plus-white"></span></span><span class="u-h">'+l+"</span></button>")),this._renderButton=function(){this._$button.addClass("tone-"+(this._$collection.attr("data-tone")||"news")),this._$collection.after(this._$button);var e=this;n.on(this._$button[0],"click",function(){e._$button.attr("disabled",!0),e.showMore()}),i.emit("modules:collectionShowMore:renderButton",this)},this._removeButton=function(e){var t=this;e?this._$button.remove():i.on("module:clickstream:click",function(e){o(e.target)[0]===t._$button[0]&&t._$button.remove()})},this._incrementButtonCounter=function(){var e=this._$button.attr("data-link-name").replace(/^(.* | )(\d+)$/,function(e,t,n){return t+(parseInt(n,10)+1)});this._$button.attr("data-link-name",e)},this._enrichItems=function(){a.init(this._collection),c.init(this._collection)},this._showItems=function(e){var t=this._items.splice(0,u());this._$collection.append(t),this._enrichItems(),this._$button.attr("disabled",!1),this._incrementButtonCounter(),0===this._items.length&&this._removeButton(e||!1)},this._buttonVisibility=function(){var t=!1;e(".item",this._collection).map(function(n){"none"===e(n).css("display")&&(t=!0)}),this._items||t?this._$button.show():this._$button.hide()},this.addShowMore=function(){if(this._renderButton(),"false"===this._$collection.attr("data-can-show-more")){this._buttonVisibility();var e=s.hasCrossedBreakpoint(),t=this;i.on("window:resize",function(){e(function(){t._buttonVisibility()})})}},this.showMore=function(){if(null===this._items){var n=[];if(e(".item",this._collection).each(function(t){var o=e(t);"none"===o.css("display")&&n.push(t)}),"false"===this._$collection.attr("data-can-show-more"))t(n).detach(),this._items=n,this._showItems();else{t(n).remove();var o=this;r({url:"/"+this._$collection.attr("data-link-context-path")+".json",type:"json",crossOrigin:!0}).then(function(n){var i=e(".item__link",o._collection).map(function(t){return e(t).attr("href")}),s=t.create(e(".collection",t.create("<div>"+n.html+"</div>")).html())||[],r=e(".item",o._collection).length;o._items=s.filter(function(t){return-1===i.indexOf(e(".item__link",t).attr("href"))}).map(function(t,n){var o=e(t),i=o.attr("data-link-name").replace(/trail \| \d+/,"trail | "+(r+n+1));return o.attr("data-link-name",i),o[0]}),o._showItems(!0)}).fail(function(e){i.emit("module:error","Failed to load items: "+e.statusText)}).always(function(){o._$button.attr("disabled",!1)})}this._$collection.removeClass("js-collection--show-more collection--show-more")}else this._showItems()}}}),define("common/modules/onward/popular-fronts",["common/$","common/utils/mediator","common/utils/ajax","bonzo","common/modules/ui/relativedates","common/modules/ui/collection-show-more","common/modules/ui/images","common/modules/discussion/comment-count"],function(e,t,n,o,i,s,r,a){return{render:function(c,l){var u=l||{},d=u.insertAfter||e(".container").last(),m=c.page&&c.page.section&&"global"!==c.page.section;return n({url:"/most-read"+(m?"/"+c.page.section:"")+".json",type:"json",crossOrigin:!0}).then(function(t){var n=o.create(t.faciaHtml.trim())[0];return n?(o(n).insertAfter(d),new s(e(".collection",n)[0]).addShowMore(),a.init(n),i.init(n),void r.upgrade(n)):!1},function(e){t.emit("module:error","Failed to load facia popular: "+e.statusText)})}}}),define("common/modules/sport/cricket",["common/common","bonzo","common/utils/ajax"],function(e,t,n){function o(o,i,s){o.switches.liveCricket&&(n({url:"/sport"+s.url+".json",type:"json",crossOrigin:!0}).then(function(n){if(s.loadScorecard){var r=t.create("<div>"+n.scorecard+"</div>");t(r).addClass("cricket-scorecard lazyloaded"),e.$g(s.scorecardElement)[s.scorecardManipulation](r),e.mediator.emit("modules:cricketscorecard:loaded",o,i)}if(s.loadSummary){var a=t.create("<div>"+n.summary+"</div>");t(a).addClass("cricket-summary lazyloaded"),e.$g(s.summaryElement)[s.summaryManipulation](a),e.mediator.emit("modules:cricketsummary:loaded",o,i)}},function(t){e.mediator.emit("module:error","Failed to load cricket: "+t.statusText,"common/modules/cricketsummary.js")}),e.mediator.emit("modules:cricket:loaded",o,i))}function i(o,i){var s=i.querySelector("[data-cricket-match]");if(s&&o.switches.liveCricket){var r=t(s);n({url:"/sport"+s.getAttribute("data-cricket-match")+".json",type:"json",crossOrigin:!0}).then(function(e){r.append(t.create(e.summary))},function(t){e.mediator.emit("module:error","Failed to load cricket: "+t.statusText,"common/modules/cricketsummary.js")}),e.mediator.emit("modules:cricket:loaded",o,i)}}return{cricketArticle:o,cricketTrail:i}}),define("common/bootstraps/tag",["common/utils/mediator","common/modules/onward/popular-fronts","common/modules/sport/cricket"],function(e,t,n){var o={showPopular:function(){e.on("page:tag:ready",function(e){t.render(e)})},showCricket:function(){e.on("page:tag:ready",function(e,t){n.cricketTrail(e,t)})}},i=function(t,n){this.initialised||(this.initialised=!0,o.showPopular()),e.emit("page:tag:ready",t,n)};return{init:i}}),define("common/bootstraps/section",["common/utils/mediator","common/modules/onward/popular-fronts"],function(e,t){var n={showPopular:function(){e.on("page:section:ready",function(e){t.render(e)})}},o=function(t,o){this.initialised||(this.initialised=!0,n.showPopular()),e.emit("page:section:ready",t,o)};return{init:o}}),define("common/modules/analytics/discussion",["common/$","bonzo","common/utils/mediator","common/modules/identity/api"],function(e,t,n,o){var i={};i.seen=!1,i.getLinkTrackVars=function(e){e=e||[];var t=["events","prop4","prop6","prop8","prop10","prop13","prop19","prop31","prop51","prop75","eVar7","eVar8","eVar19","eVar31","eVar51","eVar66"];return t.concat(e).join(",")},i.comment=function(e){s.events="event51",s.eVar66=o.getUserFromCookie().id||null,s.eVar68=e.replyTo?"response":"comment",s.eVar67=e.replyTo?e.replyTo.authorId:null,s.linkTrackVars=this.getLinkTrackVars(["eVar68"]),s.linkTrackEvents="event51",s.tl(!0,"o","comment")},i.recommend=function(e){s.events="event72",s.eVar65="recommendation",s.eVar66=o.getUserFromCookie()?o.getUserFromCookie().id:null,s.eVar67=e.userId,s.linkTrackVars=this.getLinkTrackVars(["eVar65","eVar67"]),s.linkTrackEvents="event72",s.tl(!0,"o","Recommend a comment")},i.jumpedToComments=function(){i.seen||(s.events="event72",s.eVar65="seen jump-to-comments",s.eVar66=o.getUserFromCookie()?o.getUserFromCookie().id:null,s.linkTrackVars=this.getLinkTrackVars(["eVar65"]),s.linkTrackEvents="event72",s.tl(!0,"o","seen jump-to-comments"),i.seen=!0)},i.commentPermalink=function(){i.seen||(s.events="event72",s.eVar65="seen comment-permalink",s.eVar66=o.getUserFromCookie()?o.getUserFromCookie().id:null,s.linkTrackVars=this.getLinkTrackVars(["eVar65"]),s.linkTrackEvents="event72",s.tl(!0,"o","seen comment-permalink"),i.seen=!0)},i.scrolledToComments=function(){i.seen||(s.events="event72",s.eVar65="seen scroll-top",s.eVar66=o.getUserFromCookie()?o.getUserFromCookie().id:null,s.linkTrackVars=this.getLinkTrackVars(["eVar65"]),s.linkTrackEvents="event72",s.tl(!0,"o","seen scroll-top"),i.seen=!0)},i.areCommentsSeen=function(){var e,t=function(){i.seen||e||!i.areCommentsVisible()||(i.scrolledToComments(),n.off("window:scroll",t))};i.seen||n.on("window:scroll",t)},i.areCommentsVisible=function(){var n=e("#comments").offset(),o=e("body").first().scrollTop(),i=t.viewport().height;return n.top-i/2<o&&n.top+n.height-i/3>o?!0:!1};var r=function(){n.on("discussion:commentbox:post:success",i.comment.bind(i)),n.on("discussion:comment:recommend:success",i.recommend.bind(i)),n.on("discussion:seen:comment-permalink",i.commentPermalink.bind(i)),n.on("discussion:seen:comments-anchor",i.jumpedToComments.bind(i)),n.on("discussion:seen:comments-scrolled-to",i.scrolledToComments.bind(i)),i.areCommentsSeen()};return{init:r}}),define("common/modules/discussion/user-avatars",["common/$","bonzo","common/modules/discussion/api"],function(e,t,n){function o(){e(".user-avatar").each(i)}function i(e){var o=t(e),i=t(t.create("<div class='is-updating'></div>")),s=t(t.create("<img class='user-avatar__image' alt=''/>")),r=o.data("userid");o.removeClass("is-hidden"),i.css("display","block").appendTo(o),n.getUser(r).then(function(e){s.attr("src",e.userProfile.secureAvatarUrl),i.remove(),s.appendTo(o)})}return{init:o,avatarify:i}}),define("common/modules/identity/validation-email",["bean","bonzo","common/utils/mediator","common/modules/identity/api"],function(e,t,n,o){return{init:function(i){var s=i.querySelector(".js-id-send-validation-email");if(s){var r=t(s);e.on(s,"click",function(e){e.preventDefault(),o.isUserLoggedIn()&&o.sendValidationEmail().then(function(e){"error"===e.status?(n.emit("module:identity:validation-email:fail"),r.innerHTML="An error occured, please click here to try again."):(n.emit("module:identity:validation-email:success"),r.replaceWith("<p>Sent. Please check your email and follow the link.</p>"))},function(){n.emit("module:identity:validation-email:fail"),r.innerHTML="An error occured, please click here to try again."})})}}}}),define("common/modules/discussion/comment-box",["bean","bonzo","common/utils/context","common/utils/mediator","common/modules/discussion/api","common/modules/identity/api","common/modules/component","common/modules/discussion/user-avatars","common/modules/identity/validation-email"],function(e,t,n,o,i,s,r,a,c){function l(e){this.context=n(),this.mediator=o,this.setOptions(e),o.on("module:identity:validation-email:success",this.verificationEmailSuccess.bind(this)),o.on("module:identity:validation-email:fail",this.verificationEmailFail.bind(this))}return r.define(l),l.prototype.useBem=!0,l.prototype.templateName="comment-box",l.prototype.componentClass="d-comment-box",l.prototype.classes={},l.prototype.errorMessages={EMPTY_COMMENT_BODY:"Please write a comment.",COMMENT_TOO_LONG:"Your comment must be fewer than 5000 characters long.",ENHANCE_YOUR_CALM:"You can only post one comment every minute. Please try again in a moment.",USER_BANNED:'Commenting has been disabled for this account (<a href="/community-faqs#321a">why?</a>).',API_ERROR:"Sorry, there was a problem posting your comment.",EMAIL_VERIFIED:'<span class="d-comment-box__error-meta">Sent. Please check your email to verify '+(s.getUserFromCookie()?s.getUserFromCookie().primaryEmailAddress:" your email address")+". Once verified post your comment.</span>",EMAIL_VERIFIED_FAIL:'We are having technical difficulties. Please try again later or <a href="/send/email" class="js-id-send-validation-email"><strong>resend the verification</strong></a>.',EMAIL_NOT_VERIFIED:'Please confirm your email address to post your first comment.<br /><a href="_#" class="js-id-send-validation-email"><strong>Send verification email</strong></a><span class="d-comment-box__error-meta"> to '+(s.getUserFromCookie()?s.getUserFromCookie().primaryEmailAddress:" your email address")+".</span>"},l.prototype.defaultOptions={discussionId:null,apiRoot:null,maxLength:5e3,premod:!1,focus:!1,state:"top-level",replyTo:null,switches:{discussionVerifiedEmailPosting:!1},priorToVerificationDate:new Date(1392719401337)},l.prototype.errors=[],l.prototype.getUserData=function(){return s.getUserFromCookie()},l.prototype.prerender=function(){this.options.premod||this.getElem("premod").parentNode.removeChild(this.getElem("premod"));var e=this.getUserData();if(this.getElem("author").innerHTML=e.displayName,"response"===this.options.state)this.getElem("submit").innerHTML="Post reply";else{var t=this.getElem("avatar-wrapper");t.setAttribute("userid",e.id),a.avatarify(t)}if(this.options.replyTo){var n=this.getElem("reply-to-author");n.innerHTML=this.options.replyTo.author,this.getElem("parent-comment-author").innerHTML=this.options.replyTo.author+" @ "+this.options.replyTo.timestamp+" said:",this.getElem("parent-comment-body").innerHTML=this.options.replyTo.body;var o=function(){var e=n.offsetLeft+n.getBoundingClientRect().width/2;this.getElem("parent-comment-spout").style.marginLeft=e+"px"};window.setTimeout(o.bind(this),0)}},l.prototype.ready=function(){if(null===this.getDiscussionId())throw new Error('CommentBox: You need to set the "data-discussion-key" on your element');var t=this.getElem("body");this.setFormState(),e.on(this.context,"submit",[this.elem],this.postComment.bind(this)),e.on(this.context,"change keyup",[t],this.setFormState.bind(this)),e.on(t,"focus",this.setExpanded.bind(this)),this.on("click",this.getClass("cancel"),this.cancelComment),this.on("click",this.getClass("show-parent"),this.setState.bind(this,"parent-visible",!1)),this.on("click",this.getClass("hide-parent"),this.removeState.bind(this,"parent-visible",!1)),this.setState(this.options.state),this.options.focus&&this.getElem("body").focus()},l.prototype.postComment=function(e){var t=this,n={body:this.getElem("body").value};e.preventDefault(),t.clearErrors();var o=function(){""===n.body&&t.error("EMPTY_COMMENT_BODY"),n.body.length>t.options.maxLength&&t.error("COMMENT_TOO_LONG","<b>Comments must be shorter than "+t.options.maxLength+" characters.</b>Yours is currently "+(n.body.length-t.options.maxLength)+" characters too long."),t.options.replyTo&&(n.replyTo=t.options.replyTo),0===t.errors.length&&(t.setFormState(!0),i.postComment(t.getDiscussionId(),n).then(t.success.bind(t,n),t.fail.bind(t)))},r=function(){t.error("EMAIL_NOT_VERIFIED"),c.init(t.context)};if(t.options.switches.discussionVerifiedEmailPosting&&!t.getUserData().emailVerified){var a=new Date(t.getUserData().accountCreatedDate);a>t.options.priorToVerificationDate?s.getUserFromApiWithRefreshedCookie().then(function(e){e.user.statusFields.userEmailValidated===!0?o():r()}):o()}else o()},l.prototype.error=function(e,n){n=n||this.errorMessages[e],this.setState("invalid");var o=t.create('<div class="d-discussion__error '+this.getClass("error",!0)+'"><i class="i i-alert"></i><span class="d-discussion__error-text">'+n+"</span></div>")[0];this.getElem("messages").appendChild(o),this.errors.push(e)},l.prototype.success=function(e,t){e.id=parseInt(t.message,10),this.getElem("body").value="",this.setFormState(),this.emit("post:success",e),this.mediator.emit("discussion:commentbox:post:success",e)},l.prototype.fail=function(e){var t;try{t=JSON.parse(e.responseText)}catch(n){t={}}this.setFormState(),this.error(420===e.status?"ENHANCE_YOUR_CALM":this.errorMessages[t.errorCode]?t.errorCode:"API_ERROR")},l.prototype.getDiscussionId=function(){return this.options.discussionId||this.elem.getAttribute("data-discussion-key").replace("discussion","")},l.prototype.setFormState=function(e){e="boolean"==typeof e?e:!1;var t=this.getElem("body"),n=this.getElem("submit");e||0===t.value.length?n.setAttribute("disabled","disabled"):n.removeAttribute("disabled")},l.prototype.clearErrors=function(){this.getElem("messages").innerHTML="",this.errors=[],this.removeState("invalid")},l.prototype.setExpanded=function(){this.setState("expanded")},l.prototype.verificationEmailSuccess=function(){this.clearErrors(),this.error("EMAIL_VERIFIED")},l.prototype.verificationEmailFail=function(){this.clearErrors(),this.error("EMAIL_VERIFIED_FAIL")},l.prototype.cancelComment=function(){"response"===this.options.state?this.destroy():(this.getElem("body").value="",this.setFormState(),this.removeState("expanded"))},l}),define("common/modules/discussion/recommend-comments",["bean","qwery","common/utils/mediator","common/modules/discussion/api","common/modules/identity/api"],function(e,t,n,o,i){var s={};return s.CONFIG={classes:{button:"js-recommend-comment",count:"js-recommend-count",active:"d-comment__recommend--active",userRecommended:"d-comment__recommend--user-recommended",open:"d-discussion--recommendations-open"},events:{prefix:"discussion:comment:recommend:",init:"initialised",success:"success",fail:"fail"}},s.init=function(e,o){var r;this.open=this.open||t("."+s.CONFIG.classes.open,e).length>0,this.open&&(r=t("."+s.CONFIG.classes.button,e));for(var a in o)s.options[a]=o[a];r&&(Array.prototype.forEach.call(r,function(e){var t=i.getUserFromCookie(),n=t?t.id:null,o=e.getAttribute("data-user-id")===n;n&&o||(e.className=e.className+" "+s.CONFIG.classes.active,e.title=e.title+=" - recommend this comment")}),s.bindEvents(e),n.emit(s.getEvent("init")))},s.bindEvents=function(t){e.on(t,"click","."+s.CONFIG.classes.active,s.handleClick)},s.handleClick=function(e){var t=e.currentTarget,n=t.getAttribute("data-comment-id"),o=s.recommendComment(n);return t.className=t.className.replace(s.CONFIG.classes.active,""),s.renderRecommendation(t),o.then(s.success.bind(t),s.fail.bind(t))},s.recommendComment=function(e){return o.recommendComment(e)},s.success=function(){n.emit(s.getEvent("success"),{id:parseInt(this.getAttribute("data-comment-id"),10),userId:parseInt(this.getAttribute("data-user-id"),10),count:parseInt(this.getAttribute("data-recommend-count"),10)})},s.fail=function(e){var t="NOT FOUND"!==e.responseText&&""!==e.responseText?JSON.parse(e.responseText):{};s.renderRecommendation(this,!0),"CAN'T_RECOMMEND_SAME_COMMENT_TWICE"===t.errorCode&&(this.className=this.className.replace(s.CONFIG.classes.active,""),this.title="You cannot recommend the same comment twice"),this.className=this.className+" "+s.CONFIG.classes.button,n.emit(s.getEvent("fail"),{id:parseInt(this.getAttribute("data-comment-id"),10),count:parseInt(this.getAttribute("data-recommend-count"),10),errorCode:t.errorCode})},s.renderRecommendation=function(e,t){var n=parseInt(e.getAttribute("data-recommend-count"),10),o=t?n-1:n+1;e.className=t?(e.className+" "+s.CONFIG.classes.active).replace(s.CONFIG.classes.userRecommended,""):(e.className+" "+s.CONFIG.classes.userRecommended).replace(s.CONFIG.classes.active,""),e.setAttribute("data-recommend-count",o)},s.getEvent=function(e){return s.CONFIG.events.prefix+s.CONFIG.events[e]||null},s}),define("common/modules/discussion/comments",["common/$","bonzo","qwery","bean","common/utils/ajax","common/modules/component","common/modules/userPrefs","common/modules/identity/api","common/modules/discussion/comment-box","common/modules/discussion/recommend-comments","common/modules/discussion/api"],function(e,t,n,o,i,s,r,a,c,l,u){var d=function(e,t,n){this.context=e||document,this.mediator=t,this.setOptions(n),this.options.commentId&&(this.endpoint="/discussion/comment-permalink/"+this.options.commentId+".json"),r.get("discussion.order")&&(this.options.order=r.get("discussion.order")),"oldest"===this.options.order&&(this.endpoint="/discussion/oldest"+this.options.discussionId+".json")};return s.define(d),d.prototype.componentClass="d-discussion",d.prototype.classes={container:"discussion__comments__container",comments:"d-thread--top-level",topLevelComment:"d-comment--top-level",showMore:"d-discussion__show-more",showMoreNewerContainer:"show-more__container--newer",showMoreOlderContainer:"show-more__container--older",showMoreHiddenContainer:"show-more__container--hidden",showMoreNewer:"d-discussion__show-more--newer",showMoreOlder:"d-discussion__show-more--older",showMoreLoading:"d-discussion__show-more-loading",showHidden:"d-discussion__show-hidden",reply:"d-comment--response",showReplies:"d-show-more-replies",header:"d-discussion__header",heading:"discussion__heading",newComments:"js-new-comments",orderControl:"d-discussion__order-control",loader:"d-discussion__loader",comment:"d-comment",commentActions:"d-comment__actions__main",commentReply:"d-comment__action--reply",commentPick:"d-comment__action--pick",commentRecommend:"d-comment__recommend",commentStaff:"d-comment--staff",commentBlocked:"d-comment--blocked",commentBody:"d-comment__body",commentTimestampJs:"js-timestamp"},d.prototype.defaultOptions={discussionId:null,initialShow:10,showRepliesCount:3,user:null,commentId:null,order:"newest"},d.prototype.endpoint="/discussion:discussionId.json",d.prototype.hasHiddenComments=!1,d.prototype.comments=null,d.prototype.topLevelComments=null,d.prototype.user=null,d.prototype.prerender=function(){var e=this,o=n(this.getClass("heading"),this.getClass("container"))[0],i=this.elem.getAttribute("data-comment-count"),s=this.options.initialShow;if(o.innerHTML+=' <span class="discussion__comment-count">('+i+")</span>",this.user=this.options.user,this.topLevelComments=n(this.getClass("topLevelComment"),this.elem),this.comments=n(this.getClass("comment"),this.elem),this.user&&this.user.badge&&(this.user.isStaff=this.user.badge.some(function(e){return"Staff"===e.name}),this.user.isStaff&&(this.removeState("not-staff"),this.setState("is-staff"))),this.topLevelComments.length>s){var r=n(this.getClass("topLevelComment"),this.elem).filter(function(n){return!t(n).hasClass(e.getClass("commentBlocked",!0))});r.length>=s?(t(this.topLevelComments).addClass("u-h"),t(r.slice(0,s)).removeClass("u-h")):t(this.topLevelComments.slice(s)).addClass("u-h"),t(this.getElem("showMoreOlderContainer")).addClass("u-h"),t(this.getElem("showMoreHiddenContainer")).removeClass("u-h")}},d.prototype.ready=function(){if(this.on("click",this.getClass("showReplies"),this.getMoreReplies),this.on("click",this.getClass("showMore"),this.loadMore),this.on("click",this.getClass("showHidden"),this.showHiddenComments),this.on("change",this.getClass("orderControl"),this.setOrder),this.mediator.on("discussion:comment:recommend:fail",this.recommendFail.bind(this)),this.addMoreRepliesButtons(),this.isReadOnly()||this.bindCommentEvents(),this.options.commentId){var t=e("#comment-"+this.options.commentId);t.attr("hidden")&&o.fire(e(this.getClass("showReplies"),t.parent())[0],"click"),window.location.replace("#comment-"+this.options.commentId)}this.getElem("showMoreNewer")||e(this.getClass("showMoreNewerContainer")).addClass("u-h"),this.getElem("showMoreOlder")||e(this.getClass("showMoreOlderContainer")).addClass("u-h"),this.emit("ready")},d.prototype.bindCommentEvents=function(){l.init(this.context),this.user&&this.user.privateFields.canPostComment&&(this.on("click",this.getClass("commentReply"),this.replyToComment),this.on("click",this.getClass("commentPick"),this.handlePickClick))},d.prototype.handlePickClick=function(t){t.preventDefault();var n=t.target.getAttribute("data-comment-id"),o=e(t.target),i="true"===o[0].getAttribute("data-comment-highlighted")?this.unPickComment.bind(this):this.pickComment.bind(this);i(n,o).fail(function(n){var o=n.response.length>0?JSON.parse(n.response).message:n.statusText;e(t.target).text(o)})},d.prototype.pickComment=function(t,o){var i=this,s=n("#comment-"+t,this.elem);return u.pickComment(t).then(function(){e(i.getClass("commentPick"),s).removeClass("u-h"),e(i.getClass("commentRecommend"),s).addClass("d-comment__recommend--left"),o.text("Unpick"),s.setAttribute("data-comment-highlighted",!0)})},d.prototype.unPickComment=function(t,o){var i=this,s=n("#comment-"+t);return u.unPickComment(t).then(function(){e(i.getClass("commentPick"),s).addClass("u-h"),e(i.getClass("commentRecommend"),s).removeClass("d-comment__recommend--left"),o.text("Pick"),s.setAttribute("data-comment-highlighted",!1)})},d.prototype.gotoComment=function(t){var n=e("#comment-"+t,this.elem);return n.length>0?void window.location.replace("#comment-"+t):this.fetchComments({comment:t,position:"replace"}).then(function(){window.location.replace("#comment-"+t)}.bind(this))},d.prototype.gotoPage=function(e){return this.fetchComments({page:e,position:"replace"})},d.prototype.loadMore=function(e){e.preventDefault();var n=e.currentTarget,o=n.getAttribute("data-age"),i=parseInt(n.getAttribute("data-page"),10);if(n.getAttribute("data-disabled"))return!1;var s=t(n),r=s.parent();s.remove();var a=t.create('<span class="'+this.getClass("showMoreLoading",!0)+'">Loading…</span>');return r.empty().append(a),this.fetchComments({page:i,position:"newer"===o?"prepend":"append"})},d.prototype.fetchComments=function(e){var t=e.comment?"/discussion/comment-permalink/"+e.comment+".json":"/discussion/"+("oldest"===this.options.order?"oldest":"")+this.options.discussionId+".json?"+(e.page?"&page="+e.page:"")+"&maxResponses=3";
return i({url:t,type:"json",method:"get",crossOrigin:!0}).then(this.renderComments.bind(this,e.position))},d.prototype.renderComments=function(o,i){var s=t.create(i.html),r=n(this.getClass("topLevelComment"),s),a=function(o){var i=n(this.getClass(o),s),r=n(this.getClass(o),this.elem),a=this.getElem(o+"Container");e(this.getClass("showMoreLoading"),a).remove(),0===i.length?t(a).addClass("u-h"):0===r.length&&t(a).append(i)}.bind(this);a("showMoreOlder"),a("showMoreNewer"),n(this.getClass("comment"),this.getElem("newComments")).forEach(function(t){var n=e("#"+t.id,s);1===n.length&&e(t).remove()}),"replace"===o?t(this.getElem("comments")).empty().append(r):t(this.getElem("comments"))[o](r),this.addMoreRepliesButtons(r),"oldest"===this.options.order?e(this.getElem("newComments")).insertAfter(e(this.getElem("showMoreOlderContainer"))):e(this.getElem("newComments")).insertBefore(e(this.getElem("showMoreNewerContainer"))),this.isReadOnly()||l.init(this.context),this.emit("loaded")},d.prototype.showHiddenComments=function(e){e&&e.preventDefault(),n(this.getClass("topLevelComment"),this.elem).forEach(function(e){t(e).removeClass("u-h")}),t(this.getElem("showMoreOlderContainer")).removeClass("u-h"),t(this.getElem("showMoreHiddenContainer")).addClass("u-h"),this.emit("first-load")},d.prototype.addMoreRepliesButtons=function(e){var o=this;e=e||this.topLevelComments,e.forEach(function(e){var i=parseInt(e.getAttribute("data-comment-replies"),10),s=n(o.getClass("reply"),e);if(s.length<i){var r=i-s.length,a="";a+='<li class="'+o.getClass("showReplies",!0)+'" ',a+='data-link-name="Show more replies" ',a+='data-is-ajax data-comment-id="'+e.getAttribute("data-comment-id")+'">',a+='<span><i class="i i-plus-white-small"></i></span>',a+="Show "+r+" more "+(1===r?"reply":"replies"),a+="</li>",a=t.create(a),t(a).data("source-comment",e),t(n(".d-thread--responses",e)).append(a)}})},d.prototype.getMoreReplies=function(e){e.preventDefault();var o=this,s=t(e.target).data("source-comment");i({url:"/discussion/comment/"+e.target.getAttribute("data-comment-id")+".json",type:"json",method:"get",crossOrigin:!0}).then(function(i){var r=t.create(i.html),a=n(o.getClass("reply"),r);a=a.slice(o.options.showRepliesCount,a.length),t(n(".d-thread--responses",s)).append(a),t(e.currentTarget).addClass("u-h"),o.isReadOnly()||l.init(s)})},d.prototype.isReadOnly=function(){return"true"===this.elem.getAttribute("data-read-only")},d.prototype.addComment=function(e,o,i){var s,r,a,c,l,u={username:"d-comment__author",timestamp:"js-timestamp",body:"d-comment__body",report:"d-comment__action--report",avatar:"d-comment__avatar"},d={username:this.user.displayName,timestamp:"Just now",body:"<p>"+e.body.replace(/\n+/g,"</p><p>")+"</p>",report:{href:"http://discussion.theguardian.com/components/report-abuse/"+e.id},avatar:{src:this.user.avatar}},m=t.create(document.getElementById("tmpl-comment").innerHTML)[0],f=t(m);f.addClass("d-comment--new");for(s in u)if(u.hasOwnProperty(s))if(a=u[s],r=d[s],c=n("."+a,m)[0],"string"==typeof r)c.innerHTML=r;else for(l in r)c.setAttribute(l,r[l]);m.id="comment-"+e.id,this.user&&!this.user.isStaff&&f.addClass(this.getClass("commentStaff",!0)),i?(f.removeClass(this.getClass("topLevelComment",!0)),f.addClass(this.getClass("reply",!0)),t(i).append(f)):t(this.getElem("newComments")).prepend(m),window.location.replace("#comment-"+e.id)},d.prototype.replyToComment=function(e){var o,i,s=e.currentTarget,r=s.getAttribute("data-comment-id"),a=this;if(document.getElementById("reply-to-"+r))return void document.getElementById("reply-to-"+r).focus();var l=n("#comment-"+r)[0],u=l.getAttribute("data-comment-author"),d=l.getAttribute("data-comment-author-id"),m=t(l),f=n(this.getClass("commentBody"),l)[0].innerHTML,p=n(this.getClass("commentTimestampJs"),l)[0].innerHTML,h=new c({discussionId:this.options.discussionId,premod:this.user.privateFields.isPremoderated,state:"response",replyTo:{commentId:r,author:u,authorId:d,body:f,timestamp:p},focus:!0});o=m.hasClass(this.getClass("topLevelComment",!0))?m[0]:m.parent().parent()[0],i=n(this.getClass("showReplies"),o),i.length>0&&!t(i).hasClass("u-h")&&i[0].click(),h.render(o),h.on("post:success",function(e){var i=n(".d-thread--responses",o)[0];i||(i=t.create('<ul class="d-thread d-thread--responses"></ul>')[0],t(o).append(i)),this.destroy(),a.addComment(e,!1,i)})},d.prototype.recommendFail=function(){},d.prototype.showDiscussion=function(){var t=e(".d-discussion__show-all-comments");t.hasClass("u-h")||(o.fire(t,"click"),t.addClass("u-h"))},d.prototype.loading=function(){e(this.getElem("loader")).removeClass("u-h"),e(this.getElem("comments")).addClass("u-h"),e(this.getElem("showMoreOlderContainer")).addClass("u-h"),e(this.getElem("showMoreNewerContainer")).addClass("u-h")},d.prototype.loaded=function(){e(this.getElem("loader")).addClass("u-h"),e(this.getElem("comments")).removeClass("u-h"),e(this.getElem("showMoreOlderContainer")).removeClass("u-h"),e(this.getElem("showMoreNewerContainer")).removeClass("u-h")},d.prototype.setOrder=function(n){var o=n.currentTarget,i=o.options[o.selectedIndex].value,s=e(this.getElem("newComments"));return this.options.order=i,this.options.initialShow=this.defaultOptions.initialShow,this.showDiscussion(),this.loading(),t(this.getElem("showMoreHiddenContainer")).addClass("u-h"),e(this.getElem("showMoreOlderContainer")).empty(),e(this.getElem("showMoreNewerContainer")).empty(),s.empty(),r.set("discussion.order",i),this.fetchComments({page:1,position:"replace"}).then(function(){this.loaded()}.bind(this))},d}),define("common/modules/discussion/top-comments",["common/utils/ajax","bonzo","qwery","common/modules/component","common/modules/identity/api","common/modules/discussion/comment-box","common/modules/discussion/recommend-comments","common/$"],function(e,t,n,o,i,s,r,a){var c=function(e,t,n){this.context=e||document,this.mediator=t,this.setOptions(n)};return o.define(c),c.prototype.classes={comments:"d-thread--top-level",topLevelComment:"d-comment--top-level",reply:"d-comment--response",showReplies:"d-show-more-replies",topCommentTitle:"page-sub-header",comment:"d-comment",commentActions:"d-comment__actions__main",commentReply:"d-comment__action--reply",showMoreFeatured:"show-more__container--featured",showMoreFeaturedButton:"js-show-more-top-comments",topCommentsContainer:"discussion__comments__top",titleCounter:"discussion__comment-count",fadeOut:"d-image-fade"},c.prototype.endpoint="/discussion/top:discussionId.json",c.prototype.defaultOptions={discussionId:null,showRepliesCount:3,user:null,sectionHeading:"Featured Comments "},c.prototype.hasHiddenComments=!1,c.prototype.currentPage=1,c.prototype.comments=null,c.prototype.topLevelComments=null,c.prototype.user=null,c.prototype.fetch=function(n){var o,i=this,s=this.endpoint;for(o in this.options)s=s.replace(":"+o,this.options[o]);return e({url:s,type:"json",method:"get",crossOrigin:!0}).then(function(e){e.currentCommentCount>0?(i.topCommentsAmount=e.currentCommentCount,i.parent=n,i.elem=t.create(e.html),a(i.getClass("topCommentsContainer"),n).append(i.elem),i.elem=i.elem[0],i.elems={},i.prerender(),i.ready(),i.mediator.emit("module:topcomments:loadcomments",{amount:0})):(a(".discussion__comments--top-comments").remove(),i.mediator.emit("module:topcomments:loadcomments",{amount:2,showLoader:!0}))},function(){a(".discussion__comments--top-comments").remove(),i.mediator.emit("module:topcomments:loadcomments",{amount:2,showLoader:!0})})},c.prototype.ready=function(){var e=this;this.user=this.options.user,this.topLevelComments=n(this.getClass("topLevelComment"),this.elem),this.comments=n(this.getClass("comment"),this.elem),this.commentsContainer=n(this.getClass("comments"),this.elem)[0];var o=.66*t.viewport().height;o=Math.max(o,200),o=Math.min(o,800),this.commentsContainer.offsetHeight>o&&(this.truncateFeatured(parseInt(o,10)),this.on("click",this.getClass("showMoreFeaturedButton"),this.showAllFeatured));var i=document.querySelector(".js-top-comments");i.childNodes[0].nodeValue=e.options.sectionHeading,1===e.topCommentsAmount?i.childNodes[0].nodeValue=i.childNodes[0].nodeValue.replace(/s\b/,""):a(e.getClass("titleCounter")).removeClass("u-h")[0].innerHTML="("+e.topCommentsAmount+")",e.emit("ready")},c.prototype.bindCommentEvents=function(){r.init(this.context),this.user&&this.user.privateFields.canPostComment&&this.on("click",this.getClass("commentReply"),this.replyToComment)},c.prototype.truncateFeatured=function(e){this.hasHiddenComments=!0,a(".d-image-fade",this.parent).removeClass("u-h"),a(this.getClass("showMoreFeatured"),this.elem).removeClass("u-h"),a(this.commentsContainer).css("max-height",e+"px")},c.prototype.showAllFeatured=function(e){e&&e.preventDefault(),this.hasHiddenComments=!1,a(".d-image-fade",this.parent).addClass("u-h"),a(this.getClass("showMoreFeatured"),this.elem).addClass("u-h"),a(this.commentsContainer).css("max-height","none")},c.prototype.replyToComment=function(e){var o,i,r=e.currentTarget,a=r.getAttribute("data-comment-id"),c=this;if(document.getElementById("reply-to-"+a))return void document.getElementById("reply-to-"+a).focus();var l=n("#comment-"+a)[0],u=l.getAttribute("data-comment-author"),d=l.getAttribute("data-comment-author-id"),m=t(l),f=new s({discussionId:this.options.discussionId,premod:this.user.privateFields.isPremoderated,state:"response",replyTo:{commentId:a,author:u,authorId:d},focus:!0,cancelable:!0});o=m.hasClass(this.getClass("topLevelComment",!0))?m[0]:m.parent().parent()[0],i=n(this.getClass("showReplies"),o),i.length>0&&i[0].click(),f.render(o),f.on("post:success",function(e){var i=n(".d-thread--responses",o)[0];i||(i=t.create('<ul class="d-thread d-thread--responses"></ul>')[0],t(o).append(i)),c.addComment(e,!1,i),this.destroy()})},c}),define("common/modules/discussion/loader",["common/$","common/utils/ajax","bonzo","qwery","bean","common/modules/component","common/modules/analytics/register","common/modules/analytics/discussion","common/modules/identity/api","common/modules/discussion/api","common/modules/discussion/comments","common/modules/discussion/top-comments","common/modules/discussion/comment-box"],function(e,t,n,o,i,s,r,a,c,l,u,d,m){var f=function(e,t,n){this.context=e||document,this.mediator=t,this.setOptions(n),r.begin("discussion")};return s.define(f),f.prototype.context=null,f.prototype.defaultOptions={switches:{}},f.prototype.classes={commentsContainer:"discussion__comments__container",comments:"discussion__comments",commentBox:"discussion__comment-box",commentBoxBottom:"discussion__comment-box--bottom",joinDiscussion:"d-discussion__show-all-comments",topComments:"discussion__comments--top-comments"},f.prototype.componentClass="discussion",f.prototype.comments=null,f.prototype.commentBox=null,f.prototype.bottomCommentBox=null,f.prototype.user=null,f.prototype.canComment=!1,f.prototype.ready=function(){var e=this,t=this.getElem("topComments");this.topLoadingElem=n.create('<div class="preload-msg">Loading comments… <a href="/discussion'+this.getDiscussionId()+'" class="accessible-link">Trouble loading?</a><div class="is-updating"></div></div>')[0],n(this.topLoadingElem).insertAfter(t),this.on("user:loaded",function(){this.topComments=new d(e.context,e.mediator,{discussionId:this.getDiscussionId(),user:e.user}),this.topComments.fetch(t).then(function(){n(e.topLoadingElem).addClass("u-h")}),this.mediator.on("module:topcomments:loadcomments",e.loadComments.bind(e))}),this.getUser(),this.renderCommentCount(),a.init(),i.on(window,"hashchange",function(){var t=e.getCommentIdFromHash();t&&(e.comments.gotoComment(t),n(e.getElem("joinDiscussion")).addClass("u-h"))}),"#comments"===window.location.hash&&this.mediator.emit("discussion:seen:comments-anchor"),r.end("discussion")},f.prototype.loadComments=function(e){var t=this,o=this.getElem("commentsContainer"),i=this.getElem("comments"),s=n.create('<div class="preload-msg">Loading comments…<div class="is-updating"></div></div>')[0],r=this.getCommentIdFromHash(),a=e.showLoader||r||"#comments"===window.location.hash;e.showLoader&&n(o).removeClass("u-h"),n(t.topLoadingElem).addClass("u-h"),n(s).insertAfter(i),r&&this.mediator.emit("discussion:seen:comment-permalink"),this.comments=new u(this.context,this.mediator,{initialShow:r?10:e.amount,discussionId:this.getDiscussionId(),user:this.user,commentId:r?r:null,order:this.getDiscussionClosed()?"oldest":"newest"}),this.comments.fetch(i).then(function(){n(s).remove(),t.renderCommentBar(t.user),a?(n(t.getElem("joinDiscussion")).remove(),n([t.comments.getElem("showMore"),t.comments.getElem("header")]).removeClass("u-h")):n(t.comments.getElem("showMore")).addClass("u-h"),t.on("click",t.getElem("joinDiscussion"),function(e){t.comments.showHiddenComments(e),t.cleanUpOnShowComments()}),n(o).removeClass("js-hidden")}).fail(t.loadingError.bind(t))},f.prototype.getUser=function(){var e=this;return c.getUserFromCookie()?l.getUser().then(function(t){e.user=t.userProfile,e.emit("user:loaded",t.userProfile)}):void e.emit("user:loaded")},f.prototype.loadingError=function(){n(this.getElem("commentsContainer")).remove()},f.prototype.renderReadOnly=function(){this.getElem("commentBox").innerHTML='<div class="d-bar d-bar--closed"><b>We\'re doing some maintenance right now.</b> You can still read comments, but please come back later to add your own.</div>'},f.prototype.renderDiscussionClosedMessage=function(){this.getElem("commentBox").innerHTML='<div class="d-bar d-bar--closed">This discussion is closed for comments.</div>'},f.prototype.renderSignin=function(){var e=c.getUrl()+"/{1}?returnUrl="+window.location.href;this.getElem("commentBox").innerHTML='<div class="d-bar d-bar--signin">Open for comments. <a href="'+e.replace("{1}","signin")+'">Sign in</a> or <a href="'+e.replace("{1}","register")+'">create your Guardian account</a> to join the discussion.</div>'},f.prototype.renderCommentBar=function(){this.comments.isReadOnly()?this.renderReadOnly():this.getDiscussionClosed()?this.renderDiscussionClosedMessage():c.getUserFromCookie()?(this.renderCommentBox(),this.comments.on("first-load",this.renderBottomCommentBox.bind(this)),this.comments.on("first-load",this.cleanUpOnShowComments.bind(this))):this.renderSignin()},f.prototype.renderCommentBox=function(){this.user.privateFields?this.user.privateFields.canPostComment?(this.commentBox=new m({discussionId:this.getDiscussionId(),premod:this.user.privateFields.isPremoderated,switches:this.options.switches}),this.commentBox.render(this.getElem("commentBox")),this.commentBox.on("post:success",this.commentPosted.bind(this)),this.canComment=!0):this.renderUserBanned():this.renderSignin()},f.prototype.commentPosted=function(){this.comments.addComment.apply(this.comments,arguments),this.firstComment||(this.firstComment=!0,this.comments.showHiddenComments(),this.cleanUpOnShowComments())},f.prototype.cleanUpOnShowComments=function(){n([this.comments.getElem("showMore"),this.comments.getElem("header")]).removeClass("u-h"),n(this.getElem("joinDiscussion")).addClass("u-h")},f.prototype.renderUserBanned=function(){this.getElem("commentBox").innerHTML='<div class="d-bar d-discussion__error d-bar--banned">Commenting has been disabled for this account (<a href="/community-faqs#321a">why?</a>).</div>'},f.prototype.renderBottomCommentBox=function(){this.bottomCommentBox||(this.bottomCommentBox=new m({discussionId:this.getDiscussionId(),premod:this.user.privateFields.isPremoderated}),this.bottomCommentBox.render(this.getElem("commentBoxBottom")),this.bottomCommentBox.on("post:success",function(e){this.comments.addComment(e,!0)}.bind(this)))},f.prototype.getDiscussionId=function(){return this.elem.getAttribute("data-discussion-key")},f.prototype.getDiscussionClosed=function(){return"true"===this.elem.getAttribute("data-discussion-closed")},f.prototype.renderCommentCount=function(){t({url:"/discussion/comment-counts.json?shortUrls="+this.getDiscussionId(),type:"json",method:"get",crossOrigin:!0,success:function(e){if(e&&e.counts&&e.counts.length){var t=e.counts[0].count;if(t>0){n(o(".js-show-discussion, .js-show-discussion a",this.context)).attr("href","#comments");var i=1===t?"comment":"comments",s='<a href="#comments" class="js-show-discussion commentcount tone-colour" data-link-name="Comment count">  <i class="i"></i>'+t+'  <span class="commentcount__label">'+i+"</span></a>";n(o(".js-comment-count",this.context)).html(s)}}}})},f.prototype.getCommentIdFromHash=function(){var e=/#comment-(\d+)/;return e.exec(window.location.hash)?parseInt(e.exec(window.location.hash)[1],10):null},f}),define("common/bootstraps/imagecontent",["common/utils/mediator","common/modules/discussion/loader","common/$"],function(e,t,n){var o={initDiscussion:function(){e.on("page:imagecontent:ready",function(o,i){if(o.page.commentable){var s=new t(i,e);s.attachTo(n(".discussion")[0])}})}},i=function(t,n){this.initialised||(this.initialised=!0,o.initDiscussion()),e.emit("page:imagecontent:ready",t,n)};return{init:i}}),define("common/modules/sport/football/page",["common/$","common/utils/config"],function(e,t){function n(e){var n=t.referencesOfType("paFootballTeam"),o=t.page.footballMatch;return o||(t.hasTone("Match reports")||t.page.isLiveBlog)&&2===n.length?e(o||{date:t.webPublicationDateAsUrlPart(),teams:n}):void 0}function o(t){var n=(e(".js-football-competition").attr("data-link-name")||"").replace("keyword: ","");return n?t(n):void 0}function i(e){return t.hasSeries("Clockwatch")?e():void 0}function s(e){i(function(){return t.page.isLive?e():void 0})}return{isMatch:n,isCompetition:o,isClockwatch:i,isLiveClockwatch:s}}),define("common/modules/sport/football/match-list",["common/modules/component","common/$","bonzo"],function(e,t,n){var o=function(e,t){this.endpoint+=["football",t,e].filter(function(e){return e}).join("/")+".json"};return e.define(o),o.prototype.endpoint="/",o.prototype.autoupdated=!0,o.prototype.updateEvery=10,o.prototype.prerender=function(){var e=this.elem;t(".football-team__form",e).remove(),t(".date-divider",e).remove(),t(this.elem).addClass("table--small"),0===t(".table__caption",this.elem).length&&n(n.create('<caption class="table__caption">Live scores</caption>')).each(function(n){t(".football-matches",e).prepend(n)})},o.prototype.autoupdate=function(e){var o,i,s=t(".football-match",e),r=this;t(".football-match",this.elem).each(function(e,t){o=n(e).removeClass("football-match--updated"),i=n(s[t]),["score-home","score-away","match-status"].forEach(function(e){e="data-"+e,i.attr(e)!==o.attr(e)&&(o.replaceWith(i.addClass("football-match--updated")),r.prerender())})})},o}),define("common/modules/sport/football/match-info",["common/$","common/utils/ajax"],function(e,t){var n=function(e,t){this.endpoint+=(e.id?e.id:[e.date].concat(e.teams).join("/"))+".json?page="+encodeURIComponent(t)};return n.prototype.endpoint="/football/api/match-nav/",n.prototype.fetch=function(){return t({crossOrigin:!0,url:this.endpoint})},n}),define("common/modules/sport/football/score-board",["common/modules/component"],function(e){var t=function(){};return e.define(t),t}),define("common/modules/sport/football/table",["common/modules/component"],function(e){var t=function(e){this.endpoint="/"+e+"/table.json"};return e.define(t),t}),define("common/bootstraps/football",["common/$","bonzo","bean","common/utils/context","common/utils/config","common/modules/sport/football/page","common/modules/sport/football/match-list","common/modules/sport/football/match-info","common/modules/sport/football/score-board","common/modules/sport/football/table"],function(e,t,n,o,i,s,r,a,c,l){function u(){s.isMatch(function(n){var s=e(".article__headline",o),r=new a(n,i.page.pageId),l=new c,u=t.create('<div class="score__container"><div class="score__loading'+(i.page.isLiveBlog?" score__loading--live":"")+'"><div class="loading__text">Fetching the scores…</div><div class="is-updating"></div></div></div>')[0];s.before(u),i.page.isLiveBlog&&s.addClass("u-h"),r.fetch().then(function(t){e(".after-header",o).append(t.nav),l.template=i.page.isLiveBlog?t.matchSummary:t.scoreSummary,u.innerHTML="",l.render(u)})}),s.isCompetition(function(n){var i=new l(n),s=t.create('<div class="js-football-table" data-link-name="football-table-embed"></div>');e(".js-right-hand-component",o).append(s),i.fetch(s)}),s.isLiveClockwatch(function(){var n=new r("live","premierleague"),o=e(".media-primary"),i=t(t.create('<div class="football-match__list" data-link-name="football-matches-clockwatch"></div>')).css({minHeight:o[0].offsetHeight});o.addClass("u-h"),d(i[0],"Fetching today's matches…",{text:"Impatient?",href:"/football/live"}),e(".article__meta-container").before(i),n.fetch(i[0]).fail(function(){n.destroy(),i.remove(),o.removeClass("u-h")}).always(function(){0===e(".football-match",i[0]).length&&(n.destroy(),i.remove(),o.removeClass("u-h")),m(i[0])})}),n.on(o,"click",".table tr[data-link-to]",function(){window.location=this.getAttribute("data-link-to")}),n.on(o,"change",e("form.football-leagues")[0],function(){window.location=this.value})}function d(e,n,o){t(e).append(t.create('<div class="loading"><div class="loading__message">'+(n||"Loading…")+"</div>"+(o?'<a href="'+o.href+'" class="loading__link">'+o.text+"</a>":"")+'<div class="loading__animation"></div></div>'))}function m(t){e(".loading",t).remove()}return o=o(),{init:u}}),define("fence",[],function(){function e(t,n,o,i){i=i||0,t(),n>0&&setTimeout(function(){var s=o+i;e(t,n-1,s,o)},o)}function t(t){setTimeout(function(){e(function(){r(t),a(t)},p,f)},0)}function n(e,t){return e.classList?e.classList.contains(t):-1!==e.className.indexOf(t)}function o(e,t){return e.classList?e.classList.add(t):e.className+=" "+t}function i(){for(var e="iframe."+d,t=document.querySelectorAll(e),n=0,o=t.length;o>n;++n)s(t[n])}function s(e,i){if(i=i||{},"IFRAME"!==e.tagName)throw new Error("Cannot render non-iframe elements!");if(!n(e,d))throw new Error("Cannot render iframes with no "+d+" class!");var s=n(e,m);if(!s||i.force){e.style.height=0,e.frameBorder=0,e.style.border="none",e.style.overflow="hidden",e.width="100%";var r=!!e.srcdoc;if(r)"complete"===e.contentWindow.document.readyState?t(e):s||e.addEventListener("load",function(){t(e)},!1);else{var a=e.getAttribute("srcdoc");a&&"string"==typeof a&&(e.contentWindow.contents=a,e.src='javascript:window["contents"]',t(e))}o(e,m)}}function r(e){var t=e.contentWindow&&e.contentWindow.document,n=t&&t.body;n&&(n.style.padding=0,n.style.margin=0,n.style.overflow="hidden")}function a(e){var t=e.contentWindow&&e.contentWindow.document;if(t){var n=t.documentElement&&t.documentElement.scrollHeight||t.body&&t.body.scrollHeight||0;e.style.height=n+"px"}}function c(e){var t=document.createElement("div");t.innerHTML=(e||"").trim();var n=t.firstChild,o=n&&"IFRAME"===n.tagName,i=n&&!n.nextSibling;return o&&i}function l(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}function u(e){if(c(e))return e;var t=l(e).replace(/\"/g,"&quot;"),n="<html><head></head><body>"+t+"</body></html>";return'<iframe srcdoc="'+n+'" class="'+d+'"></iframe>'}var d="fenced",m="fenced-rendered",f=300,p=12;return{render:s,renderAll:i,isSafeCode:c,wrap:u}}),define("common/modules/ui/circular-progress",["bean","common/common","bonzo","common/utils/detect"],function(e,t,n,o){function i(e){this.$el=n(e.el);var t=e.baseColour||"#cccccc",i=e.activeColour||"#ec1c1c",s=e.bgColour||"#f4f4ee",r=e.arcWidth||3,a=e.size||this.$el.dim().width,c=(a-r)/2,l=a/2,u='<div class="circular-progress">  <svg xmlns="http://www.w3.org/2000/svg" version="1.1">    <circle cx="'+l+'" cy="'+l+'" r="'+c+'" stroke="'+t+'"       stroke-width="'+r+'" fill="transparent"></circle>    <path fill="transparent" stroke="'+i+'" stroke-width="'+r+'"></path>    <circle cx="'+l+'" cy="'+l+'" r="'+(c-r/2)+'" fill="'+s+'"></circle>  </svg>  <span class="circular-progress__counter"></span>  <span class="circular-progress__cta i"></span></div>';this.$el.html(u),this.$el=n(e.el.querySelector(".circular-progress")),this.centre=a/2,this.radius=(a-r)/2,this.pathEl=e.el.querySelector("path"),this.pathEl.setAttribute("transform","translate("+this.centre+", "+this.centre+")"),this.labelEl=e.el.querySelector(".circular-progress__counter"),o.hasTouchScreen()||this.$el.addClass("circular-progress--no-touch")}return i.prototype.enable=function(){return this.$el.addClass("circular-progress--is-on").removeClass("circular-progress--is-off"),this},i.prototype.disable=function(){return this.$el.addClass("circular-progress--is-off").removeClass("circular-progress--is-on"),this.render("",0),this},i.prototype.render=function(e,t){var n=3.5999*t,o=n*(Math.PI/180),i=this.radius*Math.sin(o),s=-this.radius*Math.cos(o),r=n>180?1:0,a=["M",0,0,"v",-this.radius,"A",this.radius,this.radius,1,r,1,i,s];return t||(a=["M",0,0]),this.pathEl.setAttribute("d",a.join(" ")),this.labelEl.innerHTML=e,this},i}),define("common/modules/ui/autoupdate",["common/common","common/utils/ajax","bonzo","bean","qwery","common/modules/userPrefs","common/utils/detect","common/modules/ui/circular-progress"],function(e,t,n,o,i,s,r,a){function c(i){var c=e.extend({activeClass:"is-active",btnClass:".js-auto-update",prefName:"auto-update",manipulationType:"html"},i),l=0;this.template='  <button class="u-button-reset live-toggler live-toggler--autoupdate js-auto-update js-auto-update--on"          data-action="off" data-link-name="autoupdate off" title="Turn auto update off">    <span class="lt__label">Auto update</span>    <span class="u-h">is</span>    <span class="lt__value">On</span>    <span class="u-h">(turn off)</span>  </button>  <button class="u-button-reset live-toggler live-toggler--autoupdate js-auto-update js-auto-update--off"          data-action="on" data-link-name="autoupdate on" title="Turn auto update on">    <span class="lt__label">Auto update</span>    <span class="u-h">is</span>    <span class="lt__value">Off</span>    <span class="u-h">(turn on)</span>  </button>  <button class="u-button-reset live-toggler live-toggler--circle js-auto-update"><span class="lt__circle-wrapper"></span>  </button>',this.view={render:function(t){var o=c.attachTo,i=c.manipulationType,s=(new Date).toString();if(o.nodeType){var a=n(o);if(c.responseSelector)a[i](e.$g(c.responseSelector,n.create("<div>"+t.html+"<div>")[0]));else{var u=n.create("<div>"+t.html+"</div>")[0];"prepend"===i&&n(u.children).addClass("autoupdate--new"),a[i](u.innerHTML)}a.attr("data-last-updated",s)}else{var d=n.create("<div>"+t.html+"<div>");for(var m in o)if(o.hasOwnProperty(m)){var f=e.$g(c.responseSelector[m],d[0]);n(o[m])[i](f).attr("data-last-updated",s)}}if("prepend"===i){var p=o.querySelectorAll(".autoupdate--new");l=p.length,r.pageVisible()&&(l=0,this.revealNewElements()),e.mediator.emit("modules:autoupdate:unread",l)}e.mediator.emit("modules:autoupdate:render")},toggle:function(e){var t=e.getAttribute("data-action");n(this.btns).removeClass(c.activeClass),"on"===t?this.on():this.off(),c.progressToggle||(e.parentNode.getElementsByClassName("js-auto-update--"+t)[0].className+=" "+c.activeClass),this.setPref(t)},destroy:function(){n(".update").remove(),e.mediator.emit("modules:autoupdate:destroyed")},revealNewElements:function(){var e=c.attachTo.querySelectorAll(".autoupdate--new");n(e).addClass("autoupdate--highlight"),setTimeout(function(){n(e).removeClass("autoupdate--new").removeClass("autoupdate--highlight")},5e3)}},this.load=function(){var n=this,o="function"==typeof c.path?c.path():c.path+".json";return t({url:o,type:"json",crossOrigin:!0}).then(function(t){t.refreshStatus===!1?(n.off(),n.view.destroy()):(n.view.render(t),e.mediator.emit("modules:autoupdate:loaded",t))},function(t){e.mediator.emit("module:error","Failed to load auto-update: "+t.statusText,"common/modules/autoupdate.js")})},this.on=function(){this.off(),this.nextReload=(new Date).getTime()+c.delay;var e=this;this.interval=window.setInterval(function(){e.load.call(e),e.nextReload=(new Date).getTime()+c.delay},c.delay),c.progressToggle&&(this.timerProgress.enable().render(c.delay/1e3,100),this.timerProgressInterval=window.setInterval(function(){var t=(new Date).getTime(),n=e.nextReload-t,o=Math.round(n/1e3),i=n/c.delay*100;0>n&&(e.nextReload=(new Date).getTime()+c.delay),e.timerProgress.render(o,i)},1e3),n(this.liveCircleTogglerEl).attr({"data-action":"off","data-link-name":"autoupdate off",title:"Turn auto update off"}))},this.off=function(){this.interval&&window.clearInterval(this.interval),c.progressToggle&&(this.timerProgressInterval&&window.clearInterval(this.timerProgressInterval),this.timerProgress.disable(),n(this.liveCircleTogglerEl).attr({"data-action":"on","data-link-name":"autoupdate on",title:"Turn auto update on"}))},this.getPref=function(){return s.get(c.prefName)},this.setPref=function(e){s.set(c.prefName,e)},this.init=function(){if(!c.switches||c.switches.autoRefresh===!0){var t=this,i=c.loadOnInitialise||!1,s=this.getPref();c.animateInserts&&n(c.attachTo).addClass("autoupdate--has-animation"),r.initPageVisibility(),e.mediator.on("modules:detect:pagevisibility:visible",function(){e.mediator.emit("modules:autoupdate:unread",0),t.view.revealNewElements()}),e.$g(".update").html(this.template).removeClass("hidden"),c.progressToggle&&(this.liveCircleTogglerEl=document.querySelector(".live-toggler--circle"),this.liveCircleTogglerEl.style.display="block",this.timerProgress=new a({el:this.liveCircleTogglerEl.querySelector(".lt__circle-wrapper"),activeColour:c.progressColour,size:30})),this.btns=e.$g(c.btnClass),this.btns.each(function(e){o.add(e,"click",function(e){e.preventDefault(),t.view.toggle.call(t,this)})}),"off"===s?this.view.toggle.call(this,this.btns[0]):this.view.toggle.call(this,this.btns[1]),i&&t.load.call(t)}}}return c}),define("common/modules/live/filter",["common/common","bonzo","bean"],function(e,t,n){function o(e){this.context=e||document,this.articleContainer=this.context.getElementsByClassName("js-article__container")[0],this.template='<div class="live-toggler-wrapper">  <button class="u-button-reset live-toggler live-toggler--all js-live-toggler"          data-link-name="filter show key-events" title="Show key events only">    <span class="u-h">Showing key events instead of</span>    <span class="lt__value">All posts</span>    <i class="i i-arrow-grey-down"></i>  </button>  <button class="u-button-reset live-toggler live-toggler--key-events js-live-toggler"          data-link-name="filter show all posts" title="Show all posts">    <span class="u-h">Showing all posts instead of</span>    <span class="lt__value">Key events</span>    <i class="i i-arrow-grey-down"></i>  </button></div>'}return o.prototype.init=function(){var o=this;t(this.context.getElementsByClassName("js-live-filter")[0]).replaceWith(this.template),this.findKeyEvents(),e.mediator.on("modules:autoupdate:loaded",function(){o.findKeyEvents.call(o)}),n.on(this.context,"click",".js-live-toggler",function(e){e.preventDefault(),o.showKeyEvents.call(o)}),n.on(window,"hashchange",function(){var e=window.location.hash;if(0===e.indexOf("#block-")){o.disable();var n=document.getElementById(e.replace("#",""));window.scrollTo(0,t(n).offset().top)}})},o.prototype.findKeyEvents=function(){this.articleContainer.getElementsByClassName("is-key-event").length&&t(this.articleContainer).addClass("has-key-events")},o.prototype.showKeyEvents=function(){t(this.articleContainer).toggleClass("show-only-key-events")},o.prototype.disable=function(){t(this.articleContainer).removeClass("show-only-key-events")},o}),define("common/modules/ui/notification-counter",["common/common"],function(e){function t(){}var n=document.title;return t.prototype.init=function(){var t=this;e.mediator.on("modules:autoupdate:unread",function(e){t.setCount(e)})},t.prototype.setCount=function(e){e>0?document.title="("+e+") "+n:this.restorePageTitle()},t.prototype.restorePageTitle=function(){document.title=n},t}),define("common/utils/clamp",["bonzo","bean"],function(e,t){var n=function(n,o,i){var s,r=n.clientHeight,a=getComputedStyle(n).getPropertyValue("line-height"),c=(parseInt(a,10)+(i?2:0))*o,l=e(e.create('<span class="clamp__fade"></span>')),u=e(n);
c>r||(u.css({maxHeight:c+"px",overflow:"hidden"}),u.after(l),i&&(s=e(e.create('<span class="clamp__fade-content u-fauxlink" role="button">Read more</span>')),l.append(s),t.on(s[0],"click",function(){l.remove(),u.css({maxHeight:"none",overflow:"auto"})})))};return n}),define("common/modules/open/cta",["common/$","common/utils/clamp","common/modules/component"],function(e,t,n){var o=function(e,t,n){this.contex=e,this.mediator=t,this.setOptions(n)};return n.define(o),o.prototype.endpoint="/open/cta/article/:discussionKey.json",o.prototype.componentClass="comment",o.prototype.useBem=!0,o.prototype.defaultOptions={discussionKey:null},o.prototype.prerender=function(){var t=e(".comment",this.elem),n=t[Math.floor(Math.random()*t.length)+0];0===t.length?this.destroy():this.elem=n},o.prototype.ready=function(){t(this.getElem("body"),10,!0)},o}),define("common/modules/commercial/loader",["common/$","common/utils/mediator","common/utils/storage","common/modules/lazyload","common/modules/component","common/modules/onward/history","common/modules/ui/images","bean"],function(e,t,n,o,i,r,a,c){var l=function(e){var t=e.config.page||{};return this.pageId=t.pageId,this.keywords=t.keywords||"",this.section=t.section,this.host=t.ajaxUrl+"/commercial/",this.desktopUserVariant=t.ab_commercialInArticleDesktop||"",this.mobileUserVariant=t.ab_commercialInArticleMobile||"",this.oastoken=e.oastoken||"",this.adType=e.adType||"desktop",this.userSegments="seg="+((new r).getSize()<=1?"new":"repeat"),this.components={bestbuy:this.host+"money/bestbuys.json?"+this.userSegments+"&s="+this.section+"&"+this.getKeywords(),book:this.host+"books/book/"+this.pageId+".json",books:this.host+"books/bestsellers.json?"+this.userSegments+"&s="+this.section+"&"+this.getKeywords(),jobs:this.host+"jobs.json?"+this.userSegments+"&s="+this.section+"&"+this.getKeywords(),masterclasses:this.host+"masterclasses.json?"+this.userSegments+"&s="+this.section,soulmates:this.host+"soulmates/mixed.json?"+this.userSegments+"&s="+this.section,travel:this.host+"travel/offers.json?"+this.userSegments+"&s="+this.section+"&"+this.getKeywords()},this.postLoadEvents={books:function(e){c.on(e,"click",".commercial__search__submit",function(){var n="merchandising-bookshop-v0_7_2014-03-12-low-"+e.querySelector(".commercial__search__input").value,o=t.contentType?t.contentType+":"+n:n;s.linkTrackVars="eVar22,eVar37,events",s.linkTrackEvents="event7,event37",s.events="event7,event37",s.prop22=o,s.eVar22=o,s.eVar37=o,s.tl(!0,"o",n)})}},this};return i.define(l),l.prototype.getKeywords=function(){return this.keywords.split(",").map(function(e){return"k="+encodeURIComponent(e.replace(/\s/g,"-").toLowerCase())}).join("&")},l.prototype.load=function(e,n){var i=this,s=this.components[e];return new o({url:s,container:n,beforeInsert:function(e){return e.replace(/%OASToken%/g,i.oastoken).replace(/%OmnitureToken%/g,"")},success:function(){a.upgrade(n),e in i.postLoadEvents&&i.postLoadEvents[e](n),t.emit("modules:commercial/loader:loaded")},error:function(e){t.emit("module:error","Failed to load related: "+e.statusText,"common/modules/commercial/loader.js")}}).load(),this},l.prototype.init=function(e,n){return void 0===this.components[e]?(t.emit("module:error","Unknown commercial component: "+e,"common/modules/commercial/loader.js"),!1):this.load(e,n)},l}),define("common/modules/experiments/layoutHints",["bonzo","qwery","bean","common/utils/detect"],function(e,t,n,o){function i(t){var n=t.page.pageId.split("/").pop().replace("-sp-","");n in this.content&&(this.container=document.getElementById("article"),e(this.container).addClass("layout-hints "+n),this.content[n]())}return i.prototype.content={"rescue-from-antarctica":function(){var i=e(new Image),s=t(".element-image",this.container),r=e(t("video",this.container)),a=o.getBreakpoint();i.addClass("media-primary media-primary--full-width"),i.attr("src","http://static.guim.co.uk/sys-images/Guardian/Pix/pictures/2014/2/26/1393435299650/Antarcticaleadimage.jpg"),i.insertBefore(t(".article__columning-wrapper",this.container)),e(s[0]).addClass("img--supporting"),e(s[3]).addClass("img--supporting"),r.each(function(e){"wide"===a&&n.on(e,"loadeddata",function(){this.setAttribute("poster","")},e),e.removeAttribute("controls"),e.setAttribute("autoplay","autoplay"),e.setAttribute("loop","loop"),e.setAttribute("muted","muted"),e.play()})}},i}),define("common/bootstraps/article",["common/common","common/utils/mediator","common/utils/detect","common/$","fence","common/modules/ui/autoupdate","common/modules/live/filter","common/modules/discussion/loader","common/modules/sport/cricket","common/modules/ui/notification-counter","common/modules/open/cta","common/modules/commercial/loader","common/modules/experiments/layoutHints"],function(e,t,n,o,i,s,r,a,c,l,u,d,m){var f={initLiveBlogging:function(){e.mediator.on("page:article:ready",function(e,t){if(e.page.isLive){var o=/desktop|wide/.test(n.getBreakpoint())?3e4:6e4;new s({path:function(){var e=t.querySelector(".article-body .block").id,n=window.location.pathname;return n+".json?lastUpdate="+e},delay:o,attachTo:t.querySelector(".article-body"),switches:e.switches,manipulationType:"prepend",animateInserts:!0,progressToggle:!0,progressColour:"#ec1c1c"}).init()}e.page.isLiveBlog&&(new r(t).init(),(new l).init())})},initDiscussion:function(){e.mediator.on("page:article:ready",function(t,n){if(t.page.commentable&&t.switches.discussion){var i=new a(n,e.mediator,{switches:t.switches});i.attachTo(o(".discussion")[0])}})},initCricket:function(){e.mediator.on("page:article:ready",function(e,t){var n=e.referencesOfType("esaCricketMatch");if(n[0]){var o={url:n[0],loadSummary:!0,loadScorecard:!0,summaryElement:".article__headline",scorecardElement:".article__headline",summaryManipulation:"after",scorecardManipulation:"after"};c.cricketArticle(e,t,o)}})},initOpen:function(){e.mediator.on("page:article:ready",function(t,n){if(t.switches.openCta&&t.page.commentable){var i=new u(n,e.mediator,{discussionKey:t.page.shortUrl.replace("http://gu.com/","")}),s=o(".open-cta");s[0]&&i.fetch(s[0])}})},initFence:function(){e.mediator.on("page:article:ready",function(){o(".fenced").each(function(e){i.render(e)})})},initLayoutHints:function(e){e.switches.layoutHints&&/\/-sp-/g.test(e.page.pageId)&&new m(e)},initHelvetica:function(e){if(e.switches.helvetica&&/\/helvetica-one-font-to-rule-them-all/g.test(e.page.pageId)){var t=document.querySelector(".article__headline");t.style.fontFamily='Helvetica, "EgyptianHeadline", georgia, serif',t.style.fontWeight="bold",t.style.letterSpacing="-1px"}}},p=function(t,n){this.initialised||(this.initialised=!0,f.initLiveBlogging(),f.initDiscussion(),f.initCricket(),f.initOpen(t),f.initFence(),f.initLayoutHints(t),f.initHelvetica(t)),e.mediator.emit("page:article:ready",t,n)};return{init:p}}),define("common/bootstraps/video",["common/utils/mediator","common/utils/detect","common/utils/lazy-load-css"],function(e,t,n){var o=function(t,o){this.initialised||(this.initialised=!0,n("video",t)),e.emit("page:video:ready",t,o)};return{init:o}}),define("common/bootstraps/gallery",["common/utils/mediator"],function(e){var t=function(t,n){this.initialised||(this.initialised=!0),e.emit("page:gallery:ready",t,n)};return{init:t}}),define("common/modules/identity/forms",["bean","bonzo"],function(e,t){function n(e,t){var n=t.querySelector(".js-reset-form");if(n){var o=window.location.hash.match("email=([^&#]*)");if(o){var i=n.querySelector(".js-reset-email");i.value=o[1]}}}function o(t,n){var o=n.querySelector(".js-signin-form");if(o){var i=o.querySelector(".js-signin-email"),s=o.querySelector(".js-forgotten-password"),r=s.getAttribute("href");e.add(s,"click",function(){var e=i.value;""!==e&&s.setAttribute("href",r+"#email="+e)})}}function i(n,o){var i=o.querySelector(".js-register-form");if(i){var s=i.querySelector(".js-register-password"),r="js-toggle-password",a='<div class="form-field__note form-field__note--right mobile-only"><a href="#toggle-password" class="'+r+'" data-password-label="Show password" data-text-label="Hide password" data-link-name="Toggle password field">Show password</a></div>',c=t(t.create(a)).insertBefore(s);c.previous().addClass("form-field__note--left"),e.add(c[0],"."+r,"click",function(e){e.preventDefault();var n=e.target,o="password"===s.getAttribute("type")?"text":"password",i=n.getAttribute("data-"+o+"-label");s.setAttribute("type",o),t(n).text(i)})}}return{forgottenEmail:n,forgottenPassword:o,passwordToggle:i}}),define("common/modules/identity/formstack",["common/$","common/common","bean","common/modules/identity/api"],function(e,t,n,o){function i(i,s,r,a){var c=this,l={},u=s.split("-")[0];a=t.extend({idClasses:{form:"form",field:"form-field",note:"form-field__note form-field__note--below",label:"label",checkboxLabel:"check-label",textInput:"text-input",textArea:"textarea textarea--no-resize",submit:"submit-input",fieldError:"form-field--error",formError:"form__error",fieldset:"formstack-fieldset",required:"formstack-required",sectionHeader:"formstack-heading",sectionHeaderFirst:"formstack-heading--first",sectionText:"formstack-section",characterCount:"formstack-count",hide:"is-hidden"},fsSelectors:{form:"#fsForm"+u,field:".fsRow",note:".fsSupporting, .showMobile",label:".fsLabel",checkboxLabel:".fsOptionLabel",textInput:'.fsField[type="text"], .fsField[type="email"], .fsField[type="number"], .fsField[type="tel"]',textArea:"textarea.fsField",submit:".fsSubmitButton",fieldError:".fsValidationError",formError:".fsError",fieldset:"fieldset",required:".fsRequiredMarker",sectionHeader:".fsSectionHeading",sectionHeaderFirst:".fsSection:first-child .fsSectionHeading",sectionText:".fsSectionText",characterCount:".fsCounter",hide:".hidden, .fsHidden, .ui-datepicker-trigger"},hiddenSelectors:{userId:'[type="number"]',email:'[type="email"]'}},a),c.init=function(){var t=o.getUserOrSignIn();c.dom(t),e(i).removeClass(a.idClasses.hide),e("html").addClass("iframed--overflow-hidden"),c.postMessage("ready")},c.dom=function(t){l.$form=e(a.fsSelectors.form).addClass(a.idClasses.form),e("link",i).remove();for(var o in a.fsSelectors)e(a.fsSelectors[o],l.$form).addClass(a.idClasses[o]);var s=e(a.hiddenSelectors.userId,l.$form).remove(),r=e(a.hiddenSelectors.email,l.$form).remove(),u='<input type="hidden" name="'+s.attr("name")+'" value="'+t.id+'"><input type="hidden" name="'+r.attr("name")+'" value="'+t.primaryEmailAddress+'">';l.$form.append(u),n.on(window,"unload",c.unload),n.on(l.$form[0],"submit",c.submit)},c.submit=function(){setTimeout(function(){e("."+a.idClasses.formError).removeClass(a.idClasses.formError),e("."+a.idClasses.fieldError).removeClass(a.idClasses.fieldError),e(a.fsSelectors.formError,l.$form).addClass(a.idClasses.formError),e(a.fsSelectors.fieldError,l.$form).addClass(a.idClasses.fieldError),e(a.fsSelectors.textArea,i).each(function(e){n.fire(e,"keyup")}),c.postMessage("refreshHeight")},100)},c.unload=function(){c.postMessage("unload")},c.postMessage=function(e){window.top.postMessage(e,"*")}}return i}),define("common/modules/identity/formstack-iframe",["common/$","bean"],function(e,t){function n(n,o,i){var s=this;s.init=function(){t.on(window,"message",function(e){e.origin===i.page.idUrl&&s.onMessage(e)}),t.on(window,"resize",s.refreshHeight),t.on(n,"load",function(){s.show(),s.refreshHeight()})},s.onMessage=function(e){switch(e.data){case"ready":s.show(),s.refreshHeight();break;case"unload":s.refreshHeight(!0);break;case"refreshHeight":s.refreshHeight()}},s.refreshHeight=function(t){t&&e(n).css({height:0});var o=n.contentWindow.document,i=o.body,s=o.documentElement,r=Math.max(i.scrollHeight,i.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight);e(n).css({height:r})},s.show=function(){e(n).removeClass("is-hidden")}}return n}),define("common/modules/identity/password-strength",["common/common","bonzo","bean"],function(e,t,n){function o(o,i,s){s=e.extend({text:{label:"Password strength","long":"Password too long","short":"Password too short"},classes:{indicator:"js-password-strength-indicator",label:"js-password-strength-label",ready:"has-indicator"},labels:["weak","poor","medium","good","strong"],minLength:6,maxLength:20},s);var r,a=!1,c={element:o},l='<div class="password-strength-indicator '+s.classes.indicator+' score-null is-off"><div class="form-field__note form-field__note--below form-field__note--right password-strength '+s.classes.label+'">'+s.text.label+"</div></div>";this.init=function(){if(!t(c.element).hasClass(s.classes.ready)){var e=this;require(["js!zxcvbn"],function(){r=this.zxcvbn,c.indicator=t(t.create(l)).insertAfter(c.element)[0],c.label=c.indicator.querySelector("."+s.classes.label),n.on(c.element,"keyup.count",e.checkCount),n.on(c.element,"keyup.key",e.checkStrength),e.checkCount(),e.checkStrength(),t(c.element).addClass(s.classes.ready)})}},this.checkCount=function(){c.element.value.length>=s.minLength&&(a=!0,t(c.indicator).removeClass("is-off"),n.off(c.element,"keyup.count"))},this.checkStrength=function(){if(a){var e=r(c.element.value).score,n=s.text.label+": "+s.labels[e];c.element.value.length<s.minLength?(n=s.text["short"],e=null):c.element.value.length>s.maxLength&&(n=s.text["long"],e=null),c.indicator.className=c.indicator.className.replace(/\bscore-\S+/g,"score-"+e),t(c.label).text(n)}}}return o}),define("common/modules/identity/account-profile",["bean","bonzo","common/utils/url"],function(e,t,n){var o=function(){var t=this;return t.classes={forms:".js-account-profile-forms",accountForm:".js-account-details-form",publicForm:".js-public-profile-form",tabs:".js-tabs",formError:".form__error",changed:"js-form-changed",textInput:".text-input"},t.unsavedFields=[],{init:function(n){if(t.accountProfileForms=n.querySelector(t.classes.forms),t.accountProfileForms){t.bindInputs(t.accountProfileForms.querySelector(t.classes.accountForm)),t.bindInputs(t.accountProfileForms.querySelector(t.classes.publicForm));var o=t.accountProfileForms.querySelector(t.classes.tabs);e.on(o,"click",t.handleTabsClick.bind(t))}}}};return o.prototype.handleTabsClick=function(o){var i=this;"a"===o.target.nodeName.toLowerCase()&&(i.unsavedChangesForm?(o.preventDefault(),o.stopImmediatePropagation(),i.unsavedChangesForm.querySelector(i.classes.formError)||(t(i.unsavedChangesForm).prepend(i.genUnsavedError()),e.on(i.unsavedChangesForm.querySelector(".js-save-unsaved"),"click",function(){i.unsavedChangesForm.submit()}))):n.pushUrl({},o.target.innerHTML,o.target.getAttribute("data-pushstate-url")))},o.prototype.genUnsavedError=function(){for(var e="<div class='form__error'>",t="</div>",n="<a href='#' class='js-save-unsaved'>Save changes</a>",o="Your form has unsaved changes in ",i=0;i<this.unsavedFields.length;i++){var s=this.unsavedFields[i].id,r=this.accountProfileForms.querySelector("[for='"+s+"']").innerHTML;o+="'"+r+"'",o+=i===this.unsavedFields.length-1?". ":i===this.unsavedFields.length-2?" and ":", "}return e+o+n+t},o.prototype.onInputChange=function(e){t(e.target.form).addClass(this.classes.changed),this.unsavedChangesForm=e.target.form,this.unsavedFields.some(function(t){return t===e.target})||this.unsavedFields.push(e.target)},o.prototype.bindInputs=function(e){var t=Array.prototype.slice.call(e.querySelectorAll(this.classes.textInput));t=t.concat(Array.prototype.slice.call(e.querySelectorAll("select")));for(var n=t.length-1;n>=0;n--){var o=t[n];o.form=e,"select-one"===o.type?o.addEventListener("change",this.onInputChange.bind(this)):o.addEventListener("input",this.onInputChange.bind(this))}},o}),define("common/bootstraps/identity",["common/$","common/modules/identity/forms","common/modules/identity/formstack","common/modules/identity/formstack-iframe","common/modules/identity/password-strength","common/modules/identity/validation-email","common/modules/identity/api","common/modules/identity/account-profile","common/modules/adverts/userAdTargeting","common/modules/discussion/user-avatars","common/utils/mediator","common/modules/ui/tabs"],function(e,t,n,o,i,s,r,a,c,l,u,d){var m={idInit:function(e){r.init(e),r.isUserLoggedIn()&&(document.documentElement.className=document.documentElement.className.replace(/\bid--signed-out\b/,"id--signed-in"))},initFormstack:function(){u.on("page:identity:ready",function(t,i){var s="data-formstack-id";e("["+s+"]").each(function(e){var o=e.getAttribute(s);new n(e,o,i,t).init()}),e(".js-formstack-iframe").each(function(e){new o(e,i,t).init()})})},forgottenEmail:function(){u.on("page:identity:ready",function(e,n){t.forgottenEmail(e,n)})},forgottenPassword:function(){u.on("page:identity:ready",function(e,n){t.forgottenPassword(e,n)})},passwordStrength:function(){u.on("page:identity:ready",function(t,n){e(".js-password-strength").each(function(e){new i(e,n,t).init()})})},passwordToggle:function(){u.on("page:identity:ready",function(e,n){t.passwordToggle(e,n)})},userAdTargeting:function(){u.on("page:identity:ready",function(){c.requestUserSegmentsFromId()})},userAvatars:function(){u.on("page:identity:ready",function(){l.init()})},validationEmail:function(){u.on("page:identity:ready",function(e,t){s.init(t)})},tabs:function(){var e=new d;u.on("page:identity:ready",function(t,n){e.init(n)})},accountProfile:function(){var e=new a;u.on("page:identity:ready",function(t,n){e.init(n)})}},f=function(e,t){this.initialised||(this.initialised=!0,m.idInit(e),m.initFormstack(),m.forgottenEmail(),m.forgottenPassword(),m.passwordStrength(),m.passwordToggle(),m.userAdTargeting(),m.userAvatars(),m.validationEmail(),m.tabs(),m.accountProfile()),u.emit("page:identity:ready",e,t)};return{init:f}}),define("common/bootstraps/app",["domReady","common/utils/mediator","common/utils/ajax","common/utils/detect","common/utils/config","common/utils/context","common/utils/userTiming","common/modules/analytics/errors","common/modules/ui/fonts","common/modules/adverts/userAdTargeting","common/modules/discussion/api","common/bootstraps/common","common/bootstraps/tag","common/bootstraps/section","common/bootstraps/imagecontent","common/bootstraps/football","common/bootstraps/article","common/bootstraps/video","common/bootstraps/gallery","common/bootstraps/identity"],function(e,t,n,o,i,s,r,a,c,l,u,d,m,f,p,h,g,v,y,b){var w={initialiseAjax:function(e){n.init(e)},initialiseDiscussionApi:function(e){u.init(e)},attachGlobalErrorHandler:function(e){if(!e.switches.clientSideErrors)return!1;var n=new a({isDev:e.page.isDev,buildNumber:e.page.buildNumber});n.init(),t.on("module:error",n.log)},loadFonts:function(e,t){if(e.switches.webFonts&&!guardian.shouldLoadFontsAsynchronously){var n=o.getFontFormatSupport(t),i=document.querySelectorAll("[data-cache-name].initial"),s=new c(i,n);s.loadFromServerAndApply()}},initId:function(e,t){b.init(e,t)},initUserAdTargeting:function(){l.requestUserSegmentsFromId()}},_=function(){r.mark("App Begin"),e(function(){var e=document.getElementById("preload-1");s.set(e),w.initialiseAjax(i),w.initialiseDiscussionApi(i),w.attachGlobalErrorHandler(i),w.loadFonts(i,navigator.userAgent),w.initId(i,e),w.initUserAdTargeting();var n=function(e,t){d.init(e,t),e.page.isFront&&require("bootstraps/facia",function(n){n.init(e,t)}),"Article"===e.page.contentType&&g.init(e,t),"Video"===e.page.contentType&&v.init(e,t),"Gallery"===e.page.contentType&&y.init(e,t),"Tag"===e.page.contentType&&m.init(e,t),"Section"!==e.page.contentType||e.page.isFront||f.init(e,t),"ImageContent"===e.page.contentType&&p.init(e,t),"football"===e.page.section&&h.init()};t.on("page:ready",n),t.emit("page:ready",i,e),r.mark("App End")})};return{go:_}}),require(["common/bootstraps/app"],function(e){guardian.isModernBrowser&&e.go()});
//# sourceMappingURL=app.js.map